# Vue.jsçš„çŠ¶æ€ç®¡ç†åº“Vuexå’ŒPinia

å½“ä¸‹çš„å‰ç«¯æŠ€æœ¯ï¼ˆå°¤å…¶æ˜¯å•é¡µé¢å¼€å‘ï¼‰ä¼šç»å¸¸æåˆ°çŠ¶æ€ç®¡ç†è¿™ä¸ªæ¦‚å¿µï¼ŒVue.jså’ŒReact.jséƒ½æä¾›äº†å¾ˆå¥½çš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯Vuexå’ŒPiniaã€‚



## 1. Vuex

### 1.1 çŠ¶æ€ç®¡ç†ä¸storeæ¨¡å¼

å¯¹äºä¸€ä¸ªåŸºæœ¬çš„Vue.jsç»„ä»¶ï¼Œå…¶æ‰€æœ‰çš„æ•°æ®éƒ½å­˜æ”¾åœ¨dataå¯¹è±¡ä¸­ï¼Œè€Œè¯¥å¯¹è±¡æ‹¥æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Œæƒ³è¦åœ¨å…¶ä»–çš„ç»„ä»¶æˆ–è·¯ç”±ä¸­è®¿é—®è¿™äº›æ•°æ®å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚



å¦‚æœè¿™äº›æ•°æ®å†…å®¹éœ€è¦è¢«å¤šä¸ªå®ä¾‹å…±äº«ï¼Œä½¿ç”¨ç¼“å­˜æˆ–è·¯å¾„å‚æ•°çš„æ–¹å¼ä¼ è¾“æ•°æ®è¿‡äºçƒ¦çä¸”å®¹æ˜“å‡ºé”™ï¼Œæ‰€ä»¥å•é¡µé¢åº”ç”¨æä¾›äº†çŠ¶æ€ç®¡ç†è¿™ä¸ªæ¦‚å¿µã€‚

Vue.jsä¸­çš„çŠ¶æ€ç®¡ç†æä¾›äº†ä¸¤ç§æ–¹æ¡ˆï¼š

* storeæ¨¡å¼
* Vuexã€‚

æœ¬èŠ‚åªä»‹ç»storeæ¨¡å¼ï¼Œåé¢ä¼šè¯¦ç»†ä»‹ç»Vuexã€‚

storeæ¨¡å¼æ— é¡»å®‰è£…æ¨¡å—ï¼Œç†è§£èµ·æ¥éå¸¸ç®€å•ï¼Œç›¸å½“äºå°†æ•°æ®æŒ‚è½½åœ¨æ ¹èŠ‚ç‚¹ä¸­ï¼ˆç±»ä¼¼å…¨å±€å˜é‡ï¼‰ï¼Œç„¶ååœ¨æ¯ä¸ªå®ä¾‹ä¸­å£°æ˜dataã€‚

è¿™æ ·åœ¨ä¸€å¤„æ›´æ–°æ•°æ®æ—¶ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½ä¼šæ›´æ–°ï¼Œå› ä¸ºå…¶æœ¬èº«æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚è¿™æ ·åšçš„ç¼ºç‚¹æ˜¯ï¼šæ•°æ®çš„æ”¹å˜ä¸ä¼šç•™ä¸‹å˜æ›´è®°å½•ï¼Œå¹¶ä¸”è°ƒè¯•å›°éš¾ã€‚





### 1.2 ä½¿ç”¨Vuexçš„æƒ…å½¢

å¹¶ä¸æ˜¯æ‰€æœ‰çš„æƒ…å†µéƒ½é€‚åˆä½¿ç”¨Vuexï¼Œæˆ–è€…è¯´å¤§é‡çš„ä¸šåŠ¡éœ€æ±‚å¹¶ä¸éœ€è¦å¯¹æ•°æ®è¿›è¡ŒçŠ¶æ€ç®¡ç†ã€‚

æ•°æ®åœ¨å•ç»„ä»¶ç¯å¢ƒä¸­å¯ä»¥å®Œæˆå¤§éƒ¨åˆ†çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå¹¶éè¦å¿…é¡»ä½¿ç”¨çŠ¶æ€ç®¡ç†ï¼Œè¯»è€…ä¸éœ€è¦ä¸ºäº†ä½¿ç”¨çŠ¶æ€ç®¡ç†è€Œä½¿ç”¨Vuexã€‚



ä¸€äº›å°é¡¹ç›®å¦‚æœå¼•å…¥Vuexè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œä¸ä»…ä¼šä½¿åŸæœ¬é€»è¾‘æ¸…æ™°çš„ä»£ç å’Œç»“æ„å˜å¾—å¤æ‚ï¼Œç”šè‡³ä¼šå¢åŠ å¼€å‘éš¾åº¦ï¼Œé€ æˆä»£ç å†—ä½™ã€‚

æ‰€ä»¥å®˜æ–¹è®¤ä¸ºï¼Œå¦‚æœä¸æ˜¯å¤§ä¸­å‹å•é¡µåº”ç”¨ï¼Œä¸éœ€è¦å¼•å…¥Vuexï¼Œå³ä½¿éœ€è¦åŒæ­¥æ•°æ®ï¼Œè‡ªå¸¦çš„storeæ¨¡å¼ä¹Ÿè¶³å¤Ÿä½¿ç”¨ã€‚



å¦‚æœéœ€è¦æ„å»ºå¤§ä¸­å‹å•é¡µå¼•ç”¨ï¼Œé‚£ä¹ˆVuexæ˜¯å¿…ç„¶çš„é€‰æ‹©ã€‚



é‡‡ç”¨ä¸€ä¸ªæ–°çš„Vue.jså·¥ç¨‹å®ç°Vuexã€‚

ï¼ˆ1ï¼‰ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºå¹¶æˆåŠŸå¯åŠ¨ä¸€ä¸ªVue.jsé¡¹ç›®ã€‚åœ¨é…ç½®å·¥ç¨‹æ—¶ï¼Œæ·»åŠ Vuexå’Œvue- routerçš„æ”¯æŒ

```
vue create vuex-test
```

ï¼ˆ2ï¼‰ç­‰å¾…é¡¹ç›®åˆå§‹åŒ–æˆåŠŸï¼Œæ‰€æœ‰çš„ä¾èµ–åŒ…ä¼šè‡ªåŠ¨å®‰è£…å¥½ï¼Œå…¶ä¸­package.jsonçš„ä»£ç å¦‚ä¸‹ï¼š

```
{
  "name": "vuex-test",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "lint": "vue-cli-service lint"
  },
  "dependencies": {
    "core-js": "^3.8.3",
    "vue": "^3.2.13",
    "vue-router": "^4.0.3",
    "vuex": "^4.0.0"
  },
  "devDependencies": {
    "@babel/core": "^7.12.16",
    "@babel/eslint-parser": "^7.12.16",
    "@vue/cli-plugin-babel": "~5.0.0",
    "@vue/cli-plugin-eslint": "~5.0.0",
    "@vue/cli-plugin-router": "~5.0.0",
    "@vue/cli-plugin-vuex": "~5.0.0",
    "@vue/cli-service": "~5.0.0",
    "@vue/eslint-config-standard": "^6.1.0",
    "eslint": "^7.32.0",
    "eslint-plugin-import": "^2.25.3",
    "eslint-plugin-node": "^11.1.0",
    "eslint-plugin-promise": "^5.1.0",
    "eslint-plugin-vue": "^8.0.3"
  }
}
```

è¿™æ ·å°±åˆå§‹åŒ–äº†ä¸€ä¸ªè‡ªå¸¦Vuexçš„çŠ¶æ€ç®¡ç†é¡¹ç›®ã€‚é€šè¿‡ä»£ç å¯ä»¥å¯¹æ‰€æœ‰é¡µé¢ä¸­çš„çŠ¶æ€è¿›è¡Œæ§åˆ¶ã€‚

ï¼ˆ3ï¼‰ä½¿ç”¨Vuexç®¡ç†ï¼Œéœ€è¦å…ˆè¿›è¡Œé…ç½®ã€‚åŸºæœ¬çš„é…ç½®æ–¹å¼å’Œvue-routerç±»ä¼¼ï¼Œéœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªVuex.Storeï¼Œå¹¶ä½¿ç”¨Vue.useåœ¨å…¨å±€æ³¨å†Œè¯¥ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
import { createStore } from 'vuex'

export default createStore({
  state: {
  },
  getters: {
  },
  mutations: {
  },
  actions: {
  },
  modules: {
  }
})
```

ï¼ˆ4ï¼‰æœ€ç»ˆè·å¾—çš„storeå¯¹è±¡å’Œè‡ªå®šä¹‰çš„å­˜å‚¨æ•°æ®çš„å¯¹è±¡ä¸€æ ·ï¼Œéœ€è¦åœ¨main.jsä¸­å¼•å…¥ï¼Œå¹¶åœ¨å®ä¾‹åŒ–Vueå¯¹è±¡æ—¶ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
createApp(App).use(store).use(router).mount('#app')
```



### 1.3 åœ¨Vue.jsç»„ä»¶ä¸­Getterå¯¹è±¡

Vuexè¢«æ³¨å†Œæˆä¸€ä¸ªstoreä¹‹åï¼Œå¯ä»¥åœ¨å…¨å±€çš„ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œå¦‚æœåªéœ€è¦å…¶ä¸­çš„å€¼ï¼Œè°ƒç”¨$storeè¿™ä¸ªå…¨å±€å¯¹è±¡å°±å¯ä»¥ã€‚

ã€ç¤ºä¾‹ã€‘ç¼–å†™ä¸€ä¸ªåŸºæœ¬çš„å…¨å±€æ¶ˆæ¯æ˜¾ç¤ºç¨‹åºã€‚

ï¼ˆ1ï¼‰å®šä¹‰ä¸€ä¸ªåŸºæœ¬çš„storeï¼Œé€šè¿‡é¡µé¢ä¸Šæ–¹çš„ä¸€ä¸ªå…±åŒç»„ä»¶æ˜¾ç¤ºä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨å­ç»„ä»¶ä¸­æ›´æ”¹è¯¥å†…å®¹æ—¶æ­¤å¤„çš„å†…å®¹ä¼šè‡ªåŠ¨æ›´æ–°ã€‚

```
import { createStore } from 'vuex'

export default createStore({
  state: {
    message: 'è¿™æ˜¯æµ‹è¯•'
  },
  getters: {
  },
  mutations: {
  },
  actions: {
  },
  modules: {
  }
})

```



ï¼ˆ2ï¼‰storeéœ€è¦åœ¨main.jsä¸­å¼•å…¥å’Œæ³¨å†Œï¼Œä»£ç å¦‚ä¸‹ï¼š

```
import { createApp } from 'vue'
import App from './App.vue'
import router from './router'
import store from './store'

createApp(App).use(store).use(router).mount('#app')
```



ï¼ˆ3ï¼‰ç¼–è¾‘App.vueçš„æ¨¡æ¿éƒ¨åˆ†å’Œæ ·å¼éƒ¨åˆ†ï¼Œå¢åŠ ä¸€ä¸ªæ–°çš„è·¯ç”±è·¯å¾„å’Œæ˜¾ç¤ºä¿¡æ¯çš„\<div\>å…ƒç´ ï¼Œä»£ç å¦‚ä¸‹ï¼š



```
<template>
  <div id="app">
    <div class="show-message">
      {{ $store.state.message }}
    </div>
    <div id="nav">
      <router-link to="/">Home</router-link>
      |
      <router-link to="/about">About</router-link>
    </div>
    <router-view/>
  </div>
</template>
```

storeä¸­çš„Getterå¯¹è±¡ç”¨äºè·å–å®ä¾‹ä¸­çš„stateå±æ€§ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼ˆå¹¶éæ”¹å˜æ•°æ®æœ¬èº«ï¼‰ã€‚è¿™äº›æ“ä½œä¹Ÿå¯ä»¥åœ¨ç»„ä»¶è·å–storeçš„å€¼åå†æ‰§è¡Œï¼Œä½†ä½¿ç”¨Getterå¯¹è±¡å¯ä»¥å¢åŠ ä»£ç çš„å¤ç”¨æ€§ï¼Œæé«˜é¡µé¢çš„å“åº”æ€§èƒ½ã€‚

åœ¨storeä¸­ç¼–å†™ä¸€ä¸ªGetterå¯¹è±¡ç”¨äºè·å–statesä¸­çš„æ•°æ®ï¼Œå¹¶å¯¹è¯¥æ•°æ®è¿›è¡Œæ“ä½œï¼Œä»£ç å¦‚ä¸‹ï¼š

```
import { createStore } from 'vuex'

export default createStore({
  state: {
    message: 'è¿™æ˜¯æµ‹è¯•'
  },
  getters: {
    set_prefix: state => {
      return 'æœ€æ–°æ¶ˆæ¯' + state.message
    }
  },
  mutations: {
  },
  actions: {
  },
  modules: {
  }
})
```

åœ¨Getterå¯¹è±¡ä¸­å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•ï¼Œä¸ºåŸæœ¬çš„æ•°æ®å¢åŠ ä¸€ä¸ªå­—ç¬¦ä¸²å‰ç¼€ã€‚åœ¨App.vueä¸­é€šè¿‡è¯¥Getterå¯¹è±¡è·å–æ•°æ®ï¼Œä¿®æ”¹åçš„æ¨¡æ¿ä»£ç å¦‚ä¸‹ï¼š

```
<template>
  <div id="app">
    <div class="show-message">
      {{ $store.getters.set_prefix }}
    </div>
    <div id="nav">
      <router-link to="/">Home</router-link>
      |
      <router-link to="/about">About</router-link>
    </div>
    <router-view/>
  </div>
</template>
```

æ˜¾ç¤ºæ•ˆæœå¦‚å›¾

é€šè¿‡Getterå¯¹è±¡è·å–æ•°æ®

![](../_static/image-20220301145850466.png)



### 1.4 æ›´æ–°Vuexä¸­çš„store

å› ä¸ºVue.jsä¸­æ‰€æœ‰çš„æ•°æ®ç»‘å®šéƒ½é‡‡ç”¨å•å‘ä¼ è¾“æ–¹å¼ï¼Œç›´æ¥å¯¹æ•°æ®è¿›è¡Œæ”¹å†™æ ¹æœ¬ä¸ä¼šé€šçŸ¥ç»„ä»¶ï¼Œæ‰€ä»¥ç»„ä»¶è‡ªç„¶æ— æ³•è·å–å˜åŒ–åçš„æ•°æ®ï¼Œæ­¤æ—¶é¡µé¢ä¸å‘ç”Ÿä»»ä½•å˜åŒ–ã€‚è¿™ä¹Ÿæ˜¯Vuexå‡ºç°çš„åŸå› ã€‚Vuexæä¾›äº†ä¸€ä¸ªMutationå¯¹è±¡ï¼Œæ‰€æœ‰å¯¹æ•°æ®çš„ä¿®æ”¹éƒ½å¿…é¡»é€šè¿‡è¯¥å¯¹è±¡è¿›è¡Œæ“ä½œã€‚

ä¿®æ”¹storeä¸­messageå¯¹è±¡çš„å€¼ã€‚

```
import { createStore } from 'vuex'

export default createStore({
  state: {
    message: 'è¿™æ˜¯æµ‹è¯•'
  },
  mutations: {
    // set()æ–¹æ³•ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œç±»ä¼¼äºäº‹ä»¶æ³¨å†Œ
    setMessage (state, msg) {
      state.message = msg
    }
  },
  getters: {
    set_prefix: state => {
      return 'æœ€æ–°æ¶ˆæ¯:' + state.message
    }
  },
  actions: {},
  modules: {}
})
```

ä¸Šè¿°ä»£ç ä¸­å®šä¹‰äº†ä¸€ä¸ªsetMessage()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯stateæœ¬èº«ï¼Œ

ç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥ç¡®å®šæ˜¾ç¤ºçš„å†…å®¹ã€‚é€šè¿‡è°ƒç”¨set_prefix()æ–¹æ³•å¯ä»¥ä¿®æ”¹stateä¸­çš„messageå¯¹è±¡çš„å€¼ã€‚

> æ³¨æ„ï¼šå¦‚æœç›´æ¥ä¿®æ”¹stateä¸­çš„æ•°æ®ï¼Œåˆ™æ— æ³•é€šçŸ¥æ‰€æœ‰ä½¿ç”¨è¯¥æ•°æ®çš„ä½ç½®å®ç°æ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å®šä¹‰çš„setMessage()æ–¹æ³•ä¿®æ”¹æ•°æ®ï¼Œ
>
> å³å¿…é¡»ä½¿ç”¨this.$store.commit()è¿›è¡Œâ€œæäº¤â€å¼åœ°è°ƒç”¨ã€‚


ç¼–è¾‘`router/index.js`æ–‡ä»¶,ç¼–å†™è·¯ç”±

```
import { createRouter, createWebHistory } from 'vue-router'
import HomeView from '../views/HomeView.vue'
import VuexTest from '@/views/VuexTest'

const routes = [
  {
    path: '/',
    name: 'home',
    component: HomeView
  },
  {
    path: '/about',
    name: 'about',
    // route level code-splitting
    // this generates a separate chunk (about.[hash].js) for this route
    // which is lazy-loaded when the route is visited.
    component: () => import(/* webpackChunkName: "about" */ '../views/AboutView.vue')
  },
  {
    path: '/vuex-test',
    component: VuexTest
  }
]

const router = createRouter({
  history: createWebHistory(process.env.BASE_URL),
  routes
})

export default router
```



ä¸Šè¿°ä»£ç åœ¨è·¯ç”±ä»£ç ä¸­å¼•å…¥äº†`view/VuexTest.vue`æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ç”¨äºæä¾›ä¸€ä¸ªæŒ‰é’®å’Œç›‘å¬äº‹ä»¶æ¥æ›´æ”¹storeå¯¹è±¡ï¼Œ

ä»£ç å¦‚ä¸‹ï¼š

```
<template>
  <div>
    <input v-model="text"/>
    <br> <br>
    <button v-on:click="changeMsg">å•å‡»æ›´æ”¹æ¶ˆæ¯</button>
  </div>
</template>

<script>
export default {
  name: 'VuexTest',
  data () {
    return {
      text: ''
    }
  },
  methods: {
    // å®šä¹‰ä¿®æ”¹æ–¹æ³•
    changeMsg: function () {
      // è¯¥æ–¹æ³•å¿…é¡»åŒæ­¥æ‰§è¡Œ
      this.$store.commit('setMessage', this.text)
    }
  }
}
</script>

<style scoped>

</style>
```



ä¸Šè¿°ä»£ç å®šä¹‰ä¸€ä¸ªæ–‡æœ¬æ¡†å¹¶ä¸”ç»‘å®šç›¸åº”çš„å€¼ï¼ŒåŒæ—¶ç»‘å®šæŒ‰é’®çš„å•å‡»äº‹ä»¶ã€‚å•å‡»è¯¥æŒ‰é’®ï¼Œè°ƒç”¨storeä¸­çš„mutationå¯¹è±¡æŒ‡å®šæ–¹æ³•åä¸ºsetMessage()ï¼ŒåŒæ—¶ä¼ å…¥ä¸€ä¸ªè¾“å…¥æ•°æ®çš„å˜é‡ã€‚



ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥åœ¨App.vueä¸­æ·»åŠ ä¸€æ¡è·³è½¬æ ‡ç­¾ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
<template>
  <div id="app">
    <div class="show-message">
      {{ $store.getters.set_prefix }}
    </div>
    <div id="nav">
      <router-link to="/">Home</router-link>
      |
      <router-link to="/about">About</router-link>
      |
      <router-link to="/vuex-test">Vuex</router-link>
    </div>
    <router-view/>
  </div>
</template>
```

æœ€ç»ˆæ˜¾ç¤ºæ•ˆæœå¦‚å›¾

![](../_static/image-20220301151544384.png)

ä½¿ç”¨store.commit()è¿›è¡Œä¿®æ”¹å½“ç„¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå¦‚æœåœ¨ç»„ä»¶ä¸­ç›´æ¥å¯¹å…¶è°ƒç”¨ï¼Œ**åˆ™éœ€è¦æ³¨æ„mutationå¯¹è±¡å¿…é¡»åŒæ­¥æ‰§è¡Œã€‚**



ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥ä»£ç ä¸‹æ–¹çš„æ‰€æœ‰ä»£ç éƒ½ä¼šåœ¨commit()æ–¹æ³•æ‰§è¡Œå®Œæˆåæ‰ä¼šæ‰§è¡Œã€‚



å¦‚æœéœ€è¦å¼‚æ­¥å¤„ç†æ‰€æœ‰çš„ä¿®æ”¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨Actionå¯¹è±¡ã€‚è¯¥å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯åœ¨Actionä¸­ä½¿ç”¨mutationï¼Œä¹Ÿå°±æ˜¯åœ¨actionså¯¹è±¡ä¸­ç¼–å†™commit()æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
import { createStore } from 'vuex'

export default createStore({
  state: {
    message: 'è¿™æ˜¯æµ‹è¯•'
  },
  mutations: {
    // set()æ–¹æ³•ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œç±»ä¼¼äºäº‹ä»¶æ³¨å†Œ
    setMessage (state, msg) {
      state.message = msg
    }
  },
  getters: {
    set_prefix: state => {
      return 'æœ€æ–°æ¶ˆæ¯:' + state.message
    }
  },
  // Actionçš„ç‰¹æ€§æ˜¯å¯ä»¥å¼‚æ­¥æ‰§è¡Œä»£ç ã€‚
  actions: {
    setMessage (context, msg) {
      context.commit('setMessage', msg)
    }
  },
  modules: {}
})

```



Actionå¯¹è±¡ä¸­çš„æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå’Œstoreå®ä¾‹ç›¸åŒçš„å¯¹è±¡ï¼ˆä½†å¹¶ä¸æ˜¯storeå®ä¾‹æœ¬èº«ï¼‰ï¼Œé€šè¿‡store.dispath()æ–¹æ³•æŒ‡å®šæ–¹æ³•åç§°å’Œå‚æ•°ï¼Œè§¦å‘å¯¹è±¡ã€‚ä¿®æ”¹VuexTest.vueä¸­çš„ä»£ç å¦‚ä¸‹ï¼š

```
<template>
  <div>
    <input v-model="text"/>
    <br> <br>
    <button v-on:click="changeMsg">å•å‡»æ›´æ”¹æ¶ˆæ¯</button>
  </div>
</template>

<script>
export default {
  name: 'VuexTest',
  data () {
    return {
      text: ''
    }
  },
  methods: {
    // å®šä¹‰ä¿®æ”¹æ–¹æ³•
    changeMsg: function () {
      // å¼‚æ­¥å¤„ç†
      this.$store.dispatch('setMessage', this.text)
    }
  }
}
</script>

<style scoped>

</style>
```



Actionçš„ç‰¹æ€§æ˜¯å¯ä»¥å¼‚æ­¥æ‰§è¡Œä»£ç ã€‚

![](../_static/image-20220301152317675.png)



### 1.5 Vuexæ¨¡å—çš„åˆ’åˆ†

å¤§å‹é¡¹ç›®ä¸­ä¼šäº§ç”Ÿå¤§é‡çš„æ•°æ®éœ€è¦é€šè¿‡storeç®¡ç†ï¼Œæ¯æ¡æ•°æ®æœ¬èº«è‡³å°‘æ‹¥æœ‰ä¸€ä¸ªMutationåŠæ›´å¤šçš„Getterå¯¹è±¡ï¼Œè¿™è®©æ•´ä¸ªStateå˜å¾—å¼‚å¸¸åºå¤§ã€‚Moduleå¯¹è±¡å°±æ˜¯ä¸ºäº†è§£å†³å¯¹è±¡è¿‡å¤§çš„é—®é¢˜è€Œç”Ÿã€‚



Vuexå…è®¸å°†storeåˆ†å‰²ä¸ºæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—å¯ä»¥æ‹¥æœ‰è‡ªèº«çš„stateã€Mutationå’ŒActionï¼Œç”šè‡³æ˜¯æ›´å°çš„ç»†åˆ†æ¨¡å—ã€‚

åªéœ€è¦åœ¨Moduleså¯¹è±¡ä¸­æ·»åŠ éœ€è¦ä½¿ç”¨çš„æ¨¡å—ï¼Œå¹¶å°†æ‰€æœ‰çš„å­æ¨¡å—æ³¨å†Œåœ¨å…¨å±€ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å°†æ‰€æœ‰çš„æ•°æ®å¯¹è±¡è¿›è¡Œæ¨¡å—åŒ–åœ°åˆ†ç±»ï¼Œä½¿æ•´ä¸ªé€»è¾‘ä»£ç æ›´åŠ ç®€æ´ã€‚ä¾‹å¦‚ï¼š

```
import { createStore } from 'vuex'

export default createStore({
  state: {
    message: 'è¿™æ˜¯æµ‹è¯•'
  },
  mutations: {
    // set()æ–¹æ³•ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œç±»ä¼¼äºäº‹ä»¶æ³¨å†Œ
    setMessage (state, msg) {
      state.message = msg
    }
  },
  getters: {
    set_prefix: state => {
      return 'æœ€æ–°æ¶ˆæ¯:' + state.message
    }
  },
  actions: {
    setMessage (context, msg) {
      context.commit('setMessage', msg)
    }
  },
  modules: {
    a: moduleA,
    b: moduleB
  }
})
```

å‚è€ƒæ–‡çŒ®ï¼š

https://www.e-learn.cn/topic/1805138



> æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—å†…éƒ¨çš„Actionã€Mutationå’ŒGetteræ˜¯æ³¨å†Œåœ¨å…¨å±€å‘½åç©ºé—´å†…çš„ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ namespaced:trueçš„æ–¹å¼ä½¿æ¨¡å—å†…éƒ¨çš„actionã€mutationå’Œgetteræˆä¸ºå¸¦å‘½åç©ºé—´çš„æ¨¡å—ï¼Œé€šè¿‡å‘½åç©ºé—´çš„ä¸åŒè¿›è¡ŒåŒºåˆ†å’Œè°ƒç”¨ã€‚

## 2. Pinia

### 1.å®‰è£…

> ä½¿ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å·¥å…·å®‰è£…pinia

```
yarn add pinia
# æˆ–è€…ä½¿ç”¨ npm
npm install pinia
```

>å¼•å…¥åˆ°mian.jsä¸­
>
>vue3

```
// createPinia æ˜¯ä¸€ä¸ªå‡½æ•°
import { createPinia } from 'pinia'

app.use(createPinia())
```

### 2.åˆ›å»ºstore

`store`ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªå…¬å…±æ•°æ®ä»“åº“ï¼Œ æˆ‘ä»¬æŠŠæ•°æ®æ”¾åœ¨`store`ä¸­ï¼Œ å…¶ä»–æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹ã€‚

åˆ›å»ºä¸€ä¸ªç”¨æˆ·store

> /src/store/user.ts

```
import { defineStore } from 'pinia'

// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åº”ç”¨ç¨‹åºä¸­ store çš„å”¯ä¸€ id
// ç¬¬äºŒå‚æ•°æ˜¯options (é…ç½®é¡¹)
// å‘½åè§„èŒƒ use + ç›¸å…³åè¯ + Store
export const useUserStore = defineStore('main', {
  // other options...
})
```

åˆ›å»º`defineStore`å¾ˆç®€å•ï¼Œ æ¥æ”¶å‘½åä¸º `use + ç›¸å…³åè¯ + Store`, ç¬¬ä¸€å‚æ•°ä¸ºå”¯ä¸€idï¼Œ ç¬¬äºŒä¸ªå‚æ•°ä¸ºé…ç½®é¡¹ã€‚

### 3.æ·»åŠ store

> /src/store/user.ts

```
import { defineStore } from 'pinia'

export const useUserStore = defineStore('main', {
  //stateæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ è¿”å›çš„æ˜¯å¯¹åº”æ•°æ®
  state: () => ({
    name: 'shenxiu',
    age: 20,
    sex: 'male',
    qSkill: 'æ–©é’¢é—ª'
  }),
  getters: {
    // ç®­å¤´å‡½æ•° æ¨è
    getAddAge: (state) => {
      return state.age * 2 + 10
    },
    getIsAge: (state) => {
      return (num, number) => {
        return state.age = num
      }
    },
    // ç®­å¤´å‡½æ•°å†™æ³•--ä¸æ¥æ”¶å‚æ•°
    getYasuoInfoNoParams: state => `${state.name}ï¼ŒqæŠ€èƒ½å«åš${state.qSkill}`,

    // ç®­å¤´å‡½æ•°å†™æ³•--æ¥æ”¶å‚æ•°
    getYasuoInfoHaveParams: state => {
      // console.log(this)  //ä½¿ç”¨ç®­å¤´å‡½æ•°çš„è¯ï¼Œè¿™ä¸ªåœ°æ–¹çš„thisæ˜¯æ— æ•ˆçš„ å¯ä»¥é€šè¿‡state.å…¶ä»–gettersçš„åç§° æ¥è®¿é—®åˆ«çš„getters
      return (params) => `${state.name}ï¼ŒqæŠ€èƒ½å«åš${state.qSkill}ï¼Œ${params}`
    },

    // æ™®é€šå‡½æ•°å†™æ³•--ä¸æ¥æ”¶å‚æ•°
    getYasuoInfoNoParams1(state) {
      // console.log(this)  //åœ¨æ­¤å¤„this å’Œ stateçš„å€¼æ˜¯ä¸€æ ·çš„  å¯ä»¥é€šè¿‡this/state.å…¶ä»–gettersçš„åç§° æ¥è®¿é—®åˆ«çš„getters
      // console.log(state)
      return `${this.name}ï¼ŒqæŠ€èƒ½å«åš${this.qSkill}`
    },
    // æ™®é€šå‡½æ•°å†™æ³•--æ¥æ”¶å‚æ•°
    getYasuoInfoHaveParams1(state) {
      return function (params) {
        return `${state.name}ï¼ŒqæŠ€èƒ½å«åš${state.qSkill}ï¼Œ${params}`
      }
    },
  },
  actions: {
    // æ¯”å¦‚å‘é€token è¯·æ±‚tokençš„åº”ç”¨åœºæ™¯
    changeName(name,string) {
      this.name = name
    }
  }
})

```

### 4.ä½¿ç”¨storeã€Gettersã€Action å±æ€§

> /src/App.vue

```
<template>
<p>è¿™æ˜¯pinia-vue3æ•™ç¨‹ç•Œé¢!</p>

  <div class="content">
    <p>storeç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªå…¬å…±æ•°æ®ä»“åº“ï¼Œ æˆ‘ä»¬æŠŠæ•°æ®æ”¾åœ¨storeä¸­ï¼Œ å…¶ä»–æ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥è®¿é—®å’Œä¿®æ”¹ã€‚</p>
    <p>{{ name }}</p>
    <p>{{ age }}</p>
    <p>{{ sex }}</p>
    <el-button size="small" @click="changeName">ä¿®æ”¹å§“å</el-button>
    <el-button size="small" @click="patchStore">æ‰¹é‡ä¿®æ”¹</el-button>
    <el-button size="small" @click="resetStore">é‡ç½®çŠ¶æ€</el-button>

    <!--    ä½¿ç”¨getters-->
    <p>Getter å®Œå…¨ç­‰åŒäº Store çŠ¶æ€çš„ è®¡ç®—å€¼ã€‚ å®ƒä»¬å¯ä»¥ç”¨ defineStore() ä¸­çš„ getters å±æ€§å®šä¹‰ã€‚</p>
    <p>---------------------ä½¿ç”¨getters------------------</p>
    <p>{{ store.getAddAge }}</p>
    <p>---------------------getterä¼ å‚--------------------</p>
    <p>{{ modifyage }}</p>
    <div>
      {{ yasuoInfoNoParams }}
    </div>
    <div>
      {{ yasuoInfoHaveParams }}
    </div>
    <div>
      {{ yasuoInfoNoParams1 }}
    </div>
    <div>
      {{ yasuoInfoHaveParams1 }}
    </div>
    <p>Actions ç›¸å½“äºç»„ä»¶ä¸­çš„ methodsã€‚ å®ƒä»¬å¯ä»¥ä½¿ç”¨ defineStore() ä¸­çš„ actions å±æ€§å®šä¹‰ï¼Œå¹¶ä¸”å®ƒä»¬éå¸¸é€‚åˆå®šä¹‰ä¸šåŠ¡é€»è¾‘ã€‚</p>
    <p>æ¯”å¦‚å‘é€token è¯·æ±‚tokençš„åº”ç”¨åœºæ™¯</p>
    <p>ä½¿ç”¨ actions</p>
    <el-button @click="setToken">å‘é€tokenä¿®æ”¹nameçš„å€¼</el-button>
  </div>

</template>

<script>
import { storeToRefs } from "pinia";
import { useUserStore } from "@/store/pinia";
import {computed} from "vue";
export default {
  setup() {
    const store = useUserStore();
    const yasuoInfoNoParams = computed(() => store.getYasuoInfoNoParams)
    const yasuoInfoHaveParams = computed(() => store.getYasuoInfoHaveParams('ræŠ€èƒ½å«åšç‹‚é£ç»æ¯æ–©'))
    const yasuoInfoNoParams1 = computed(() => store.getYasuoInfoNoParams1)
    const yasuoInfoHaveParams1 = computed(() => store.getYasuoInfoHaveParams1('ræŠ€èƒ½å«åšç‹‚é£ç»æ¯æ–©'))
    const modifyage = computed(() => store.getIsAge(2))

    //storeToRefs å°†storeé‡Œé¢çš„å€¼è½¬åŒ–ä¸ºå“åº”å¼
    const { name, age, sex } = storeToRefs(store);

    const setToken = () => {
      store.changeName("zhangsan");
    }

    //ç›´æ¥ä¿®æ”¹
    const changeName = () => {
      store.name = "zhangsan";
    }
    //æ‰¹é‡ä¿®æ”¹
    const patchStore = () => {
      store.$patch({
        name: "lihua",
        age: 18,
        sex: "female",
      });
    }
    // é‡ç½®åˆ°åŸå§‹çŠ¶æ€
    const resetStore = () => {
      const store = useUserStore()
      store.$reset()
    }
    return {
      name,
      age,
      sex,
      store,
      changeName,
      patchStore,
      resetStore,
      modifyage,
      yasuoInfoNoParams,
      yasuoInfoHaveParams,
      yasuoInfoNoParams1,
      yasuoInfoHaveParams1,
      setToken
    }
  }
}
</script>

<style scoped>

</style>
```





åœ¨Vue3é¡¹ç›®ä¸­ä½¿ç”¨piniaä»£æ›¿Vuexè¿›è¡Œæ•°æ®å­˜å‚¨

https://www.cnblogs.com/wuhuacong/archive/2022/04/08/16117968.html






pinia-vue3æ•™ç¨‹

https://zhushenxiu.site/2022/08/10/vue/pinia/

https://www.cnblogs.com/zhaord/p/16187429.html





Pinia ä¸­æ–‡æ–‡æ¡£

https://pinia.web3doc.top/



## 3.Vuex VS Pinia

å¼€å‘å¤§ä¸­å‹é¡¹ç›®çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ°çŠ¶æ€ç®¡ç†å™¨ã€‚Vuex ä¸“é—¨ä¸º Vue.js æ‰“é€ ï¼Œæ˜“å­¦æ˜“ç”¨ã€‚



é‚£ä¹ˆ PiniağŸ å¯¹æ¯” Vuex æœ‰ä»€ä¹ˆä¼˜åŠ¿å‘¢ï¼Ÿ

1. æ›´å¥½çš„ TS æ”¯æŒ
2. æ›´åŠ è½»é‡ï¼Œå‹ç¼©ååªæœ‰ 1KB
3. å»é™¤äº† mutationã€‚ä½¿ç”¨  async + await  å¤„ç†åŒæ­¥é—®é¢˜
4. æ— éœ€æ‰‹åŠ¨æ·»åŠ  storeï¼Œåˆ›å»ºçš„ store ä¼šåœ¨ä½¿ç”¨æ—¶è‡ªåŠ¨æ·»åŠ 

ç¼ºç‚¹å°±æ˜¯**è¿˜å¾ˆæ–°**ï¼Œå¤„äºèµ·æ­¥é˜¶æ®µï¼Œç¤¾åŒºè¿˜æœ‰å¾…åŠ å¼ºã€‚



ğŸçš„å¼€å‘è€…æ˜¯ vuex çš„æ ¸å¿ƒæˆå‘˜ï¼Œæ‰€ä»¥ vueå®˜æ–¹ä¹Ÿæ¨èç”¨ ğŸ ä½œä¸ºæœªæ¥çŠ¶æ€ç®¡ç†å™¨çš„é¦–é€‰ã€‚



ğŸ·ï¸**ç»“è®º**ï¼šé€‰ç”¨ Pinia ä½œä¸ºçŠ¶æ€ç®¡ç†å™¨ã€‚





