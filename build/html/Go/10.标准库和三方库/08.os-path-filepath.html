<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>10.8. os/path/filepath &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="10.9. regexp" href="09.regexp.html" />
    <link rel="prev" title="10.7. time" href="07.time.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Python_go_Devops
            <img src="../../_static/python_go.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Go语言学习</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01.Go%E8%AF%AD%E8%A8%80%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/index.html">1. Go语言基本语法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02.%E5%AE%B9%E5%99%A8-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/index.html">2. 容器-数据结构</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/index.html">3. 流程控制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.%E5%87%BD%E6%95%B0/index.html">4. 函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05.%E7%BB%93%E6%9E%84%E4%BD%93/index.html">5. 结构体</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06.%E6%8E%A5%E5%8F%A3/index.html">6. 接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07.%E5%8C%85/index.html">7. 包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08.%E5%B9%B6%E5%8F%91/index.html">8. 并发</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09.%E5%8F%8D%E5%B0%84/index.html">9. 反射</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">10. 标准库和三方库</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01.strings.html">10.1. strings</a></li>
<li class="toctree-l3"><a class="reference internal" href="02.bytes.html">10.2. bytes</a></li>
<li class="toctree-l3"><a class="reference internal" href="03.fmt.html">10.3. fmt</a></li>
<li class="toctree-l3"><a class="reference internal" href="04.Json.html">10.4. Json</a></li>
<li class="toctree-l3"><a class="reference internal" href="05.strconv.html">10.5. strconv</a></li>
<li class="toctree-l3"><a class="reference internal" href="06.ioutil-bufio.html">10.6. ioutil/bufio</a></li>
<li class="toctree-l3"><a class="reference internal" href="07.time.html">10.7. time</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">10.8. os/path/filepath</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#os">10.8.1. 1.os</a></li>
<li class="toctree-l4"><a class="reference internal" href="#os-exec">10.8.2. 2.os/exec执行命令</a></li>
<li class="toctree-l4"><a class="reference internal" href="#path">10.8.3. 3.path</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filepath">10.8.4. 4.filepath</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id21">10.8.5. 5.os实践</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id47">10.8.6. 6.参考文献</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="09.regexp.html">10.9. regexp</a></li>
<li class="toctree-l3"><a class="reference internal" href="10.log.html">10.10. log</a></li>
<li class="toctree-l3"><a class="reference internal" href="11.reflect-unsafe.html">10.11. reflect/unsafe</a></li>
<li class="toctree-l3"><a class="reference internal" href="12.unicode.html">10.12. unicode</a></li>
<li class="toctree-l3"><a class="reference internal" href="13.flag%E5%92%8Cgo-flags.html">10.13. flag和go-flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="14.net-url.html">10.14. net/url</a></li>
<li class="toctree-l3"><a class="reference internal" href="15.sort.html">10.15. sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="16.net-http.html">10.16. net/http</a></li>
<li class="toctree-l3"><a class="reference internal" href="17.error.html">10.17. error</a></li>
<li class="toctree-l3"><a class="reference internal" href="18.template%E6%A8%A1%E6%9D%BF.html">10.18. template模板</a></li>
<li class="toctree-l3"><a class="reference internal" href="19.%E6%93%8D%E4%BD%9Cmysql.html">10.19. 操作mysql</a></li>
<li class="toctree-l3"><a class="reference internal" href="20.Go%E8%AF%AD%E8%A8%80%E5%B8%B8%E7%94%A8%E8%B5%84%E6%96%99%E5%8F%8A%E5%B7%A5%E5%85%B7%E8%AF%A6%E7%BB%86%E6%B1%87%E6%80%BB.html">10.20. Go语言常用资料及工具详细汇总</a></li>
<li class="toctree-l3"><a class="reference internal" href="21.Socket%E7%BD%91%E7%BB%9C.html">10.21. Socket网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="22.go%E6%A0%87%E5%87%86%E5%BA%93%E5%92%8C%E4%B8%89%E6%96%B9%E5%BA%93.html">10.22. go标准库和三方库</a></li>
<li class="toctree-l3"><a class="reference internal" href="23.cobra.html">10.23. cobra</a></li>
<li class="toctree-l3"><a class="reference internal" href="24.viper.html">10.24. viper</a></li>
<li class="toctree-l3"><a class="reference internal" href="25.math-rand.html">10.25. math-rand</a></li>
<li class="toctree-l3"><a class="reference internal" href="26.zap-%E6%97%A5%E5%BF%97%E6%A8%A1%E5%9D%97.html">10.26. zap-日志模块</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../11.%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81/index.html">11. 项目代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12.%E9%81%BF%E5%9D%91%E4%B8%8E%E6%8A%80%E5%B7%A7/index.html">12. 避坑与技巧</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Go_vs_Python/index.html">Go vs Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Python/index.html">Python全栈系列</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5/index.html">Python测试开发入门与实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Vue/index.html">Vue.js企业开发实战</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Vue_Node.js/index.html">Vue.js+Node.js开发实战</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Python_go_Devops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Go语言学习</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">10. </span>标准库和三方库</a> &raquo;</li>
      <li><span class="section-number">10.8. </span>os/path/filepath</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Go/10.标准库和三方库/08.os-path-filepath.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#os-path-filepath" id="id48">os/path/filepath</a></p>
<ul>
<li><p><a class="reference internal" href="#os" id="id49">1.os</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id50">1.1 文件操作</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id51">1.2 示例-文件操作</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id52">1.3 示例-三种读取文件方式的比较</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id53">1.4 示例-文件操作实战</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id54">1.5 示例-读取文件并输出重复的行数</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id55">1.6 速查表</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#os-exec" id="id56">2.os/exec执行命令</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id57">2.1 示例-执行命令</a></p></li>
<li><p><a class="reference internal" href="#goshell" id="id58">2.2 Go执行shell命令</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#path" id="id59">3.path</a></p>
<ul>
<li><p><a class="reference internal" href="#id16" id="id60">3.1目录操作</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#filepath" id="id61">4.filepath</a></p>
<ul>
<li><p><a class="reference internal" href="#id20" id="id62">4.1 示例-filepath常见操作</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id21" id="id63">5.os实践</a></p>
<ul>
<li><p><a class="reference internal" href="#id22" id="id64">1.操作系统基本命令</a></p></li>
<li><p><a class="reference internal" href="#id25" id="id65">2.创建、写入、打开、读取文件</a></p></li>
<li><p><a class="reference internal" href="#id32" id="id66">3.获取操作系统信息</a></p></li>
<li><p><a class="reference internal" href="#id36" id="id67">4.其他</a></p></li>
<li><p><a class="reference internal" href="#id41" id="id68">5.常用函数</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id47" id="id69">6.参考文献</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="os-path-filepath">
<h1><a class="toc-backref" href="#id48"><span class="section-number">10.8. </span>os/path/filepath</a><a class="headerlink" href="#os-path-filepath" title="Permalink to this headline">¶</a></h1>
<section id="os">
<h2><a class="toc-backref" href="#id49"><span class="section-number">10.8.1. </span>1.os</a><a class="headerlink" href="#os" title="Permalink to this headline">¶</a></h2>
<p>常见的关于操作系统的操作是文件系统的操作，比如读取目录、改变目录、创建文件、文件内容读取等。</p>
<p>绝大多数操作系统都是类UNIX操作系统，所以其文件系统也是类UNIX的文件信息。Linux就是类UNIX操作系统中的一种。Linux文件包含很多标识信息，比如所属组、属主、所属其他用户等。</p>
<p>Linux操作系统还提供了更改属性的相应操作。</p>
<p>chgrp：更改文件属组。</p>
<p>chown：更改文件属主。</p>
<p>chmod：更改文件的9个属性。</p>
<p><code class="docutils literal notranslate"><span class="pre">r：代表权限数字4。</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">w：代表权限数字2。</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">x：代表权限数字1。</span></code></p>
<p>比如更改文件属性：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">func</span> <span class="n">Getwd</span><span class="p">()</span> <span class="p">(</span><span class="nb">dir</span> <span class="n">string</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
<span class="n">func</span> <span class="n">Chdir</span><span class="p">(</span><span class="nb">dir</span> <span class="n">string</span><span class="p">)</span> <span class="n">error</span>
<span class="n">func</span> <span class="n">Chmod</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">mode</span> <span class="n">FileMode</span><span class="p">)</span> <span class="n">error</span>
<span class="n">func</span> <span class="n">Chown</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span> <span class="nb">int</span><span class="p">)</span> <span class="n">error</span>
</pre></div>
</div>
<p>内置库关于文件属性（读、写、可执行）的定义如下：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="p">(</span>
    <span class="c1">// Exactly one of O_RDONLY, O_WRONLY, or O_RDWR must be specified.</span>
    <span class="nx">O_RDONLY</span> <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_RDONLY</span> <span class="c1">// open the file read-only.</span>
    <span class="nx">O_WRONLY</span> <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_WRONLY</span> <span class="c1">// open the file write-only.</span>
    <span class="nx">O_RDWR</span>   <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_RDWR</span>   <span class="c1">// open the file read-write.</span>
    <span class="c1">// The remaining values may be or&#39;ed in to control behavior.</span>
    <span class="nx">O_APPEND</span> <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_APPEND</span> <span class="c1">// append data to the file when writing.</span>
    <span class="nx">O_CREATE</span> <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_CREAT</span>  <span class="c1">// create a new file if none exists.</span>
    <span class="nx">O_EXCL</span>   <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_EXCL</span>   <span class="c1">// used with O_CREATE, file must not exist.</span>
    <span class="nx">O_SYNC</span>   <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_SYNC</span>   <span class="c1">// open for synchronous I/O.</span>
    <span class="nx">O_TRUNC</span>  <span class="kt">int</span> <span class="p">=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">O_TRUNC</span>  <span class="c1">// truncate regular writable file when opened.</span>
<span class="p">)</span>
</pre></div>
</div>
<section id="id1">
<h3><a class="toc-backref" href="#id50">1.1 文件操作</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>对于文件和目录的操作，Go主要在os 提供了的相应函数：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">Mkdir</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">perm</span> <span class="nx">FileMode</span><span class="p">)</span> <span class="kt">error</span>
<span class="kd">func</span> <span class="nx">Chdir</span><span class="p">(</span><span class="nx">dir</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>
<span class="kd">func</span> <span class="nx">TempDir</span><span class="p">()</span> <span class="kt">string</span>
<span class="kd">func</span> <span class="nx">Rename</span><span class="p">(</span><span class="nx">oldpath</span><span class="p">,</span> <span class="nx">newpath</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>
<span class="kd">func</span> <span class="nx">Chmod</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">mode</span> <span class="nx">FileMode</span><span class="p">)</span> <span class="kt">error</span>

<span class="kd">func</span> <span class="nx">Open</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">OpenFile</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">O_RDONLY</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Create</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">OpenFile</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">O_RDWR</span><span class="p">|</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">O_TRUNC</span><span class="p">,</span> <span class="mo">0666</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">OpenFile</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">flag</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">perm</span> <span class="nx">FileMode</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">testlog</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">openFileNolog</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">flag</span><span class="p">,</span> <span class="nx">perm</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>对文件的操作，常用的还是关于文件的读写。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">type</span> <span class="n">File</span>
    <span class="n">func</span> <span class="n">Create</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">file</span> <span class="o">*</span><span class="n">File</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="n">Open</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">file</span> <span class="o">*</span><span class="n">File</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="n">OpenFile</span><span class="p">(</span><span class="n">name</span> <span class="n">string</span><span class="p">,</span> <span class="n">flag</span> <span class="nb">int</span><span class="p">,</span> <span class="n">perm</span> <span class="n">FileMode</span><span class="p">)</span> <span class="p">(</span><span class="n">file</span> <span class="o">*</span><span class="n">File</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="n">NewFile</span><span class="p">(</span><span class="n">fd</span> <span class="n">uintptr</span><span class="p">,</span> <span class="n">name</span> <span class="n">string</span><span class="p">)</span> <span class="o">*</span><span class="n">File</span>
    <span class="n">func</span> <span class="n">Pipe</span><span class="p">()</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span><span class="n">File</span><span class="p">,</span> <span class="n">w</span> <span class="o">*</span><span class="n">File</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Name</span><span class="p">()</span> <span class="n">string</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Stat</span><span class="p">()</span> <span class="p">(</span><span class="n">fi</span> <span class="n">FileInfo</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Fd</span><span class="p">()</span> <span class="n">uintptr</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Chdir</span><span class="p">()</span> <span class="n">error</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Chmod</span><span class="p">(</span><span class="n">mode</span> <span class="n">FileMode</span><span class="p">)</span> <span class="n">error</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Chown</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="n">gid</span> <span class="nb">int</span><span class="p">)</span> <span class="n">error</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Readdir</span><span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">)</span> <span class="p">(</span><span class="n">fi</span> <span class="p">[]</span><span class="n">FileInfo</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Readdirnames</span><span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">)</span> <span class="p">(</span><span class="n">names</span> <span class="p">[]</span><span class="n">string</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Truncate</span><span class="p">(</span><span class="n">size</span> <span class="n">int64</span><span class="p">)</span> <span class="n">error</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Read</span><span class="p">(</span><span class="n">b</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">ReadAt</span><span class="p">(</span><span class="n">b</span> <span class="p">[]</span><span class="n">byte</span><span class="p">,</span> <span class="n">off</span> <span class="n">int64</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Write</span><span class="p">(</span><span class="n">b</span> <span class="p">[]</span><span class="n">byte</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">WriteString</span><span class="p">(</span><span class="n">s</span> <span class="n">string</span><span class="p">)</span> <span class="p">(</span><span class="n">ret</span> <span class="nb">int</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">WriteAt</span><span class="p">(</span><span class="n">b</span> <span class="p">[]</span><span class="n">byte</span><span class="p">,</span> <span class="n">off</span> <span class="n">int64</span><span class="p">)</span> <span class="p">(</span><span class="n">n</span> <span class="nb">int</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Seek</span><span class="p">(</span><span class="n">offset</span> <span class="n">int64</span><span class="p">,</span> <span class="n">whence</span> <span class="nb">int</span><span class="p">)</span> <span class="p">(</span><span class="n">ret</span> <span class="n">int64</span><span class="p">,</span> <span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Sync</span><span class="p">()</span> <span class="p">(</span><span class="n">err</span> <span class="n">error</span><span class="p">)</span>
    <span class="n">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">File</span><span class="p">)</span> <span class="n">Close</span><span class="p">()</span> <span class="n">error</span>
</pre></div>
</div>
<p>可以看出，File具备Write和Read方法。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">//io库的两个基本接口为Reader和Writer。</span>

<span class="kd">type</span> <span class="nx">Reader</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">Read</span><span class="p">(</span><span class="nx">p</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Writer</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">Write</span><span class="p">(</span><span class="nx">p</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>因为接口Writer和Reader分别具有Write和Read方法，所以File实现了接口Writer和Reader。</p>
<p>在日常开发中，关于文件的读写经常调用ioutil库中的ReadFile和WriteFile函数。阅读源代码可以发现，其实底层就是在调用os.File相关的操作。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// ReadFile reads the named file and returns the contents.</span>
<span class="c1">// A successful call returns err == nil, not err == EOF.</span>
<span class="c1">// Because ReadFile reads the whole file, it does not treat an EOF from Read</span>
<span class="c1">// as an error to be reported.</span>
<span class="kd">func</span> <span class="nx">ReadFile</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">Open</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="kd">var</span> <span class="nx">size</span> <span class="kt">int</span>
    <span class="k">if</span> <span class="nx">info</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Stat</span><span class="p">();</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">size64</span> <span class="o">:=</span> <span class="nx">info</span><span class="p">.</span><span class="nx">Size</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">int64</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nx">size64</span><span class="p">))</span> <span class="o">==</span> <span class="nx">size64</span> <span class="p">{</span>
            <span class="nx">size</span> <span class="p">=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">size64</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">size</span><span class="o">++</span> <span class="c1">// one byte for final read at EOF</span>

    <span class="c1">// If a file claims a small size, read at least 512 bytes.</span>
    <span class="c1">// In particular, files in Linux&#39;s /proc claim size 0 but</span>
    <span class="c1">// then do not work right if read in small pieces,</span>
    <span class="c1">// so an initial read of 1 byte would not work correctly.</span>
    <span class="k">if</span> <span class="nx">size</span> <span class="p">&lt;</span> <span class="mi">512</span> <span class="p">{</span>
        <span class="nx">size</span> <span class="p">=</span> <span class="mi">512</span>
    <span class="p">}</span>

    <span class="nx">data</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">cap</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">:=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">data</span><span class="p">[:</span><span class="nb">cap</span><span class="p">(</span><span class="nx">data</span><span class="p">)],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nx">data</span> <span class="p">=</span> <span class="nx">d</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)]</span>
        <span class="p">}</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">):</span><span class="nb">cap</span><span class="p">(</span><span class="nx">data</span><span class="p">)])</span>
        <span class="nx">data</span> <span class="p">=</span> <span class="nx">data</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="o">+</span><span class="nx">n</span><span class="p">]</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
                <span class="nx">err</span> <span class="p">=</span> <span class="kc">nil</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">err</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>内置的bufio、ioutil和os库都支持文件的读写。</strong></p>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id51">1.2 示例-文件操作</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">OsUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 判断文件是否存在，获取文件信息</span>
    <span class="nx">fileMode</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="s">&quot;log.log&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fileMode</span><span class="p">.</span><span class="nx">Name</span><span class="p">(),</span> <span class="nx">fileMode</span><span class="p">.</span><span class="nx">Mode</span><span class="p">(),</span> <span class="nx">fileMode</span><span class="p">.</span><span class="nx">Size</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">OSUsageWith</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 创建文件，并以追加的方式写入内容</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">&quot;os.log&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">Name</span><span class="p">())</span>
    <span class="nx">file</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;Hello&quot;</span><span class="p">)</span>
    <span class="nx">file</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;HelloWorld&quot;</span><span class="p">)</span>
    <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="s">&quot;os.log&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>内置了打开和创建文件的两种快速操作：os.Open和os.Create，底层其实是os.OpenFile。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">Open</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">OpenFile</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">O_RDONLY</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">Create</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">OpenFile</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">O_RDWR</span><span class="p">|</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">O_TRUNC</span><span class="p">,</span> <span class="mo">0666</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id52">1.3 示例-三种读取文件方式的比较</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>file.Read 方式读文件</p></li>
<li><p>bufio 方式读文件</p></li>
<li><p>ioutil 方式读文件</p></li>
</ul>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;io/ioutil&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="cm">/*</span>
<span class="cm">file.Read 方式读文件</span>
<span class="cm">*/</span>
<span class="kd">func</span> <span class="nx">read1</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fi</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">fi</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">fi</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
            <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nx">n</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">bufio方式读文件</span>
<span class="cm">*/</span>
<span class="kd">func</span> <span class="nx">read2</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fi</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">fi</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="nx">r</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">fi</span><span class="p">)</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
            <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="nx">n</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">ioutil方式读文件</span>
<span class="cm"> */</span>
<span class="kd">func</span> <span class="nx">read3</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fi</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">fi</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">fi</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">file</span> <span class="o">:=</span> <span class="s">&quot;D:\\go_studay\\go_path\\src\\github.com\\medallion42\\IO操作\\system.log&quot;</span>
    <span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">read1</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
    <span class="nx">t1</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Cost time %v\n&quot;</span><span class="p">,</span> <span class="nx">t1</span><span class="p">.</span><span class="nx">Sub</span><span class="p">(</span><span class="nx">start</span><span class="p">))</span>

    <span class="nx">read2</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
    <span class="nx">t2</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Cost time %v\n&quot;</span><span class="p">,</span> <span class="nx">t2</span><span class="p">.</span><span class="nx">Sub</span><span class="p">(</span><span class="nx">t1</span><span class="p">))</span>

    <span class="nx">read3</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
    <span class="nx">t3</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Cost time %v\n&quot;</span><span class="p">,</span> <span class="nx">t3</span><span class="p">.</span><span class="nx">Sub</span><span class="p">(</span><span class="nx">t2</span><span class="p">))</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">Cost time 24.9336ms</span>
<span class="cm">Cost time 10.0036ms</span>
<span class="cm">Cost time 19.9605ms</span>
<span class="cm">*/</span>
</pre></div>
</div>
<blockquote>
<div><p>bufio &lt; ioutil &lt; file.Read <strong>bufio读同一文件耗费时间最少，
效果稳稳地保持在最佳。</strong></p>
</div></blockquote>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id53">1.4 示例-文件操作实战</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="cm">/*创建文件，同时写入数据</span>
<span class="cm">filename:写入文件名</span>
<span class="cm">info1:写入文件详细内容</span>
<span class="cm">*/</span>
<span class="kd">func</span> <span class="nx">Touch_File</span><span class="p">(</span><span class="nx">filename</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">info1</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_TRUNC</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span> <span class="mo">0666</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;open file failed, err:&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">err2</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">info1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err2</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;写入文件内容失败...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;写入文件成功....&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>

<span class="p">}</span>

<span class="cm">/*CopyFile 拷贝文件函数.</span>
<span class="cm">dstName:目标文件名称</span>
<span class="cm">srcName:源文件名称</span>
<span class="cm">*/</span>
<span class="kd">func</span> <span class="nx">CopyFile</span><span class="p">(</span><span class="nx">dstName</span><span class="p">,</span> <span class="nx">srcName</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">written</span> <span class="kt">int64</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 以读方式打开源文件</span>
    <span class="nx">src</span><span class="p">,</span> <span class="nx">err2</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">srcName</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err2</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;open %s failed, err:%v.\n&quot;</span><span class="p">,</span> <span class="nx">srcName</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">src</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="c1">// 以写|创建的方式打开目标文件</span>
    <span class="nx">dst</span><span class="p">,</span> <span class="nx">err3</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">dstName</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err3</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;open %s failed, err:%v.\n&quot;</span><span class="p">,</span> <span class="nx">dstName</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">dst</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">dst</span><span class="p">,</span> <span class="nx">src</span><span class="p">)</span> <span class="c1">//调用io.Copy()拷贝内容</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">path</span><span class="p">,</span> <span class="nx">erra</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">erra</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span><span class="nx">erra</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">pwd_file</span> <span class="o">:=</span> <span class="nx">path</span> <span class="o">+</span> <span class="s">&quot;\\day03\\sample07\\hujianli.txt&quot;</span>
    <span class="nx">Touch_File</span><span class="p">(</span><span class="nx">pwd_file</span><span class="p">,</span><span class="s">&quot;this is test file&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id54">1.5 示例-读取文件并输出重复的行数</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<section id="os-open">
<h4>1.os.open实现<a class="headerlink" href="#os-open" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">counts</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
    <span class="nx">files</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">countLines</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">,</span> <span class="nx">counts</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">arg</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">files</span> <span class="p">{</span>
            <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="s">&quot;dnp2: %v\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="p">}</span>
            <span class="nx">countLines</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">counts</span><span class="p">)</span>
            <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">n</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">counts</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d\t%s\n&quot;</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">line</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">countLines</span><span class="p">(</span><span class="nx">f</span> <span class="o">*</span><span class="nx">os</span><span class="p">.</span><span class="nx">File</span><span class="p">,</span> <span class="nx">counts</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">input</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewScanner</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">input</span><span class="p">.</span><span class="nx">Scan</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">counts</span><span class="p">[</span><span class="nx">input</span><span class="p">.</span><span class="nx">Text</span><span class="p">()]</span><span class="o">++</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="ioutil-readfile">
<h4>2.ioutil.ReadFile实现<a class="headerlink" href="#ioutil-readfile" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io/ioutil&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">counts</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">filename</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stderr</span><span class="p">,</span> <span class="s">&quot;dup3: %v\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">line</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">counts</span><span class="p">[</span><span class="nx">line</span><span class="p">]</span><span class="o">++</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">n</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">counts</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="p">&gt;</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%d\t%s\n&quot;</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">line</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id6">
<h3><a class="toc-backref" href="#id55">1.6 速查表</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Hostname</span><span class="p">())</span>             <span class="c1">//bogon &lt;nil&gt;(返回内核提供的主机名)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getpagesize</span><span class="p">())</span>          <span class="c1">//4096(返回底层的系统内存页的尺寸)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Environ</span><span class="p">())</span>              <span class="c1">//(环境变量的格式为&quot;key=value&quot;的字符串的切片拷贝)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOPATH&quot;</span><span class="p">))</span>       <span class="c1">//(名为key的环境变量的值,不存在返回空)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Setenv</span><span class="p">(</span><span class="s">&quot;Name&quot;</span><span class="p">,</span> <span class="s">&quot;Nick&quot;</span><span class="p">))</span> <span class="c1">//(设置名为key的环境变量)</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">Clearenv</span><span class="p">()</span>    <span class="c1">//(删除所有环境变量)</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>       <span class="c1">//(以给出的状态码code退出,程序会立刻终止，defer的函数不会被执行)</span>

<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getuid</span><span class="p">())</span>    <span class="c1">//501(调用者的用户ID)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Geteuid</span><span class="p">())</span>   <span class="c1">//501(调用者的有效用户ID)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getgid</span><span class="p">())</span>    <span class="c1">//20(调用者的组ID)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getegid</span><span class="p">())</span>   <span class="c1">//20(调用者的有效组ID)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getgroups</span><span class="p">())</span> <span class="c1">//[20 701 12 61 79 80 81 ...](调用者所属的所有用户组的组ID)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getpid</span><span class="p">())</span>    <span class="c1">//62027(调用者所在进程的进程ID)</span>
<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getppid</span><span class="p">())</span>   <span class="c1">//62020(调用者所在进程的父进程的进程ID)</span>

<span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">())</span>                      <span class="c1">//返回一个对应当前工作目录的根路径</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">Chdir</span><span class="p">(</span><span class="s">&quot;/tmp/&quot;</span><span class="p">)</span>                            <span class="c1">//将当前工作目录修改为dir指定的目录</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">Mkdir</span><span class="p">(</span><span class="s">&quot;/tmp/test&quot;</span><span class="p">,</span> <span class="mo">0666</span><span class="p">)</span>                  <span class="c1">//用指定的权限和名称创建一个目录</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">MkdirAll</span><span class="p">(</span><span class="s">&quot;/tmp/test1/test2/test3&quot;</span><span class="p">,</span> <span class="mo">0666</span><span class="p">)</span>  <span class="c1">//使用指定的权限和名称创建一个目录,递归上级目录</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">Rename</span><span class="p">(</span><span class="s">&quot;/tmp/test&quot;</span><span class="p">,</span> <span class="s">&quot;/tmp/test1/testNew&quot;</span><span class="p">)</span> <span class="c1">//修改一个文件的名字，移动一个文件</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">&quot;/tmp/test1/test2/test3&quot;</span><span class="p">)</span>          <span class="c1">//删除name指定的文件或目录</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">RemoveAll</span><span class="p">(</span><span class="s">&quot;/tmp/test1/&quot;</span><span class="p">)</span>                  <span class="c1">//删除path指定的文件</span>

<span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="s">&quot;/tmp/test&quot;</span><span class="p">)</span>      <span class="c1">//0666,创建文件,存在会清空</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;/tmp/test&quot;</span><span class="p">)</span>        <span class="c1">//O_RDONLY,打开一个文件</span>
<span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="s">&quot;/tmp/test&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span> <span class="mo">0666</span><span class="p">)</span>

<span class="c1">// Args保管了命令行参数，第一个是程序名。</span>
</pre></div>
</div>
</section>
</section>
<section id="os-exec">
<h2><a class="toc-backref" href="#id56"><span class="section-number">10.8.2. </span>2.os/exec执行命令</a><a class="headerlink" href="#os-exec" title="Permalink to this headline">¶</a></h2>
<p>如何执行操作系统命令？</p>
<p>比如用户在Linux操作系统中经常需要在终端下执行命令，如何使用编程语言实现在终端下执行命令的效果？</p>
<p>os/exec库提供了这样的功能，可以在代码中执行命令，再进行后续操作，比如根据执行命令的结果再执行其他操作等。</p>
<img alt="../../_images/image-20220706174924414.png" src="../../_images/image-20220706174924414.png" />
<p>exec库提供的操作</p>
<p>os/exec库就是用来执行命令的，通常有如下两种用法：</p>
<p>（1）查找命令的目录。</p>
<p>（2）执行命令。</p>
<section id="id7">
<h3><a class="toc-backref" href="#id57">2.1 示例-执行命令</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 执行命令</span>
<span class="kd">func</span> <span class="nx">OSExecUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dockerPath</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">LookPath</span><span class="p">(</span><span class="s">&quot;docker&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">dockerPath</span><span class="p">)</span> <span class="c1">// /bin/docker</span>

    <span class="nx">pwdPath</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">LookPath</span><span class="p">(</span><span class="s">&quot;pwd&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">pwdPath</span><span class="p">)</span> <span class="c1">// /bin/pwd</span>

    <span class="c1">// 1</span>
    <span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;docker&quot;</span><span class="p">,</span> <span class="s">&quot;ps&quot;</span><span class="p">)</span>
    <span class="nx">stdout</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">StdoutPipe</span><span class="p">()</span>
    <span class="nx">cmd</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
    <span class="nx">opBytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">stdout</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Dir</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">opBytes</span><span class="p">))</span>

    <span class="c1">// 2</span>
    <span class="nx">pwd</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nx">cmd2</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ls&quot;</span><span class="p">,</span> <span class="nx">pwd</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">buf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">buf</span>
    <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>

    <span class="c1">// 3</span>
    <span class="nx">cmd3</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;cat&quot;</span><span class="p">,</span> <span class="s">&quot;log.log&quot;</span><span class="p">)</span>
    <span class="nx">out</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cmd3</span><span class="p">.</span><span class="nx">Output</span><span class="p">()</span>
    <span class="c1">//out2, _ := cmd3.CombinedOutput()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">out</span><span class="p">))</span>

    <span class="c1">// 4</span>
    <span class="nx">cmd4</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;sh&quot;</span><span class="p">,</span> <span class="s">&quot;os.sh&quot;</span><span class="p">)</span>
    <span class="nx">out4</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cmd4</span><span class="p">.</span><span class="nx">CombinedOutput</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">out4</span><span class="p">))</span>

<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>LookPath：搜索命令的路径，类似linux中的which命令，如果报错，就表示路径不存在。</p></li>
<li><p>exec.Command：实例化结构体exec.Cmd，一般的实例化都是以New_X开头的。</p></li>
<li><p>Cmd.Run和Cmd.Start方法可用来执行命令，主要区别是Run会等待命令执行完毕。</p></li>
<li><p>Cmd.CombinedOutput()和Cmd.Output()可以直接得到命令执行的结果。</p></li>
</ul>
<p>同样，支持将执行命令的结果输出到指定的目标或设备，例如将Cmd.Stdout用于赋值操作：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 1</span>
<span class="nx">pwd</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
<span class="nx">cmd2</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ls&quot;</span><span class="p">,</span> <span class="nx">pwd</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">buf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
<span class="nx">cmd2</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">buf</span>


<span class="c1">// 5</span>
<span class="nx">cmd5</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ls&quot;</span><span class="p">,</span> <span class="nx">pwd</span><span class="p">)</span>
<span class="nx">stdout5</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">cmd5</span><span class="p">.</span><span class="nx">StdoutPipe</span><span class="p">()</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd5</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">bytes</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">ReadAll</span><span class="p">(</span><span class="nx">stdout5</span><span class="p">)</span>

<span class="nx">err</span> <span class="p">=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="s">&quot;file.log&quot;</span><span class="p">,</span> <span class="nx">bytes</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>支持外部命令的操作大概就是这些，开发者可以根据自己的需求选择合适的方法。</p>
<section id="id8">
<h4>2.1.1 执行命令不获取返回结果<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>直接调用 Cmd 对象的 Run
函数，返回的只有成功和失败，获取不到任何输出的结果。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ls&quot;</span><span class="p">,</span> <span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;/etc&quot;</span><span class="p">)</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id9">
<h4>2.2.2 执行命令获取返回结果<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p><strong>不区分stdout和stderr</strong></p>
<p>以调用 Cmd 的 CombinedOutput 函数可以获取命令的执行结果。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ls&quot;</span><span class="p">,</span> <span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;/etc1&quot;</span><span class="p">)</span>
    <span class="nx">result</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">CombinedOutput</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>区分stdout和stderr</strong></p>
<p>下面的执行命令的方式可以明确获得标准错误和标准输出。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// exec执行命令时不能识别下面这种写法的通配符,等同于shell命令行中:</span>
    <span class="c1">// ls -l &quot;/var/log/*.log&quot;</span>
    <span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ls&quot;</span><span class="p">,</span> <span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;/var/log/*.log&quot;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">stdout</span>
    <span class="nx">cmd</span><span class="p">.</span><span class="nx">Stderr</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">stderr</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
    <span class="nx">outStr</span><span class="p">,</span> <span class="nx">errStr</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">stdout</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">()),</span> <span class="nb">string</span><span class="p">(</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">())</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">outStr</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">errStr</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id10">
<h4>2.2.3 使用管道<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>将上一条命令的结果，做为下一跳命令的参数。作用类似于shell命令中的 |。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="c1">// 定义结构体,实现 io.Writer 接口</span>
<span class="kd">type</span> <span class="nx">result</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">data</span> <span class="p">[]</span><span class="kt">byte</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">result</span><span class="p">)</span> <span class="nx">Write</span><span class="p">(</span><span class="nx">p</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="nx">n</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span>
    <span class="nx">r</span><span class="p">.</span><span class="nx">data</span> <span class="p">=</span> <span class="nx">p</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">p</span><span class="p">),</span> <span class="nx">err</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">c1</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;grep&quot;</span><span class="p">,</span> <span class="s">&quot;libvirt&quot;</span><span class="p">,</span> <span class="s">&quot;/var/log/dpkg.log&quot;</span><span class="p">)</span>
    <span class="nx">c2</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;wc&quot;</span><span class="p">,</span> <span class="s">&quot;-l&quot;</span><span class="p">)</span>
    <span class="nx">r</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">result</span><span class="p">{}</span>
    <span class="nx">c2</span><span class="p">.</span><span class="nx">Stdin</span><span class="p">,</span> <span class="nx">_</span> <span class="p">=</span> <span class="nx">c1</span><span class="p">.</span><span class="nx">StdoutPipe</span><span class="p">()</span>
    <span class="nx">c2</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="nx">r</span>
    <span class="nx">_</span> <span class="p">=</span> <span class="nx">c2</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
    <span class="nx">_</span> <span class="p">=</span> <span class="nx">c1</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
    <span class="nx">_</span> <span class="p">=</span> <span class="nx">c2</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">data</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id11">
<h4>2.2.4 设置命令级别的环境变量<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>使用os库的Setenv函数来设置的环境变量，是作用于整个进程的生命周期。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">os</span><span class="p">.</span><span class="nx">Setenv</span><span class="p">(</span><span class="s">&quot;NAME&quot;</span><span class="p">,</span> <span class="s">&quot;Tom&quot;</span><span class="p">)</span>
    <span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;echo&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">ExpandEnv</span><span class="p">(</span><span class="s">&quot;$NAME&quot;</span><span class="p">))</span>
    <span class="nx">output</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">CombinedOutput</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">output</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="goshell">
<h3><a class="toc-backref" href="#id58">2.2 Go执行shell命令</a><a class="headerlink" href="#goshell" title="Permalink to this headline">¶</a></h3>
<section id="id12">
<h4>1.示例-执行单个命令<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>go执行shell示例1：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">out</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;date&quot;</span><span class="p">,</span><span class="s">&quot;+%F&quot;</span><span class="p">).</span><span class="nx">Output</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;The date is %s\n&quot;</span><span class="p">,</span> <span class="nx">out</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id13">
<h4>2.示例-执行多个命令<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<p>go执行shell示例2：</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
    <span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cmd</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;tr&quot;</span><span class="p">,</span> <span class="s">&quot;a-z&quot;</span><span class="p">,</span> <span class="s">&quot;A-Z&quot;</span><span class="p">)</span>
    <span class="nx">cmd</span><span class="p">.</span><span class="nx">Stdin</span> <span class="p">=</span> <span class="nx">strings</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="s">&quot;some input&quot;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">out</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">out</span>
    <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;in all caps: %q\n&quot;</span><span class="p">,</span> <span class="nx">out</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>


    <span class="nx">cmd2</span> <span class="o">:=</span><span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;uptime&quot;</span><span class="p">)</span>
    <span class="nx">cmd3</span> <span class="o">:=</span><span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;pwd&quot;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">out1</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="kd">var</span> <span class="nx">out2</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">out1</span>
    <span class="nx">cmd3</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">out2</span>
    <span class="nx">err2</span> <span class="o">:=</span><span class="nx">cmd2</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
    <span class="nx">err3</span> <span class="o">:=</span><span class="nx">cmd3</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err2</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err2</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err3</span> <span class="o">!=</span><span class="kc">nil</span><span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err3</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">out1</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">out2</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
<span class="p">}</span>
</pre></div>
</div>
<p>示例3</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cmd0</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;echo&quot;</span><span class="p">,</span><span class="s">&quot;-n&quot;</span><span class="p">,</span><span class="s">&quot;My first command comes form golang&quot;</span><span class="p">)</span>

    <span class="nx">stdout0</span><span class="p">,</span><span class="kt">error</span> <span class="o">:=</span> <span class="nx">cmd0</span><span class="p">.</span><span class="nx">StdoutPipe</span><span class="p">()</span>
    <span class="k">if</span> <span class="kt">error</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Could&#39;t obtain the stdout pipe for command NO.0: %s\n&quot;</span><span class="p">,</span><span class="kt">error</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd0</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span><span class="nx">err</span> <span class="o">!=</span><span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error : the command No.0 can not be startup: %s\n&quot;</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="c1">//output0 := make([]byte,100)</span>
    <span class="c1">//n,err1 := stdout0.Read(output0)</span>
    <span class="c1">//if err1 != nil {</span>
    <span class="c1">//  fmt.Printf(&quot;Error: Cloud&#39;t read data form the pipe: %s\n&quot;,err1)</span>
    <span class="c1">//  return</span>
    <span class="c1">//}</span>
    <span class="c1">//fmt.Printf(&quot;%s\n&quot;,output0[:n])</span>

    <span class="nx">outputBuf0</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">stdout0</span><span class="p">)</span>
    <span class="nx">output0</span><span class="p">,</span><span class="nx">_</span><span class="p">,</span><span class="nx">err</span> <span class="o">:=</span> <span class="nx">outputBuf0</span><span class="p">.</span><span class="nx">ReadLine</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Cloudn&#39;t read data from the pipe: %s\n&quot;</span><span class="p">,</span><span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s\n&quot;</span><span class="p">,</span><span class="nb">string</span><span class="p">(</span><span class="nx">output0</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id14">
<h4>3.示例-实现两条命令的管道功能<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>实现shell命令<code class="docutils literal notranslate"><span class="pre">ps</span> <span class="pre">aux|grep</span> <span class="pre">sshd</span></code></p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">cmd1</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ps aux&quot;</span><span class="p">)</span>
    <span class="nx">cmd2</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;grep sshd&quot;</span><span class="p">)</span>

    <span class="c1">// 设置cmd1的stdout字段，然后启动cmd1,并等待它运行完毕</span>
    <span class="kd">var</span> <span class="nx">outputBuf1</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd1</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">outputBuf1</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd1</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: The first command can not be startup %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd1</span><span class="p">.</span><span class="nx">Wait</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Couldn&#39;t wait for the first command:%s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="c1">// 设置cmd2的stdin和stdout字段，然后启动cmd2,并等待它运行完毕</span>
    <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Stdin</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">outputBuf1</span>
    <span class="kd">var</span> <span class="nx">outputBuf2</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">outputBuf2</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: The Second command can not be startup %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Wait</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Couldn&#39;t wait for the Second command:%s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s\n&quot;</span><span class="p">,</span><span class="nx">outputBuf2</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">())</span>

    <span class="c1">// 模拟出ps aux|grep sshd</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id15">
<h4>4.示例-封装为函数<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bufio&quot;</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">runCmd</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">()</span>
    <span class="nx">runCmdWithPipe</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">runCmdWithPipe</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Run command `ps aux | grep apipe`: &quot;</span><span class="p">)</span>
    <span class="nx">cmd1</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ps&quot;</span><span class="p">,</span> <span class="s">&quot;aux&quot;</span><span class="p">)</span>
    <span class="nx">cmd2</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;grep&quot;</span><span class="p">,</span> <span class="s">&quot;apipe&quot;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">outputBuf1</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd1</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">outputBuf1</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd1</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: The first command can not be startup %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd1</span><span class="p">.</span><span class="nx">Wait</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Couldn&#39;t wait for the first command: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Stdin</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">outputBuf1</span>
    <span class="kd">var</span> <span class="nx">outputBuf2</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">outputBuf2</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: The second command can not be startup: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd2</span><span class="p">.</span><span class="nx">Wait</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Couldn&#39;t wait for the second command: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s\n&quot;</span><span class="p">,</span> <span class="nx">outputBuf2</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">runCmd</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">useBufferedIO</span> <span class="o">:=</span> <span class="kc">false</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Run command `echo -n \&quot;My first command comes from golang.\&quot;`: &quot;</span><span class="p">)</span>
    <span class="nx">cmd0</span> <span class="o">:=</span> <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;echo&quot;</span><span class="p">,</span> <span class="s">&quot;-n&quot;</span><span class="p">,</span> <span class="s">&quot;My first command comes from golang.&quot;</span><span class="p">)</span>
    <span class="nx">stdout0</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd0</span><span class="p">.</span><span class="nx">StdoutPipe</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Couldn&#39;t obtain the stdout pipe for command No.0: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cmd0</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: The command No.0 can not be startup: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">!</span><span class="nx">useBufferedIO</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">outputBuf0</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
        <span class="k">for</span> <span class="p">{</span>
            <span class="nx">tempOutput</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">stdout0</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">tempOutput</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
                    <span class="k">break</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Couldn&#39;t read data from the pipe: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
                    <span class="k">return</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="nx">n</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="nx">outputBuf0</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">tempOutput</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s\n&quot;</span><span class="p">,</span> <span class="nx">outputBuf0</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">outputBuf0</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nx">NewReader</span><span class="p">(</span><span class="nx">stdout0</span><span class="p">)</span>
        <span class="nx">output0</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">outputBuf0</span><span class="p">.</span><span class="nx">ReadLine</span><span class="p">()</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error: Couldn&#39;t read data from the pipe: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;%s\n&quot;</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">output0</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;bytes&quot;</span>
    <span class="s">&quot;errors&quot;</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;os/exec&quot;</span>
    <span class="s">&quot;os/signal&quot;</span>
    <span class="s">&quot;runtime/debug&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
    <span class="s">&quot;strings&quot;</span>
    <span class="s">&quot;sync&quot;</span>
    <span class="s">&quot;syscall&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="nx">sendSignal</span><span class="p">()</span>
    <span class="p">}()</span>
    <span class="nx">handleSignal</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">handleSignal</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">sigRecv1</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">sigs1</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">{</span><span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGQUIT</span><span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Set notification for %s... [sigRecv1]\n&quot;</span><span class="p">,</span> <span class="nx">sigs1</span><span class="p">)</span>
    <span class="nx">signal</span><span class="p">.</span><span class="nx">Notify</span><span class="p">(</span><span class="nx">sigRecv1</span><span class="p">,</span> <span class="nx">sigs1</span><span class="o">...</span><span class="p">)</span>
    <span class="nx">sigRecv2</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">sigs2</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">{</span><span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGQUIT</span><span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Set notification for %s... [sigRecv2]\n&quot;</span><span class="p">,</span> <span class="nx">sigs2</span><span class="p">)</span>
    <span class="nx">signal</span><span class="p">.</span><span class="nx">Notify</span><span class="p">(</span><span class="nx">sigRecv2</span><span class="p">,</span> <span class="nx">sigs2</span><span class="o">...</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">wg</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">WaitGroup</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">sig</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">sigRecv1</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received a signal from sigRecv1: %s\n&quot;</span><span class="p">,</span> <span class="nx">sig</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;End. [sigRecv1]\n&quot;</span><span class="p">)</span>
        <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
    <span class="p">}()</span>
    <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nx">sig</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">sigRecv2</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Received a signal from sigRecv2: %s\n&quot;</span><span class="p">,</span> <span class="nx">sig</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;End. [sigRecv2]\n&quot;</span><span class="p">)</span>
        <span class="nx">wg</span><span class="p">.</span><span class="nx">Done</span><span class="p">()</span>
    <span class="p">}()</span>

    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Wait for 2 seconds... &quot;</span><span class="p">)</span>
    <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Stop notification...&quot;</span><span class="p">)</span>
    <span class="nx">signal</span><span class="p">.</span><span class="nx">Stop</span><span class="p">(</span><span class="nx">sigRecv1</span><span class="p">)</span>
    <span class="nb">close</span><span class="p">(</span><span class="nx">sigRecv1</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;done. [sigRecv1]\n&quot;</span><span class="p">)</span>
    <span class="nx">wg</span><span class="p">.</span><span class="nx">Wait</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">sendSignal</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nb">recover</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Fatal Error: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="nx">debug</span><span class="p">.</span><span class="nx">PrintStack</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}()</span>
    <span class="c1">// ps aux | grep &quot;signal&quot; | grep -v &quot;grep&quot; | grep -v &quot;go run&quot; | awk &#39;{print $2}&#39;</span>
    <span class="nx">cmds</span> <span class="o">:=</span> <span class="p">[]</span><span class="o">*</span><span class="nx">exec</span><span class="p">.</span><span class="nx">Cmd</span><span class="p">{</span>
        <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;ps&quot;</span><span class="p">,</span> <span class="s">&quot;aux&quot;</span><span class="p">),</span>
        <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;grep&quot;</span><span class="p">,</span> <span class="s">&quot;signal&quot;</span><span class="p">),</span>
        <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;grep&quot;</span><span class="p">,</span> <span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;grep&quot;</span><span class="p">),</span>
        <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;grep&quot;</span><span class="p">,</span> <span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;go run&quot;</span><span class="p">),</span>
        <span class="nx">exec</span><span class="p">.</span><span class="nx">Command</span><span class="p">(</span><span class="s">&quot;awk&quot;</span><span class="p">,</span> <span class="s">&quot;{print $2}&quot;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="nx">output</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">runCmds</span><span class="p">(</span><span class="nx">cmds</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Command Execution Error: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">pids</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">getPids</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;PID Parsing Error: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Target PID(s):\n%v\n&quot;</span><span class="p">,</span> <span class="nx">pids</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">pid</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">pids</span> <span class="p">{</span>
        <span class="nx">proc</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">FindProcess</span><span class="p">(</span><span class="nx">pid</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Process Finding Error: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="nx">sig</span> <span class="o">:=</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGQUIT</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Send signal &#39;%s&#39; to the process (pid=%d)...\n&quot;</span><span class="p">,</span> <span class="nx">sig</span><span class="p">,</span> <span class="nx">pid</span><span class="p">)</span>
        <span class="nx">err</span> <span class="p">=</span> <span class="nx">proc</span><span class="p">.</span><span class="nx">Signal</span><span class="p">(</span><span class="nx">sig</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Signal Sending Error: %s\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">getPids</span><span class="p">(</span><span class="nx">strs</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pids</span> <span class="p">[]</span><span class="kt">int</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">str</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">strs</span> <span class="p">{</span>
        <span class="nx">pid</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">Atoi</span><span class="p">(</span><span class="nx">strings</span><span class="p">.</span><span class="nx">TrimSpace</span><span class="p">(</span><span class="nx">str</span><span class="p">))</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
        <span class="p">}</span>
        <span class="nx">pids</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">pids</span><span class="p">,</span> <span class="nx">pid</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">pids</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="c1">// 返回进程ID列表</span>
<span class="kd">func</span> <span class="nx">runCmds</span><span class="p">(</span><span class="nx">cmds</span> <span class="p">[]</span><span class="o">*</span><span class="nx">exec</span><span class="p">.</span><span class="nx">Cmd</span><span class="p">)</span> <span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">cmds</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">||</span> <span class="nb">len</span><span class="p">(</span><span class="nx">cmds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;The cmd slice is invalid!&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">first</span> <span class="o">:=</span> <span class="kc">true</span>
    <span class="kd">var</span> <span class="nx">output</span> <span class="p">[]</span><span class="kt">byte</span>
    <span class="kd">var</span> <span class="nx">err</span> <span class="kt">error</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">cmd</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">cmds</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Run command: %v\n&quot;</span><span class="p">,</span> <span class="nx">getCmdPlaintext</span><span class="p">(</span><span class="nx">cmd</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">!</span><span class="nx">first</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">stdinBuf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
            <span class="nx">stdinBuf</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span>
            <span class="nx">cmd</span><span class="p">.</span><span class="nx">Stdin</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">stdinBuf</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">stdoutBuf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
        <span class="nx">cmd</span><span class="p">.</span><span class="nx">Stdout</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">stdoutBuf</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Start</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">getError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="p">=</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Wait</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">getError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">cmd</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">output</span> <span class="p">=</span> <span class="nx">stdoutBuf</span><span class="p">.</span><span class="nx">Bytes</span><span class="p">()</span>
        <span class="c1">//fmt.Printf(&quot;Output:\n%s\n&quot;, string(output))</span>
        <span class="k">if</span> <span class="nx">first</span> <span class="p">{</span>
            <span class="nx">first</span> <span class="p">=</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">lines</span> <span class="p">[]</span><span class="kt">string</span>
    <span class="kd">var</span> <span class="nx">outputBuf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">outputBuf</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">line</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">outputBuf</span><span class="p">.</span><span class="nx">ReadBytes</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
                <span class="k">break</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">getError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">lines</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">lines</span><span class="p">,</span> <span class="nb">string</span><span class="p">(</span><span class="nx">line</span><span class="p">))</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">lines</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">getCmdPlaintext</span><span class="p">(</span><span class="nx">cmd</span> <span class="o">*</span><span class="nx">exec</span><span class="p">.</span><span class="nx">Cmd</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">buf</span> <span class="nx">bytes</span><span class="p">.</span><span class="nx">Buffer</span>
    <span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">cmd</span><span class="p">.</span><span class="nx">Path</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">arg</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">cmd</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="p">{</span>
        <span class="nx">buf</span><span class="p">.</span><span class="nx">WriteRune</span><span class="p">(</span><span class="sc">&#39; &#39;</span><span class="p">)</span>
        <span class="nx">buf</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">arg</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">buf</span><span class="p">.</span><span class="nx">String</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">getError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">,</span> <span class="nx">cmd</span> <span class="o">*</span><span class="nx">exec</span><span class="p">.</span><span class="nx">Cmd</span><span class="p">,</span> <span class="nx">extraInfo</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">errMsg</span> <span class="kt">string</span>
    <span class="k">if</span> <span class="nx">cmd</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">errMsg</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s  [%s %v]&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="nx">cmd</span><span class="p">).</span><span class="nx">Path</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="nx">cmd</span><span class="p">).</span><span class="nx">Args</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">errMsg</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">extraInfo</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">errMsg</span> <span class="p">=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;%s (%v)&quot;</span><span class="p">,</span> <span class="nx">errMsg</span><span class="p">,</span> <span class="nx">extraInfo</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">errors</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="nx">errMsg</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>参考文献：</p>
<p><a class="reference external" href="http://golang.iswbm.com/en/latest/c05/c05_02.html">http://golang.iswbm.com/en/latest/c05/c05_02.html</a></p>
</section>
</section>
</section>
<section id="path">
<h2><a class="toc-backref" href="#id59"><span class="section-number">10.8.3. </span>3.path</a><a class="headerlink" href="#path" title="Permalink to this headline">¶</a></h2>
<section id="id16">
<h3><a class="toc-backref" href="#id60">3.1目录操作</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>关于文件系统的另一个比较重要的操作就是对目录的操作，文件都是置于某个目录下的。开发过程中对文件的操作都伴随着对文件所在目录的操作，比如获取当前目录、文件的目录、绝对路径、相对路径等。</p>
<p>在类UNIX操作系统下，路径都是以“/”分隔的，比如/Users/xiewei/go/src/GopherBook，关于Path的操作包括哪些呢？如图:</p>
<img alt="../../_images/image-20220706174103232.png" src="../../_images/image-20220706174103232.png" />
<p>path库提供的操作</p>
<section id="id17">
<h4>1.示例-目录操作<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">OSPathUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">dir</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Base</span><span class="p">(</span><span class="nx">dir</span><span class="p">))</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="nx">dir</span><span class="p">))</span>
    <span class="nx">parentDir</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="nx">dir</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">parentDir</span><span class="p">,</span> <span class="s">&quot;Chapter3&quot;</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>获取路径最后一个元素：Base。

获取文件路径：Dir。

将路径拆分和组合：Split、Join。

获取文件扩展名：Ext。
</pre></div>
</div>
<p>路径在本质上是一串带分隔符“/”的字符串，所以这些Base、Dir、Split和Join的函数是对包含特定特征“/”字符（分隔符）的字符串的操作。查看源代码进行验证亦是如此。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">Base</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">path</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;.&quot;</span>
    <span class="p">}</span>
    <span class="c1">// Strip trailing slashes.</span>
    <span class="k">for</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span> <span class="p">{</span>
        <span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="c1">// Find the last element</span>
    <span class="k">if</span> <span class="nx">i</span> <span class="o">:=</span> <span class="nx">lastSlash</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nx">path</span> <span class="p">=</span> <span class="nx">path</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="p">}</span>
    <span class="c1">// If empty now, it had only slashes.</span>
    <span class="k">if</span> <span class="nx">path</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;/&quot;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">path</span>
<span class="p">}</span>
</pre></div>
</div>
<p>由此可以看出，其实就是对字符串进行截取操作。</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">Join</span><span class="p">(</span><span class="nx">elem</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
    <span class="nx">size</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">e</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">elem</span> <span class="p">{</span>
        <span class="nx">size</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="p">}</span>
    <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">size</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">e</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">elem</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">e</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
                <span class="nx">buf</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">buf</span><span class="p">,</span> <span class="sc">&#39;/&#39;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nx">buf</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">buf</span><span class="p">,</span> <span class="nx">e</span><span class="o">...</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">Clean</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">buf</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
<p>同样可以看出是对字符串进行拼接的操作。</p>
<p>Windows下的目录格式和Linux下的目录格式有很大的不同，Path库只处理以“/”作为分隔符的路径操作。如果要对兼容操作系统执行路径操作，那么使用filepath，因为filepath几乎提供了相似的路径操作功能，基本可以完全替代path。</p>
<p>filepath提供了针对非Linux平台的3个函数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>VolumeName获取磁盘名称，比如Windows C盘。

ToSlash将路径分隔符“\\”转换为“/”分隔符。

FromSlash将“/”分隔符的路径转换为带“\\”的分隔符。
</pre></div>
</div>
<p>如何创建目录、删除目录、对目录进行遍历操作呢？</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>os.Mkdir/os.MkdirAll：创建目录。

os.Remove/os.RemoveAll：删除目录。

filepath.Walk：遍历目录。
</pre></div>
</div>
</section>
<section id="id18">
<h4>2.示例-目录遍历<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 遍历当前目录下的所有文件</span>
<span class="kd">func</span> <span class="nx">OSDirUsage</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">path</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nx">filepath</span><span class="p">.</span><span class="nx">Walk</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">info</span> <span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">info</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="c1">//fmt.Println(&quot;file:&quot;, info.Name(), &quot;in directory:&quot;, path)</span>

        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">})</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id19">
<h4>3.示例-path常见操作<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;path&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Path操作</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Path操作-----------------&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Base</span><span class="p">(</span><span class="s">&quot;http://www.baidu.com/file/aa.jpg&quot;</span><span class="p">))</span> <span class="c1">// aa.jpg</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Clean</span><span class="p">(</span><span class="s">&quot;c:\\file//abc///aa.jpg&quot;</span><span class="p">))</span>          <span class="c1">// c:\file/abc/aa.jpg</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">())</span>                                    <span class="c1">// E:\go_projects\go-gin-example\pkg\file &lt;nil&gt;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;http://www.baidu.com/aa/aaa.jpg&quot;</span><span class="p">))</span>   <span class="c1">// http:/www.baidu.com/aa</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;c:/a/b/c/d.txt&quot;</span><span class="p">))</span>                    <span class="c1">// c:/a/b/c</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;c:\\a/b.txt&quot;</span><span class="p">))</span>                       <span class="c1">// c:\a</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Ext</span><span class="p">(</span><span class="s">&quot;c:\\a/b.txt&quot;</span><span class="p">))</span>                       <span class="c1">// .txt</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">IsAbs</span><span class="p">(</span><span class="s">&quot;c:/wind/aa/bb/b.txt&quot;</span><span class="p">))</span>             <span class="c1">// false</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="s">&quot;c:&quot;</span><span class="p">,</span> <span class="s">&quot;aa&quot;</span><span class="p">,</span> <span class="s">&quot;bb&quot;</span><span class="p">,</span> <span class="s">&quot;cc.txt&quot;</span><span class="p">))</span>         <span class="c1">// c:/aa/bb/cc.txt</span>
    <span class="nx">isMatch</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">Match</span><span class="p">(</span><span class="s">&quot;c:/windows/*/&quot;</span><span class="p">,</span> <span class="s">&quot;c:/windows/system/&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">isMatch</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>                            <span class="c1">// true &lt;nil&gt;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="s">&quot;c:/windows/system/aaa.jpg&quot;</span><span class="p">))</span> <span class="c1">// c:/windows/system/ aaa.jpg</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="filepath">
<h2><a class="toc-backref" href="#id61"><span class="section-number">10.8.4. </span>4.filepath</a><a class="headerlink" href="#filepath" title="Permalink to this headline">¶</a></h2>
<section id="id20">
<h3><a class="toc-backref" href="#id62">4.1 示例-filepath常见操作</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;path/filepath&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">WalkFunc</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">info</span> <span class="nx">os</span><span class="p">.</span><span class="nx">FileInfo</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;File:&quot;</span><span class="p">,</span> <span class="nx">path</span><span class="p">,</span> <span class="s">&quot;IsDir:&quot;</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">(),</span> <span class="s">&quot;size:&quot;</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">Size</span><span class="p">())</span>
    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// FilePath操作</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;FilePath操作-----------------&quot;</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">IsAbs</span><span class="p">(</span><span class="s">&quot;c:\\wind\\aa\\bb\\b.txt&quot;</span><span class="p">))</span>                 <span class="c1">// true</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Abs</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">))</span>                                         <span class="c1">// E:\go_projects\go-gin-example\pkg\file &lt;nil&gt;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Base</span><span class="p">(</span><span class="s">&quot;c:\\aa\\baa.exe&quot;</span><span class="p">))</span>                          <span class="c1">// baa.exe</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Clean</span><span class="p">(</span><span class="s">&quot;c:\\\\aa/c\\baa.exe&quot;</span><span class="p">))</span>                     <span class="c1">// c:\aa\c\baa.exe</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Clean</span><span class="p">(</span><span class="s">&quot;aa/c\\baa.exe&quot;</span><span class="p">))</span>                           <span class="c1">// aa\c\baa.exe</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Dir</span><span class="p">(</span><span class="s">&quot;aa/c\\baa.exe&quot;</span><span class="p">))</span>                             <span class="c1">// aa\c</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">EvalSymlinks</span><span class="p">(</span><span class="s">&quot;./path.exe&quot;</span><span class="p">))</span>                       <span class="c1">//可以用来判断文件或文件夹是否存在。 //path.exe &lt;nil&gt;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Ext</span><span class="p">(</span><span class="s">&quot;./path.exe&quot;</span><span class="p">))</span>                                <span class="c1">// .exe</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">FromSlash</span><span class="p">(</span><span class="s">&quot;c:\\windows\\aa//bb/cc//path.exe&quot;</span><span class="p">))</span>    <span class="c1">// 将路径中的\\更换为/ c:\windows\aa\\bb\cc\\path.exe</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">ToSlash</span><span class="p">(</span><span class="s">&quot;c:\\windows\\aa/bb/cc/path.exe&quot;</span><span class="p">))</span>        <span class="c1">// 将路径中的/替换为\\  c:/windows/aa/bb/cc/path.exe</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">VolumeName</span><span class="p">(</span><span class="s">&quot;c:\\windows\\&quot;</span><span class="p">))</span>                      <span class="c1">// 获取卷标 c:</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Glob</span><span class="p">(</span><span class="s">&quot;c:\\windows\\*.exe&quot;</span><span class="p">))</span>                     <span class="c1">// 获取所有c:\\windows\\目录下exe文件</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">IsAbs</span><span class="p">(</span><span class="s">&quot;http://www.baidu.com/aa.jpg&quot;</span><span class="p">))</span>             <span class="c1">// false</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;\\bb\\&quot;</span><span class="p">,</span> <span class="s">&quot;cc&quot;</span><span class="p">,</span> <span class="s">&quot;/d&quot;</span><span class="p">,</span> <span class="s">&quot;e\\&quot;</span><span class="p">,</span> <span class="s">&quot;ff.txt&quot;</span><span class="p">))</span> <span class="c1">// a\bb\cc\d\e\ff.txt</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Match</span><span class="p">(</span><span class="s">&quot;c:/windows/*/&quot;</span><span class="p">,</span> <span class="s">&quot;c:/windows/system/&quot;</span><span class="p">))</span>     <span class="c1">// true &lt;nil&gt;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Rel</span><span class="p">(</span><span class="s">&quot;c:/windows&quot;</span><span class="p">,</span> <span class="s">&quot;c:/windows/system/&quot;</span><span class="p">))</span>       <span class="c1">// 取得第二参的路径中,相对于前面的路径的相对路径 system &lt;nil&gt;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Separator</span><span class="p">))</span>                                <span class="c1">// windows下返回 \</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">Split</span><span class="p">(</span><span class="s">&quot;c:/windows/system/abc.exe&quot;</span><span class="p">))</span>               <span class="c1">// c:/windows/system/ abc.exe</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">filepath</span><span class="p">.</span><span class="nx">SplitList</span><span class="p">(</span><span class="s">&quot;c:/windows/system/abc.exe&quot;</span><span class="p">))</span>           <span class="c1">// [c:/windows/system/abc.exe]</span>
    <span class="nx">filepath</span><span class="p">.</span><span class="nx">Walk</span><span class="p">(</span><span class="s">&quot;./&quot;</span><span class="p">,</span> <span class="nx">WalkFunc</span><span class="p">)</span>  <span class="c1">// 遍历目录</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id21">
<h2><a class="toc-backref" href="#id63"><span class="section-number">10.8.5. </span>5.os实践</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<p>os包提供了操作系统的系列函数，这些接口不依赖平台。设计为Unix风格的，错误处理是go风格的；调用失败会返回错误值而非错误码。通常错误值里包含更多信息。</p>
<p>os包的接口在所有操作系统中都是一致的。非公用的属性可以从操作系统特定的syscall包获取。</p>
<section id="id22">
<h3><a class="toc-backref" href="#id64">1.操作系统基本命令</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<section id="id23">
<h4>1.1 相关方法<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 获取当前工作目录的根路径</span>
<span class="kd">func</span> <span class="nx">Getwd</span><span class="p">()</span> <span class="p">(</span><span class="nx">dir</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>

<span class="c1">// 将工作目录修改为dir</span>
<span class="kd">func</span> <span class="nx">Chdir</span><span class="p">(</span><span class="nx">dir</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

<span class="c1">// 修改name文件或文件夹的权限（对应linux的chmod命令）</span>
<span class="kd">func</span> <span class="nx">Chmod</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">mode</span> <span class="nx">FileMode</span><span class="p">)</span> <span class="kt">error</span>

<span class="c1">// 修改name文件或文件夹的用户和组（对应linux的chmod命令）</span>
<span class="kd">func</span> <span class="nx">Chown</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">uid</span><span class="p">,</span> <span class="nx">gid</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">error</span>

<span class="c1">// 使用指定的权限和名称创建一个文件夹（对于linux的mkdir命令）</span>
<span class="kd">func</span> <span class="nx">Mkdir</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">perm</span> <span class="nx">FileMode</span><span class="p">)</span> <span class="kt">error</span>

 <span class="c1">// 使用指定的权限和名称创建一个文件夹，并自动创建父级目录（对于linux的mkdir -p目录）</span>
<span class="kd">func</span> <span class="nx">MkdirAll</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">perm</span> <span class="nx">FileMode</span><span class="p">)</span> <span class="kt">error</span>

<span class="c1">// 修改一个文件或文件夹的文字（对应linux的mv命令）</span>
<span class="kd">func</span> <span class="nx">Rename</span><span class="p">(</span><span class="nx">oldpath</span><span class="p">,</span> <span class="nx">newpath</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

<span class="c1">// 删除指定的文件夹或者目录  ,不能递归删除，只能删除一个空文件夹或一个文件（对应linux的 rm命令）</span>
<span class="kd">func</span> <span class="nx">Remove</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

 <span class="c1">// 递归删除文件夹或者文件（对应linux的rm -rf命令）</span>
<span class="kd">func</span> <span class="nx">RemoveAll</span><span class="p">(</span><span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>
</pre></div>
</div>
</section>
<section id="id24">
<h4>1.2 示例代码<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 为了减少代码的篇幅，基本所有的错误在这篇文字里面我都丢弃</span>
    <span class="nx">wd</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取当前工作目录的根路径:&quot;</span><span class="p">,</span> <span class="nx">wd</span><span class="p">)</span>

    <span class="nx">_</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Chdir</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">Join</span><span class="p">(</span><span class="nx">wd</span><span class="p">,</span> <span class="s">&quot;go_os/demo1&quot;</span><span class="p">))</span>
    <span class="nx">w</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取x修改后的当前工作目录的根路径:&quot;</span><span class="p">,</span> <span class="nx">w</span><span class="p">)</span>

    <span class="nx">_</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">MkdirAll</span><span class="p">(</span><span class="s">&quot;dirs/dir1&quot;</span><span class="p">,</span> <span class="mo">0777</span><span class="p">)</span>
    <span class="nx">_</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Mkdir</span><span class="p">(</span><span class="s">&quot;dirs/dir2&quot;</span><span class="p">,</span> <span class="mo">0777</span><span class="p">)</span>
    <span class="nx">_</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Rename</span><span class="p">(</span><span class="s">&quot;dirs/dir1&quot;</span><span class="p">,</span> <span class="s">&quot;dirs/dir3&quot;</span><span class="p">)</span>
    <span class="nx">_</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">&quot;dirs/dir2&quot;</span><span class="p">)</span>
    <span class="nx">_</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">RemoveAll</span><span class="p">(</span><span class="s">&quot;dirs&quot;</span><span class="p">)</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id25">
<h3><a class="toc-backref" href="#id65">2.创建、写入、打开、读取文件</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<section id="id26">
<span id="id27"></span><h4>2.1 相关方法<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span> <span class="c1">// 创建一个空文件，注意当文件已经存在时，会直接覆盖掉原文件，不会报错</span>
<span class="kd">func</span> <span class="nx">Create</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">file</span> <span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>

 <span class="c1">// 打开一个文件,注意打开的文件只能读，不能写</span>
<span class="kd">func</span> <span class="nx">Open</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">file</span> <span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>

 <span class="c1">// 以指定的权限打开文件</span>
<span class="kd">func</span> <span class="nx">OpenFile</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">flag</span> <span class="kt">int</span><span class="p">,</span> <span class="nx">perm</span> <span class="nx">FileMode</span><span class="p">)</span> <span class="p">(</span><span class="nx">file</span> <span class="o">*</span><span class="nx">File</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id28">
<h4>2.2 创建和写入文件<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">wd</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Create</span><span class="p">(</span><span class="nx">wd</span> <span class="o">+</span> <span class="s">&quot;/go_os/demo1/1.txt&quot;</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">Name</span><span class="p">())</span>
    <span class="nx">file_info</span><span class="p">,</span><span class="nx">_</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Stat</span><span class="p">()</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">file_info</span><span class="p">)</span>
    <span class="nx">_</span><span class="p">,</span><span class="nx">_</span> <span class="p">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">&quot;hello world！\n&quot;</span><span class="p">))</span>
    <span class="nx">_</span><span class="p">,</span><span class="nx">_</span> <span class="p">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="s">&quot;张亚飞&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id29">
<h4>2.3 追加文件<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span>  <span class="p">{</span>
    <span class="nx">wd</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">wd</span> <span class="o">+</span> <span class="s">&quot;/go_os/demo1/1.txt&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_RDWR</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_APPEND</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="c1">// 打开文件失败处理</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="p">}</span>
    <span class="nx">content</span> <span class="o">:=</span> <span class="s">&quot;\n写入的文件内容&quot;</span>
    <span class="nx">_</span><span class="p">,</span><span class="nx">_</span> <span class="p">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">content</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id30">
<h4>2.4 读取文件<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">main</span><span class="p">(){</span>
    <span class="nx">wd</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">wd</span> <span class="o">+</span> <span class="s">&quot;/go_os/demo1/1.txt&quot;</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">// 不要忘记关闭文件</span>
    <span class="nx">b</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="c1">// 文件内容不多，我们一次性读4个字节，多读几次，不一次性读完</span>
    <span class="kd">var</span> <span class="nx">str</span> <span class="kt">string</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span> <span class="c1">// EOF表示文件读取完毕</span>
                <span class="k">break</span> <span class="c1">// 退出</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">str</span> <span class="o">+=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">b</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span> <span class="c1">// 保存文件内容</span>
    <span class="p">}</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="c1">// 打印文件</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id31">
<h4>2.5 查看文件信息<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span>  <span class="p">{</span>
    <span class="nx">wd</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getwd</span><span class="p">()</span>

    <span class="nx">file</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">wd</span> <span class="o">+</span> <span class="s">&quot;/go_os/demo1/1.txt&quot;</span><span class="p">)</span> <span class="c1">// 以只读的方式打开文件</span>
    <span class="k">defer</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span> <span class="c1">// 不要忘记关闭文件</span>
    <span class="c1">// 获取文件的信息</span>
    <span class="nx">fInfo</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Stat</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;是否是一个目录:&quot;</span><span class="p">,</span> <span class="nx">fInfo</span><span class="p">.</span><span class="nx">IsDir</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;文件的修改时间:&quot;</span><span class="p">,</span> <span class="nx">fInfo</span><span class="p">.</span><span class="nx">ModTime</span><span class="p">().</span><span class="nx">String</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;文件的名字:&quot;</span><span class="p">,</span> <span class="nx">fInfo</span><span class="p">.</span><span class="nx">Name</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;文件的大小:&quot;</span><span class="p">,</span> <span class="nx">fInfo</span><span class="p">.</span><span class="nx">Size</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;文件的权限:&quot;</span><span class="p">,</span> <span class="nx">fInfo</span><span class="p">.</span><span class="nx">Mode</span><span class="p">().</span><span class="nx">String</span><span class="p">())</span>
    <span class="cm">/*</span>
<span class="cm">    是否是一个目录: false</span>
<span class="cm">    文件的修改时间: 2020-06-17 09:52:05.7987495 +0800 CST</span>
<span class="cm">    文件的名字: 1.txt</span>
<span class="cm">    文件的大小: 24</span>
<span class="cm">    文件的权限: -rw-rw-rw-</span>
<span class="cm">    */</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id32">
<h3><a class="toc-backref" href="#id66">3.获取操作系统信息</a><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<section id="id33">
<span id="id34"></span><h4>3.1 相关方法<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span> <span class="c1">// 获取主机名</span>
<span class="kd">func</span> <span class="nx">Hostname</span><span class="p">()</span> <span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span>

 <span class="c1">// 获取某个环境变量</span>
<span class="kd">func</span> <span class="nx">Getenv</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span>

<span class="c1">// 设置一个环境变量,失败返回错误，经测试当前设置的环境变量只在 当前进程有效（当前进程衍生的所以的go程都可以拿到，子go程与父go程的环境变量可以互相获取）；进程退出消失</span>
<span class="kd">func</span> <span class="nx">Setenv</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span>

 <span class="c1">// 删除当前程序已有的所有环境变量。不会影响当前电脑系统的环境变量，这些环境变量都是对当前go程序而言的</span>
<span class="kd">func</span> <span class="nx">Clearenv</span><span class="p">()</span>

<span class="c1">// 让当前程序以给出的状态码（code）退出。一般来说，状态码0表示成功，非0表示出错。程序会立刻终止，defer的函数不会被执行。</span>
<span class="kd">func</span> <span class="nx">Exit</span><span class="p">(</span><span class="nx">code</span> <span class="kt">int</span><span class="p">)</span>

<span class="c1">// 获取调用者的用户id</span>
<span class="kd">func</span> <span class="nx">Getuid</span><span class="p">()</span> <span class="kt">int</span>

 <span class="c1">// 获取调用者的有效用户id</span>
<span class="kd">func</span> <span class="nx">Geteuid</span><span class="p">()</span> <span class="kt">int</span>

 <span class="c1">// 获取调用者的组id</span>
<span class="kd">func</span> <span class="nx">Getgid</span><span class="p">()</span> <span class="kt">int</span>

 <span class="c1">// 获取调用者的有效组id</span>
<span class="kd">func</span> <span class="nx">Getegid</span><span class="p">()</span> <span class="kt">int</span>

<span class="c1">// 获取调用者所在的所有组的组id</span>
<span class="kd">func</span> <span class="nx">Getgroups</span><span class="p">()</span> <span class="p">([]</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>

 <span class="c1">// 获取调用者所在进程的进程id</span>
<span class="kd">func</span> <span class="nx">Getpid</span><span class="p">()</span> <span class="kt">int</span>

<span class="c1">// 获取调用者所在进程的父进程的进程id</span>
<span class="kd">func</span> <span class="nx">Getppid</span><span class="p">()</span> <span class="kt">int</span>
</pre></div>
</div>
</section>
<section id="id35">
<h4>3.2 代码实现<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span>  <span class="p">{</span>
    <span class="nx">hostname</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Hostname</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取主机名,&quot;</span><span class="p">,</span> <span class="nx">hostname</span><span class="p">)</span>

    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取gopath环境变量:&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOPATH&quot;</span><span class="p">))</span>

    <span class="nx">_</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Setenv</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">)</span> <span class="c1">// 设置环境变量</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取上一步设置的test环境变量:&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">))</span>

    <span class="nx">os</span><span class="p">.</span><span class="nx">Clearenv</span><span class="p">()</span> <span class="c1">// 清除当前程序的所以环境变量</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取清理后的环境变量test和GOPATH:&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;test&quot;</span><span class="p">),</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getenv</span><span class="p">(</span><span class="s">&quot;GOPATH&quot;</span><span class="p">))</span>

    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取调用者的用户id&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getuid</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取调用者的有效用户id&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Geteuid</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取调用者的组id&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getgid</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取调用者的有效组id&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getegid</span><span class="p">())</span>

    <span class="nx">sli</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getgroups</span><span class="p">()</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取调用者所在的所有组的组id&quot;</span><span class="p">,</span> <span class="nx">sli</span><span class="p">)</span> <span class="c1">//</span>

    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取调用者所在进程的进程id&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getpid</span><span class="p">())</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;获取调用者所在进程的父进程的进程id&quot;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Getppid</span><span class="p">())</span>
    <span class="cm">/*</span>
<span class="cm">    获取主机名, home-fei</span>
<span class="cm">    获取gopath环境变量: E:\go\project</span>
<span class="cm">    获取上一步设置的test环境变量: test</span>
<span class="cm">    获取清理后的环境变量test和GOPATH:</span>
<span class="cm">    获取调用者的用户id -1</span>
<span class="cm">    获取调用者的有效用户id -1</span>
<span class="cm">    获取调用者的组id -1</span>
<span class="cm">    获取调用者的有效组id -1</span>
<span class="cm">    获取调用者所在的所有组的组id [0/0]0x0</span>
<span class="cm">    获取调用者所在进程的进程id 4968</span>
<span class="cm">    获取调用者所在进程的父进程的进程id 11588</span>
<span class="cm">     */</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id36">
<h3><a class="toc-backref" href="#id67">4.其他</a><a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<section id="id37">
<span id="id38"></span><h4>4.1 相关方法<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="c1">// 退出系统进程</span>
<span class="nx">Exit</span><span class="p">()</span>

<span class="c1">// 判断字c是否是一个路径分隔符</span>
<span class="kd">func</span> <span class="nx">IsPathSeparator</span><span class="p">(</span><span class="nx">c</span> <span class="kt">uint8</span><span class="p">)</span> <span class="kt">bool</span>

<span class="c1">// 判断一个错误是否表示一个文件或文件夹是否已存在，ErrExist和一些系统调用错误会使它返回真。</span>
<span class="kd">func</span> <span class="nx">IsExist</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">bool</span>

<span class="c1">// 判断一个错误是否表示一个文件或文件夹是否不存在，ErrNotExist和一些系统调用错误会使它返回真。</span>
<span class="kd">func</span> <span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">bool</span>

<span class="c1">// 判断一个错误是否表示权限不足，ErrPermission和一些系统调用错误会使它返回真。</span>
<span class="kd">func</span> <span class="nx">IsPermission</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">bool</span>
</pre></div>
</div>
</section>
<section id="id39">
<span id="id40"></span><h4>4.2 示例代码<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">exit</span><span class="p">()</span>  <span class="p">{</span>
    <span class="c1">// 模拟条件</span>
    <span class="k">if</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="nb">println</span><span class="p">(</span><span class="s">&quot;程序启动失败，xxx条件不满足！&quot;</span><span class="p">)</span>
        <span class="nx">os</span><span class="p">.</span><span class="nx">Exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nb">println</span><span class="p">(</span><span class="s">&quot;程序启动成功！&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 程序启动失败，xxx条件不满足！&lt;br&gt;</span>
<span class="kd">func</span> <span class="nx">os_path</span><span class="p">()</span>  <span class="p">{</span>
    <span class="nb">print</span><span class="p">(</span><span class="s">&quot;判断 / \\ : 是否是路径分隔符: &quot;</span><span class="p">)</span>
    <span class="nb">println</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">IsPathSeparator</span><span class="p">(</span><span class="sc">&#39;/&#39;</span><span class="p">),</span> <span class="nx">os</span><span class="p">.</span><span class="nx">IsPathSeparator</span><span class="p">(</span><span class="sc">&#39;\\&#39;</span><span class="p">),</span> <span class="nx">os</span><span class="p">.</span><span class="nx">IsPathSeparator</span><span class="p">(</span><span class="sc">&#39;:&#39;</span><span class="p">))</span>
<span class="p">}&lt;</span><span class="nx">br</span><span class="p">&gt;</span><span class="c1">// 判断 / \ : 是否是路径分隔符: true true false</span>
</pre></div>
</div>
</section>
</section>
<section id="id41">
<h3><a class="toc-backref" href="#id68">5.常用函数</a><a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<section id="id42">
<h4>5.1 判断文件或目录是否存在<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">filePath</span> <span class="o">:=</span> <span class="s">&quot;E:/go&quot;</span>
    <span class="nx">exist</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">PathIsExist</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span><span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;PathIsExists(%s),err(%v)\n&quot;</span><span class="p">,</span> <span class="nx">filePath</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">exist</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;path %s 存在\n&quot;</span><span class="p">,</span><span class="nx">filePath</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;path %s 不存在\n&quot;</span><span class="p">,</span> <span class="nx">filePath</span><span class="p">)</span>
        <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Mkdir</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">ModePerm</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;mkdir failed![%v]\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;mkdir success!\n&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">   判断文件或文件夹是否存在</span>
<span class="cm">   如果返回的错误为nil,说明文件或文件夹存在</span>
<span class="cm">   如果返回的错误类型使用os.IsNotExist()判断为true,说明文件或文件夹不存在</span>
<span class="cm">   如果返回的错误为其它类型,则不确定是否在存在</span>
<span class="cm">*/</span>
<span class="kd">func</span> <span class="nx">PathIsExist</span><span class="p">(</span><span class="nx">filePath</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="k">if</span> <span class="nx">os</span><span class="p">.</span><span class="nx">IsNotExist</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">err</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id43">
<h4>5.2 循环创建文件夹<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kd">func</span> <span class="nx">CreateDir</span><span class="p">(</span><span class="nx">dirs</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">dirs</span> <span class="p">{</span>
        <span class="nx">exist</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">PathIsExist</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;get dir error![%v]\n&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">err</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nx">exist</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;has dir![%v]\n&quot;</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;no dir![%v]\n&quot;</span><span class="p">,</span> <span class="nx">v</span><span class="p">))</span>
            <span class="c1">// 创建文件夹</span>
            <span class="nx">err</span> <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Mkdir</span><span class="p">(</span><span class="nx">v</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">ModePerm</span><span class="p">)</span>
            <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Sprintf</span><span class="p">(</span><span class="s">&quot;mkdir error![%v]\n&quot;</span><span class="p">,</span><span class="nx">err</span><span class="p">))</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;mkdir success!\n&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">err</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id44">
<h4>5.3 实现拷贝功能<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<p>示例1</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="cm">/* 处理错误 */</span>
<span class="kd">func</span> <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* 基于Read和Write方法实现拷贝功能 */</span>
<span class="kd">func</span> <span class="nx">copyFile1</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">,</span> <span class="nx">destFile</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 打开文件</span>
    <span class="nx">src</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">dest</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">destFile</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

    <span class="c1">// 关闭文件</span>
    <span class="k">defer</span> <span class="nx">src</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="kd">var</span> <span class="nx">bs</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="nx">total</span> <span class="o">:=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="c1">// 读取文件</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">readErr</span> <span class="o">:=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">bs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">readErr</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;拷贝完成...&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="p">}</span>
        <span class="nx">handleError</span><span class="p">(</span><span class="nx">readErr</span><span class="p">)</span>

        <span class="c1">// 写入文件</span>
        <span class="nx">_</span><span class="p">,</span> <span class="nx">writeErr</span> <span class="o">:=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">bs</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
        <span class="nx">handleError</span><span class="p">(</span><span class="nx">writeErr</span><span class="p">)</span>
        <span class="nx">total</span> <span class="o">+=</span> <span class="nx">n</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;已经拷贝了 %d 字节数据\n&quot;</span><span class="p">,</span> <span class="nx">total</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">total</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="cm">/* 使用io.Copy() 方法实现文件拷贝 */</span>
<span class="kd">func</span> <span class="nx">copyFile2</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">,</span> <span class="nx">destFile</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">int64</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 打开文件</span>
    <span class="nx">src</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">dest</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">destFile</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

    <span class="c1">// 关闭文件</span>
    <span class="k">defer</span> <span class="nx">src</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="c1">// 拷贝文件</span>
    <span class="k">return</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="nx">src</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">srcFileName</span> <span class="o">:=</span> <span class="s">&quot;C:\\Users\\T470P\\Desktop\\goland\\1.jpg&quot;</span>
    <span class="nx">destFileName</span> <span class="o">:=</span> <span class="nx">srcFileName</span><span class="p">[</span><span class="nx">strings</span><span class="p">.</span><span class="nx">LastIndex</span><span class="p">(</span><span class="nx">srcFileName</span><span class="p">,</span> <span class="s">&quot;\\&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">destFileName</span><span class="p">)</span>

    <span class="nx">total1</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">copyFile1</span><span class="p">(</span><span class="nx">srcFileName</span><span class="p">,</span> <span class="nx">destFileName</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">total1</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>

    <span class="nx">total2</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">copyFile2</span><span class="p">(</span><span class="nx">srcFileName</span><span class="p">,</span> <span class="nx">destFileName</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;一共拷贝了 %d 字节数据\n&quot;</span><span class="p">,</span> <span class="nx">total2</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>示例2</p>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;os&quot;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nx">copyFile</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">,</span> <span class="nx">destFile</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">int64</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">file1</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="nx">file2</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">destFile</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_RDWR</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">ModePerm</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">err</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">file1</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">file2</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Copy</span><span class="p">(</span><span class="nx">file2</span><span class="p">,</span> <span class="nx">file1</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">srcFile</span> <span class="o">:=</span> <span class="s">&quot;blockchain.txt&quot;</span>
    <span class="nx">destFile</span> <span class="o">:=</span> <span class="s">&quot;blockchain.txt_2022&quot;</span>
    <span class="nx">total</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">copyFile</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">,</span> <span class="nx">destFile</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;复制ok&quot;</span><span class="p">,</span> <span class="nx">total</span><span class="p">)</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id45">
<h4>5.4 拷贝文件(显示百分比)<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;io/ioutil&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;time&quot;</span>
<span class="p">)</span>

<span class="cm">/*</span>
<span class="cm">实现文件拷贝功能,并在控制台打印拷贝数据的百分比.</span>
<span class="cm">*/</span>

<span class="kd">const</span> <span class="p">(</span>
    <span class="nx">Format1</span> <span class="p">=</span> <span class="s">&quot;\b\b%d%%&quot;</span>
    <span class="nx">Format2</span> <span class="p">=</span> <span class="s">&quot;\b\b\b%d%%&quot;</span>
    <span class="nx">Format3</span> <span class="p">=</span> <span class="s">&quot;\b\b\b%d%%\b&quot;</span>
<span class="p">)</span>

<span class="c1">// rate 打印百分比</span>
<span class="kd">func</span> <span class="nx">rate</span><span class="p">(</span><span class="nx">ch</span> <span class="kd">chan</span> <span class="kt">int64</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">format</span> <span class="o">:=</span> <span class="nx">Format1</span>
    <span class="kd">var</span> <span class="nx">lastV</span> <span class="kt">int64</span> <span class="p">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="nx">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">ch</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nx">lastV</span> <span class="p">&gt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span> <span class="p">&gt;</span> <span class="mi">10</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span> <span class="p">&lt;</span> <span class="mi">100</span> <span class="p">{</span>
            <span class="nx">format</span> <span class="p">=</span> <span class="nx">Format2</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">v</span> <span class="o">&gt;=</span> <span class="mi">100</span> <span class="p">{</span>
            <span class="nx">v</span> <span class="p">=</span> <span class="mi">100</span>
            <span class="nx">format</span> <span class="p">=</span> <span class="nx">Format3</span>
        <span class="p">}</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">v</span><span class="p">)</span>
        <span class="nx">lastV</span> <span class="p">=</span> <span class="nx">v</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 1.打开文件</span>
    <span class="nx">file</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="s">&quot;./src/11.png&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// 获取文件信息(fileInfo.Size())</span>
    <span class="nx">fileInfo</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Stat</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="c1">// 定义channel</span>
    <span class="kd">var</span> <span class="nx">fsChan</span> <span class="p">=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="kt">int64</span><span class="p">)</span>
    <span class="k">defer</span> <span class="nb">close</span><span class="p">(</span><span class="nx">fsChan</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">fs</span> <span class="p">=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Print</span><span class="p">(</span><span class="s">&quot;rate:0%&quot;</span><span class="p">)</span>
    <span class="k">go</span> <span class="nx">rate</span><span class="p">(</span><span class="nx">fsChan</span><span class="p">)</span>

    <span class="c1">// 2.循环读取文件,数据填充到fs中,</span>
    <span class="c1">// 通过fs的长度计算已经读取的文件的百分比</span>
    <span class="k">for</span> <span class="p">{</span>
        <span class="nx">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">10240</span><span class="p">)</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="k">break</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;file read over!&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="nx">log</span><span class="p">.</span><span class="nx">Fatalln</span><span class="p">(</span><span class="s">&quot;read file failed, err:&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nx">fs</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">fs</span><span class="p">,</span> <span class="nx">buf</span><span class="o">...</span><span class="p">)</span>
        <span class="nx">time</span><span class="p">.</span><span class="nx">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
        <span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">fsChan</span> <span class="o">&lt;-</span> <span class="nb">int64</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nx">fs</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="nx">fileInfo</span><span class="p">.</span><span class="nx">Size</span><span class="p">()</span>
        <span class="p">}()</span>
    <span class="p">}</span>
    <span class="c1">// 3.写入文件</span>
    <span class="nx">ioutil</span><span class="p">.</span><span class="nx">WriteFile</span><span class="p">(</span><span class="s">&quot;./dst/11.png&quot;</span><span class="p">,</span> <span class="nx">fs</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id46">
<h4>5.5 添加断点续传功能<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<div class="highlight-go notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io&quot;</span>
    <span class="s">&quot;log&quot;</span>
    <span class="s">&quot;os&quot;</span>
    <span class="s">&quot;strconv&quot;</span>
    <span class="s">&quot;strings&quot;</span>
<span class="p">)</span>

<span class="c1">// 处理错误</span>
<span class="kd">func</span> <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 拷贝文件,实现断点续传功能</span>
<span class="kd">func</span> <span class="nx">copyFile</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">,</span> <span class="nx">destFile</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// 打开文件</span>
    <span class="nx">src</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Open</span><span class="p">(</span><span class="nx">srcFile</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">dest</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">destFile</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_WRONLY</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="c1">// 保存拷贝进度临时文件</span>
    <span class="nx">tmpFile</span> <span class="o">:=</span> <span class="nx">destFile</span> <span class="o">+</span> <span class="s">&quot;tmp.txt&quot;</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">tmpFile</span><span class="p">)</span>
    <span class="nx">tmp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nx">OpenFile</span><span class="p">(</span><span class="nx">tmpFile</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_RDWR</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>

    <span class="c1">// 关闭文件</span>
    <span class="k">defer</span> <span class="nx">src</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>
    <span class="k">defer</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>

    <span class="c1">// 读取tmp,获取拷贝起点</span>
    <span class="nx">tmp</span><span class="p">.</span><span class="nx">Seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">io</span><span class="p">.</span><span class="nx">SeekStart</span><span class="p">)</span>
    <span class="nx">bs</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="nx">n1</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">bs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>  <span class="c1">// 第一次拷贝,tmp文件为空,读取会有EOF错误,忽略即可.</span>
        <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">countStr</span> <span class="o">:=</span> <span class="nb">string</span><span class="p">(</span><span class="nx">bs</span><span class="p">[:</span><span class="nx">n1</span><span class="p">])</span>  <span class="c1">// byte 转 string</span>
    <span class="nx">count</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">strconv</span><span class="p">.</span><span class="nx">ParseInt</span><span class="p">(</span><span class="nx">countStr</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">64</span><span class="p">)</span>  <span class="c1">// string 转 int64</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span>

    <span class="c1">// 设置读取起点</span>
    <span class="nx">src</span><span class="p">.</span><span class="nx">Seek</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">io</span><span class="p">.</span><span class="nx">SeekStart</span><span class="p">)</span>
    <span class="c1">//设置写入起点</span>
    <span class="nx">dest</span><span class="p">.</span><span class="nx">Seek</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">io</span><span class="p">.</span><span class="nx">SeekStart</span><span class="p">)</span>

    <span class="c1">// 读取文件切片</span>
    <span class="nx">data</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>

    <span class="c1">// 已读取的总量</span>
    <span class="nx">total</span> <span class="o">:=</span> <span class="nb">int</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span>  <span class="c1">// 转 int</span>

    <span class="k">for</span> <span class="p">{</span>
        <span class="c1">// 读取文件数据</span>
        <span class="nx">n</span><span class="p">,</span> <span class="nx">readErr</span> <span class="o">:=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">Read</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">readErr</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;文件拷贝完了...&quot;</span><span class="p">)</span>
            <span class="nx">tmp</span><span class="p">.</span><span class="nx">Close</span><span class="p">()</span>  <span class="c1">// 关闭临时文件</span>
            <span class="nx">os</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="nx">tmpFile</span><span class="p">)</span>  <span class="c1">// 删除临时文件</span>
            <span class="k">break</span>
        <span class="p">}</span>
        <span class="nx">handleError</span><span class="p">(</span><span class="nx">readErr</span><span class="p">)</span>

        <span class="c1">// 写入文件</span>
        <span class="nx">_</span><span class="p">,</span> <span class="nx">writeErr</span> <span class="o">:=</span> <span class="nx">dest</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">data</span><span class="p">[:</span><span class="nx">n</span><span class="p">])</span>
        <span class="nx">handleError</span><span class="p">(</span><span class="nx">writeErr</span><span class="p">)</span>

        <span class="c1">// 记录拷贝到了哪里</span>
        <span class="nx">total</span> <span class="o">+=</span> <span class="nx">n</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;已经拷贝了%d字节的数据\n&quot;</span><span class="p">,</span> <span class="nx">total</span><span class="p">)</span>
        <span class="nx">tmp</span><span class="p">.</span><span class="nx">Seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">io</span><span class="p">.</span><span class="nx">SeekStart</span><span class="p">)</span>
        <span class="nx">_</span><span class="p">,</span> <span class="nx">tmpErr</span> <span class="o">:=</span> <span class="nx">tmp</span><span class="p">.</span><span class="nx">WriteString</span><span class="p">(</span><span class="nx">strconv</span><span class="p">.</span><span class="nx">Itoa</span><span class="p">(</span><span class="nx">total</span><span class="p">))</span>
        <span class="nx">handleError</span><span class="p">(</span><span class="nx">tmpErr</span><span class="p">)</span>

        <span class="c1">//if total &gt; 3276800 {</span>
        <span class="c1">//  panic(&quot;模拟拷贝数据中断...&quot;)</span>
        <span class="c1">//}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">total</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">srcFileName</span> <span class="o">:=</span> <span class="s">&quot;C:\\Users\\T470P\\Desktop\\goland\\wei.mp4&quot;</span>
    <span class="nx">destFileName</span> <span class="o">:=</span> <span class="nx">srcFileName</span><span class="p">[</span><span class="nx">strings</span><span class="p">.</span><span class="nx">LastIndex</span><span class="p">(</span><span class="nx">srcFileName</span><span class="p">,</span> <span class="s">&quot;\\&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="nx">destFileName</span><span class="p">)</span>

    <span class="nx">total</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">copyFile</span><span class="p">(</span><span class="nx">srcFileName</span><span class="p">,</span> <span class="nx">destFileName</span><span class="p">)</span>
    <span class="nx">handleError</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;拷贝成功,文件一共%d字节\n&quot;</span><span class="p">,</span> <span class="nx">total</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="id47">
<h2><a class="toc-backref" href="#id69"><span class="section-number">10.8.6. </span>6.参考文献</a><a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.cnblogs.com/zhangyafei/p/13151697.html">https://www.cnblogs.com/zhangyafei/p/13151697.html</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="07.time.html" class="btn btn-neutral float-left" title="10.7. time" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="09.regexp.html" class="btn btn-neutral float-right" title="10.9. regexp" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>