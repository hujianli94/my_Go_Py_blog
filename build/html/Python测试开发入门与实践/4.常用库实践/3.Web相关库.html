<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4.3. Web相关库 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5. Web前端开发基础" href="../5.Web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/index.html" />
    <link rel="prev" title="4.2. 数据存储库" href="2.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%BA%93.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Python_go_Devops
            <img src="../../_static/python_go.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Go/index.html">Go语言学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Go_vs_Python/index.html">Go vs Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Python/index.html">Python全栈系列</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Python测试开发入门与实践</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../1.Python%E5%9F%BA%E7%A1%80/index.html">1. Python基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2.Python%E8%AF%AD%E6%B3%95/index.html">2. Python语法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3.Python%E8%BF%9B%E9%98%B6/index.html">3. Python进阶</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">4. 常用库实践</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="1.%E6%97%A5%E5%B8%B8%E7%B1%BB%E5%BA%93.html">4.1. 日常类库</a></li>
<li class="toctree-l3"><a class="reference internal" href="2.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%BA%93.html">4.2. 数据存储库</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">4.3. Web相关库</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#requests-http">4.3.1. 1. requests-HTTP网络请求库</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flask-web">4.3.2. 2.Flask-Web开发框架</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../5.Web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/index.html">5. Web前端开发基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6.%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%AE%9E%E8%B7%B5/index.html">6. 测试开发实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7.%E9%99%84%E5%BD%95/index.html">7. 附录</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Vue/index.html">Vue.js企业开发实战</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Vue_Node.js/index.html">Vue.js+Node.js开发实战</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Python_go_Devops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Python测试开发入门与实践</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">4. </span>常用库实践</a> &raquo;</li>
      <li><span class="section-number">4.3. </span>Web相关库</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Python测试开发入门与实践/4.常用库实践/3.Web相关库.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#web" id="id15">Web相关库</a></p>
<ul>
<li><p><a class="reference internal" href="#requests-http" id="id16">1. requests-HTTP网络请求库</a></p>
<ul>
<li><p><a class="reference internal" href="#http" id="id17">1.1 HTTP请求</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id18">1.2 HTTP响应</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#flask-web" id="id19">2.Flask-Web开发框架</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id20">2.1 路由绑定</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id21">2.2 请求处理</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id22">2.3 模板渲染</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id23">2.4 静态文件</a></p></li>
<li><p><a class="reference internal" href="#id6" id="id24">2.5 重定向与错误</a></p></li>
<li><p><a class="reference internal" href="#cookie" id="id25">2.6 cookie</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id26">2.7 启动设置</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id27">2.8 项目分层</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id28">2.9 项目部署</a></p></li>
<li><p><a class="reference internal" href="#flask-restful" id="id29">2.10 Flask 开发 RESTful 服务</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="web">
<h1><a class="toc-backref" href="#id15"><span class="section-number">4.3. </span>Web相关库</a><a class="headerlink" href="#web" title="Permalink to this headline">¶</a></h1>
<p>主要介绍两个与Web相关的库：</p>
<p>一个是用于发送Web请求的requests库，</p>
<p>另一个则是用于提供Web服务的Flask框架。</p>
<section id="requests-http">
<h2><a class="toc-backref" href="#id16"><span class="section-number">4.3.1. </span>1. requests-HTTP网络请求库</a><a class="headerlink" href="#requests-http" title="Permalink to this headline">¶</a></h2>
<p>requests作为一个专门为“人类”编写的HTTP请求库，其易用性很强，因此在推出之后就迅速成为Python中首选的HTTP请求库。requests库的最大特点是提供了简单易用的API，让编程人员可以轻松地提高效率。由于requests不是Python的标准库，因此在使用之前需要进行安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install requests
</pre></div>
</div>
<section id="http">
<h3><a class="toc-backref" href="#id17">1.1 HTTP请求</a><a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h3>
<p>通过requests可以完成各种类型的HTTP请求，包括HTTP、HTTPS、HTTP1.0、HTTP1.1及各种请求方法。</p>
<p>requests库支持的HTTP方法如下。</p>
<ul class="simple">
<li><p>get——发送一个GET请求，用于请求页面信息。</p></li>
<li><p>options——发送一个OPTIONS请求，用于检查服务器端相关信息。</p></li>
<li><p>head——发送一个HEAD请求，类似于GET请求，但只请求页面的响应头信息。</p></li>
<li><p>post——发送一个POST请求，通过body向指定资源提交用户数据。</p></li>
<li><p>put——发送一个PUT请求，向指定资源上传最新内容。</p></li>
<li><p>patch——发送一个PATCH请求，同PUT类似，可以用于部分内容更新。</p></li>
<li><p>delete——发送一个DELETE请求，向指定资源发送一个删除请求。</p></li>
</ul>
<p>可以看到，requests使用与HTTP请求方法同名的API来提供相应的HTTP请求服务，从而降低了编程人员的学习和记忆成本。另外，这些API方法都调用同一个基础方法，因此在调用参数的使用上也基本保持一致。</p>
<p>GET请求示例</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/get&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>        <span class="c1"># 200</span>
</pre></div>
</div>
<p>示例中通过requests.get方法来发送HTTP的GET请求，使用的参数是被访问的URL地址。当然也可以附加URL参数来发送一个带参数的GET请求。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/get?name=python&amp;amp;age=14&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>


<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;python&#39;</span><span class="p">,</span><span class="s1">&#39;age&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/get&quot;</span><span class="p">,</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</pre></div>
</div>
<p>与GET不同的是，POST一般会通过HTTP的body来发送请求数据。这样设计的好处是支持更多类型和更多内容的请求数据。</p>
<p>具体而言，POST请求支持的请求数据类型如下。</p>
<p>（1）纯文本——任意格式的普通字符串。</p>
<p>（2）二进制——二进制字符串，例如文件二进制内容。</p>
<p>（3）x-www-form-urlencoded——键值对参数形式，一种特定格式的纯文本内容。</p>
<p>（4）multipart/form-data——同时支持二进制和键值对形式的数据格式。</p>
<p>日常工作中经常使用（1）、（3）、（4）这3种形式来发送POST数据。其中纯文本形式的请求示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;hello python&quot;</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/post&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</pre></div>
</div>
<p>如果在请求时需要上传文件内容，那么就需要使用multipart/form-data的形式来发送POST请求。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">}</span>

<span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file1&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/path/to/test1.xls&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">),</span> <span class="s1">&#39;file2&#39;</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/path/to/test2.png&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)}</span>

<span class="c1"># 请求时指定了files参数，就会以multipart/form-data形式发送数据</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;http://httpbin.org/post&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</pre></div>
</div>
<p>其他几种HTTP请求方法的使用与GET、POST基本一致，要么与GET一样，通过URL传递请求数据；要么与POST一样，通过body传递请求数据。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 与 GET 相同的传参方式</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/delete&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="c1"># 与 POST 相同的传参方式</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/put&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;value&#39;</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/patch&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span><span class="s1">&#39;value&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>requests库还提供了HTTP请求头的设置，只需要在各请求方法中使用headers参数即可。具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.github.com/some/endpoint&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</pre></div>
</div>
<p>示例中为POST请求设置了Content-Type请求头信息为application/json，这样在服务器端的程序就可以通过Content-Type信息来确定请求体的内容为JSON格式。当然，如果只是想发送JSON数据的请求，还可以直接通过json参数来实现。具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://api.github.com/some/endpoint&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;python&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>最后，想要给HTTP请求设置一些cookie信息也非常方便，唯一需要做的只是使用cookies参数而已。具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://httpbin.org/cookies&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cookie_name&#39;</span><span class="p">:</span> <span class="s1">&#39;cookie_value&#39;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id1">
<h3><a class="toc-backref" href="#id18">1.2 HTTP响应</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>通过requests各请求方法发送HTTP请求之后，会返回一个Response对象，即HTTP响应对象。通过Response对象可以查看请求的响应状态和响应内容，包括响应头、cookie和响应体。</p>
<p>查看请求响应状态的示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span>
<span class="go">&lt;Response [200]&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="c1"># 响应状态码</span>
<span class="go">200</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">reason</span> <span class="c1"># 响应状态信息</span>
<span class="go">&#39;OK&#39;</span>
</pre></div>
</div>
<p>查看响应头信息和cookie的示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">headers</span> <span class="c1"># 响应头信息</span>
<span class="go">{&#39;Date&#39;: &#39;Sat, 06 Jun 2020 08:27:48 GMT&#39;, &#39;Content-Type&#39;: &#39;application/json&#39;,</span>
<span class="go">&#39;Content-Length&#39;: &#39;308&#39;, &#39;Connection&#39;: &#39;keep-alive&#39;, &#39;Server&#39;: &#39;gunicorn/19.9.0&#39;,</span>
<span class="go">&#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;, &#39;Access-Control-Allow-Credentials&#39;: &#39;true&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">cookies</span> <span class="c1"># 响应 cookie</span>
<span class="go">&lt;RequestsCookieJar[]&gt;</span>
</pre></div>
</div>
<p>Response对象响应体内容的形式有3种，分别为二进制、unicode、json。当访问的请求资源是文件时，则需要通过二进制的方式来获取响应内容。具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://www.testqa.cn/static/testqa2.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.png&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>               <span class="c1"># 下载图片并保存在本地</span>
<span class="gp">... </span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">179543</span>
</pre></div>
</div>
<p>如果请求返回的是普通文本内容，则可以通过unicode的方式来获取内容。具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">text</span> <span class="c1"># 获取 unicode 形式的响应体内容</span>
<span class="go">&#39;{\n &quot;args&quot;: {}, \n &quot;headers&quot;: {\n &quot;Accept&quot;: &quot;*/*&quot;, \n &quot;Accept-Encoding&quot;: &quot;gzip,</span>
<span class="go">deflate&quot;, \n &quot;Host&quot;: &quot;httpbin.org&quot;, \n &quot;User-Agent&quot;: &quot;python-requests/2.20.0&quot;, \n</span>
<span class="go">&quot;X-Amzn-Trace-Id&quot;: &quot;Root=1-5edb57b9-0fd017fb754da1d82cabcc00&quot;\n }, \n &quot;origin&quot;:</span>
<span class="go">&quot;221.218.139.172&quot;, \n &quot;url&quot;: &quot;http://httpbin.org/get&quot;\n}\n&#39;</span>
</pre></div>
</div>
<p>需要注意的是，默认情况下通过Response对象的text获取unicode响应内容时，选择的编码方式为系统的编码方式；如果请求的URL返回内容与本地的编码方式不一致，获取的unicode内容将会出现乱码。解决乱码问题只需在获取unicode内容之前，设置指定的编码格式即可。具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span> <span class="c1"># 设置编码格式</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">text</span>
</pre></div>
</div>
<p>如果请求返回的内容是标准的JSON格式，除了通过unicode形式获取响应体外，还可以通过json方法获取对应的反序列化对象。具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://httpbin.org/get&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="c1"># 获取 unicode 内容的 JSON 反序列化对象</span>
<span class="go">{&#39;args&#39;: {}, &#39;headers&#39;: {&#39;Accept&#39;: &#39;*/*&#39;, &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;, &#39;Host&#39;:</span>
<span class="go">&#39;httpbin.org&#39;, &#39;User-Agent&#39;: &#39;python-requests/2.20.0&#39;, &#39;X-Amzn-Trace-Id&#39;:</span>
<span class="go">&#39;Root=1-5edb57b9-0fd017fb754da1d82cabcc00&#39;}, &#39;origin&#39;: &#39;221.218.139.172&#39;, &#39;url&#39;:</span>
<span class="go">&#39;http://httpbin.org/get&#39;}</span>
</pre></div>
</div>
<p>除了获取常规的响应内容之外，Response对象还提供了一个history的属性，用于查询当前请求的重定向历史记录。这个记录对于调试问题很有帮助，具体示例如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;http://github.com&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">url</span>
<span class="go">&#39;https://github.com/&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">history</span>
<span class="go">[&lt;Response [301]&gt;]</span>
</pre></div>
</div>
<blockquote>
<div><p>注意</p>
<p>对于重定向的默认设置，requests中GET、OPTIONS、POST、PUT、PATCH、DELETE默认允许重定向，只有HEAD默认不允许重定向。</p>
<p>如果希望改变重定向设置，则可以通过设置请求方法的allow_redirects参数来实现。</p>
</div></blockquote>
</section>
</section>
<section id="flask-web">
<h2><a class="toc-backref" href="#id19"><span class="section-number">4.3.2. </span>2.Flask-Web开发框架</a><a class="headerlink" href="#flask-web" title="Permalink to this headline">¶</a></h2>
<p>Python中可以用来进行Web开发的框架有很多，包括Django、Flask、Bottle、Torando、web.py等。</p>
<p>它们都有着不同的优缺点，本书以简单易学、快速开发为目标，选择了Flask作为Web框架进行介绍。</p>
<p>Flask是一个简单易学，可以快速完成一个简易Web服务开发的“微框架”。相比于Django、Torando等框架，Flask更加简洁和灵活。另外，Flask也提供了足够的功能支持Web服务开发的常规需求，用一句话来形容就是：麻雀虽小、五脏俱全。</p>
<p>Flask是Python的第三方库，因此在正式使用之前需要进行安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install Flask
</pre></div>
</div>
<p>通过Flask来启动一个Web服务的学习成本几乎为零，甚至只需要写几行代码就可以实现。下面是一个最简单的官方示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>  <span class="c1"># put application&#39;s code here</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>可以看到，即使算上空行总共也就只有9行代码，而这已经是一个完整的Web服务了。</p>
<p>示例中的第一行代码用于引入Flask类并在随后对其进行了实例化；之后通过该实例的route装饰器来为Flask服务绑定路由和处理函数；处理函数中返回的是给客户端的具体信息；</p>
<p>最后通过Flask实例的run方法启动Web服务。假设上述代码被保存在一个名为hello.py的文件中，那么其执行启动后的效果如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="p">:</span>\<span class="n">pythonproject</span>\<span class="n">flaskProject</span>\<span class="n">venv</span>\<span class="n">Scripts</span>\<span class="n">python</span><span class="o">.</span><span class="n">exe</span> <span class="o">-</span><span class="n">m</span> <span class="n">flask</span> <span class="n">run</span>
 <span class="o">*</span> <span class="n">Serving</span> <span class="n">Flask</span> <span class="n">app</span> <span class="s1">&#39;app.py&#39;</span>
 <span class="o">*</span> <span class="n">Debug</span> <span class="n">mode</span><span class="p">:</span> <span class="n">off</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">development</span> <span class="n">server</span><span class="o">.</span> <span class="n">Do</span> <span class="ow">not</span> <span class="n">use</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">production</span> <span class="n">deployment</span><span class="o">.</span> <span class="n">Use</span> <span class="n">a</span> <span class="n">production</span> <span class="n">WSGI</span> <span class="n">server</span> <span class="n">instead</span><span class="o">.</span>
 <span class="o">*</span> <span class="n">Running</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span>
<span class="n">Press</span> <span class="n">CTRL</span><span class="o">+</span><span class="n">C</span> <span class="n">to</span> <span class="n">quit</span>
<span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">31</span><span class="o">/</span><span class="n">Aug</span><span class="o">/</span><span class="mi">2022</span> <span class="mi">13</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">04</span><span class="p">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="o">-</span>
<span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">31</span><span class="o">/</span><span class="n">Aug</span><span class="o">/</span><span class="mi">2022</span> <span class="mi">13</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">04</span><span class="p">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="o">-</span>
<span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">31</span><span class="o">/</span><span class="n">Aug</span><span class="o">/</span><span class="mi">2022</span> <span class="mi">13</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">05</span><span class="p">]</span> <span class="s2">&quot;GET /favicon.ico HTTP/1.1&quot;</span> <span class="mi">404</span> <span class="o">-</span>
</pre></div>
</div>
<p>从启动结果可以看出，Web已经正常运行，并且可以通过http://127.0.0.1:5000/来访问Web服务。可以通过浏览器或者curl等工具来访问该地址，最终会看到该接口返回的内容为“Hello,World!”</p>
<section id="id2">
<h3><a class="toc-backref" href="#id20">2.1 路由绑定</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Web服务本质上是一种响应式服务，它根据用户访问的不同URL来执行对应的业务处理；而URL和业务处理函数之间的映射关系，在Web服务框架中则是通过路由的方式来实现的；所以Web服务开发的第一步往往都是从路由绑定开始的。Flask中路由绑定是通过route装饰器实现的，该装饰器所实现的功能就是把指定的URL和被装饰的函数进行绑定，当用户访问该URL时就会自动触发对应的绑定函数。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>  <span class="c1"># put application&#39;s code here</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>上述示例是一个简单的路由绑定，它会把URL路径“/”和hello_world处理函数进行绑定，当用户通过Web服务访问URL“/”时，就会执行hello_world函数并把函数的返回内容作为用户请求的响应内容。</p>
<p>如果想要增加对HTTP请求方法的支持，就需要在调用route装饰器时显式地设置methods参数。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>  <span class="c1"># put application&#39;s code here</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>上述示例中hello_world函数将会同时支持URL路径“/”的GET和POST请求的处理。当然，也可以修改为支持其他HTTP请求方法，最终设定的请求方法将会覆盖默认的设置。</p>
<p>同样地，多个URL路径也可以同时绑定到一个请求处理函数。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>  <span class="c1"># put application&#39;s code here</span>
    <span class="k">return</span> <span class="s1">&#39;Hello World!&#39;</span>
</pre></div>
</div>
<p>上述示例把URL路径“/”和“/hello”同时绑定到hello_world函数，即访问这两个URL路径会得到相同的响应结果。</p>
<p>另外一些场景下，可能希望URL的内容是可变的，且希望请求处理函数根据URL中变化的内容返回不同的响应结果，此时就需要用到Flask的动态路由配置功能。具体示例如下</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;string:name&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;hello </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>上述示例中的URL就是一个动态的URL，其中＜string:name＞就是动态的部分，它会在实际请求时匹配URL中/hello/后面的对应内容，并把值传递给处理函数的同名参数。因此，在处理函数定义时也需要相应地添加一个同名的参数。下面是不同请求URL的响应示例：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl http://127.0.0.1:5000/hello/python
hello python

$ curl http://127.0.0.1:5000/hello/world
hello world

$ curl http://127.0.0.1:5000/hello/
&lt;!doctype html&gt;
&lt;html <span class="nv">lang</span><span class="o">=</span>en&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;


$ curl http://127.0.0.1:5000/hello/python/test
&lt;!doctype html&gt;
&lt;html <span class="nv">lang</span><span class="o">=</span>en&gt;
&lt;title&gt;404 Not Found&lt;/title&gt;
</pre></div>
</div>
<p>其中，变量类型是可选的，默认为string，其他支持的类型包括int、float、path和自定义类型。实际请求时使用的内容必须和指定的类型相匹配，否则将会抛出相关异常。</p>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id21">2.2 请求处理</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>在设计好具体的URL和进行路由绑定之后，接下来要做的就是对请求处理函数进行业务开发。请求函数的处理通常分为以下三大步骤。</p>
<p>（1）请求参数的解析。</p>
<p>（2）业务逻辑的处理。</p>
<p>（3）处理结果的返回。</p>
<p>首先，在请求参数的解析方面，Flask提供了多种获取接口来对应不同的请求方法和数据格式。</p>
<p>Flask请求参数获取对应关系</p>
<img alt="../../_images/image-20220831140800544.png" src="../../_images/image-20220831140800544.png" />
<p>针对不同的请求方法和接收的数据类型，需要选择对应的数据获取接口来正确地获取数据。例如，对于GET请求的处理函数，其只能通过request.args属性来获取HTTP客户端传递的请求参数数据。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">parse</span><span class="p">():</span>
    <span class="n">get_args</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>  <span class="c1"># 类字典对象</span>
    <span class="n">form_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span>  <span class="c1"># 类字典对象</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">data</span>  <span class="c1"># 字符串或二进制</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>  <span class="c1"># JSON 反序列化对象</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span>  <span class="c1"># 类字典对象</span>

    <span class="k">return</span> <span class="s1">&#39;success&#39;</span>
</pre></div>
</div>
<p>上述示例中演示了如何通过不同的数据接口获取请求参数。具体是否能够获取正确的请求参数，取决于HTTP客户端发送请求的方法和数据类型。</p>
<p>例如，HTTP客户端发送了一个普通的form表单，那么将只有form_data能够获取到内容；如果发送一个带文件的form表单，那么files将能够获取到内容。下面是不同HTTP请求的参数获取具体示例：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># curl http://127.0.0.1:5000/?name=python</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">args_example</span><span class="p">():</span>
    <span class="n">get_args</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>  <span class="c1"># 获取 GET 请求参数对象</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">get_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>  <span class="c1"># 获取 name 参数的值</span>
    <span class="k">return</span> <span class="n">name</span>


<span class="c1"># curl http://127.0.0.1:5000/json -X POST -d &#39;{&quot;name&quot;:&quot;python&quot;}&#39; -H &quot;Content-Type:application/json&quot;</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/json&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">json_example</span><span class="p">():</span>
    <span class="n">json_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span>  <span class="c1"># 获取 JSON 数据</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">json_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span>


<span class="c1"># curl http://127.0.0.1:5000/file -F &quot;upload=@test.json&quot;</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/file&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">files_example</span><span class="p">():</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span>  <span class="c1"># 获取文件参数对象</span>
    <span class="n">upload_file</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;upload&#39;</span><span class="p">)</span>  <span class="c1"># 获取字段为 upload 的文件对象</span>
    <span class="n">upload_file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;new_test.txt&#39;</span><span class="p">)</span>  <span class="c1"># 保存文件到指定文件名</span>
    <span class="k">return</span> <span class="s1">&#39;success&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>关于请求处理函数中的具体业务处理，由于与具体接口的业务有关且不具有通用性，因此这里不做具体介绍。在业务处理完成之后，请求处理函数最终还是需要返回一个结果给HTTP客户端，以表示当次请求服务器端已经处理结束，并在响应中返回处理的具体结果。</p>
<p>Flask中提供了多种类型的响应内容返回方式，具体如下。</p>
<ul class="simple">
<li><p>返回纯文本内容。</p></li>
<li><p>返回JSON内容。</p></li>
<li><p>返回HTML内容。</p></li>
</ul>
<p>其中，返回纯文本内容方式是直接返回一个普通字符串。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;hello world!&quot;</span>
</pre></div>
</div>
<p>该方式返回的响应状态码默认为200，响应内容的类型为text/html。当然也可以在返回内容时指定状态码和响应内容的类型。例如下面示例将会返回一个状态码为201、类型为text/plain的“Hello
World！”响应内容：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello World!&quot;</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>如果想要返回JSON类型的响应内容，可以通过flask.jsonify函数来实现。它会自动把支持JSON序列化的数据类型转换为JSON字符串，并设置响应内容的类型为application/json。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;python&quot;</span><span class="p">})</span>
</pre></div>
</div>
<p>当然，返回HTML内容则是Flask支持的最完整的功能。最简单的方式与返回纯文本一样，只要直接返回HTML内容即可。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;&lt;h1&gt;Hello World!&lt;/h1&gt;&quot;</span>
</pre></div>
</div>
<p>如果HTML内容过长，在代码中直接展示出来不够易读，那么可以把HTML内容存放在单独的文件中，再通过open函数读取内容并返回。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;test.html&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id22">2.3 模板渲染</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>尽管直接读取HTML文件可以解决代码易读性的问题，但是如果想要返回动态的HTML内容，则需要引入模板机制。Flask中配置了Jinja2模板引擎，因此可以直接引入Jinja2模板引擎来进行HTML模板内容的渲染。这里所谓的模板本质也是HTML内容，只不过模板文件中包括了静态的HTML内容和模板语法。</p>
<p>其中静态的HTML内容不会被改变，而模板语法则会根据上下文内容被转换为相应的HTML内容，即模板语法部分的内容是可以控制的动态内容，因此在功能上实现了动态HTML内容的效果。这里假设有一个名为test.html的模板文件，其内容如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Hello</span> <span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ curl http://127.0.0.1:5000/hello/python
&lt;h1&gt;Hello python&lt;/h1&gt;


$ curl http://127.0.0.1:5000/hello/hujianli
&lt;h1&gt;Hello hujianli&lt;/h1&gt;
</pre></div>
</div>
<blockquote>
<div><p>说明</p>
<p>关于Jinja2的具体语法使用，感兴趣的读者可以查看官方文档来进行学习，由于本书中后期将使用Vue进行前后端分离式的Web开发，因此这里不再对后端渲染进行过多的介绍。</p>
</div></blockquote>
<p>最后，如果想改变渲染模板场景下的状态码和相关的头信息，则可以通过显式创建一个Flask响应对象来实现。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">make_response</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello/&lt;name&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">rep</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;test.html&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">))</span>
    <span class="n">rep</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="mi">201</span>
    <span class="n">rep</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;text/plain&#39;</span>
    <span class="k">return</span> <span class="n">rep</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id23">2.4 静态文件</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>Flask中除了可以返回HTML等文本内容之外，内置的Web服务器还支持静态文件的访问。方法为在Flask启动文件的同一目录下创建一个static文件夹，并把静态文件存放在该文件夹下。</p>
<p>假设Flask项目的目录结构如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree flaskProject/ -L 3
flaskProject/
├── __pycache__
│   └── app.cpython-38.pyc
├── app.py
├── static
│   ├── foo
│   │   └── test2.png
│   └── test.png
├── templates
│   └── test.html
└── venv
</pre></div>
</div>
<p>如果要访问示例中的test.png和test2.png，则具体的访问地址分别为：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">/</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">test</span><span class="o">.</span><span class="n">png</span>
<span class="n">http</span><span class="p">:</span><span class="o">/</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span><span class="n">static</span><span class="o">/</span><span class="n">foo</span><span class="o">/</span><span class="n">test2</span><span class="o">.</span><span class="n">png</span>
</pre></div>
</div>
<p>任意类型的文件都可以作为静态资源，只要存放在static目录下，就可以通过上述URL路径规则进行访问。</p>
</section>
<section id="id6">
<h3><a class="toc-backref" href="#id24">2.5 重定向与错误</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>在Web服务访问时并不总是能够返回正确的结果，当用户访问了错误的URL，或者传输了错误的请求参数，Web服务就需要返回相关的错误信息进行提示。</p>
<p>Flask中针对错误请求的场景提供了相关的API，包括标准错误的响应和标准重定向的响应处理。在Web服务中响应状态主要分为五大类，每一类都代表相关类型的响应，具体说明如表</p>
<img alt="../../_images/image-20220831143122758.png" src="../../_images/image-20220831143122758.png" />
<p>通常情况下1xx、2xx、4xx、5xx、6xx类的响应在Web服务中都已经有默认的实现，只有3xx类的响应需要人为配置。Flask提供的相关API可以针对3xx、4xx、5xx类的响应进行组装。</p>
<p>通过flask. redirect函数可以方便地进行重定向响应的设置。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">redirect</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>当用户访问示例中的’/hello’地址时，Web服务器会返回一个302的请求跳转响应，客户端获取到302响应后会读取响应头中的Location字段值，该值是一个新的跳转URL，客户端会进一步请求该URL地址，直到获取最终的响应内容。</p>
<blockquote>
<div><p>说明</p>
<p>重定向支持连续性，即上一个重定向请求的URL同样可以返回一个重定向响应。需要注意的是，在配置重定向时要避免循环重定向的问题。</p>
</div></blockquote>
<p>Web服务中支持重定向的状态码除了302，还有301、307等。通过指定重定向状态码可以返回不同类型的重定向响应，具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">301</span><span class="p">)</span> <span class="c1"># 返回 301 重定向</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello_world</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;hello world&quot;</span>
</pre></div>
</div>
<p>有时可能希望返回4xx或5xx类的响应，那么就可以通过flask.abort函数来实现。具体示例如下：</p>
</section>
<section id="cookie">
<h3><a class="toc-backref" href="#id25">2.6 cookie</a><a class="headerlink" href="#cookie" title="Permalink to this headline">¶</a></h3>
<p>通过前面的内容，读者已经知道发送HTTP请求时可以指定cookie，而在Web服务器端，一方面可以获取到客户端发送的cookie信息，另一方面还可以设置响应的cookie。</p>
<p>Flask中获取请求cookie的方式与获取请求参数很相似，可以直接通过flask.request对象的cookies方法来获取。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">request</span><span class="o">.</span><span class="n">cookies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span>  <span class="c1"># 获取 cookie 中的 username 字段</span>
    <span class="k">return</span> <span class="s1">&#39;success&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>为响应内容设置cookie也非常方便，所要做的就是在返回Flask响应对象之前，给响应对象设置指定的cookie值。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">make_response</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">make_response</span><span class="p">(</span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;test.html&#39;</span><span class="p">))</span>
    <span class="n">resp</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">)</span> <span class="c1"># 设置响应 cookie</span>
    <span class="k">return</span> <span class="n">resp</span>
</pre></div>
</div>
<p>通过访问上述示例中的处理函数对应的URL，在响应内容中便可以获取到cookie名为username的字段，并且其值为python。cookie除了上述的常规用法之外，还被用于session的实现。</p>
<p>session在Web服务中作为保存用户凭证及相关信息的数据存储载体，市场上大部分的Web服务都会把session的全部信息保存在Web服务器上，之后为其生成一个唯一的sessionID，并在返回响应时把sessionID设置为cookie字段传递给客户端，该客户端再次发出访问请求时会自动带上这个sessionID，而Web服务通过请求的sessionID信息就可以判断该请求是否曾经访问过。</p>
<p>Flask中的session实现机制与其他Web服务不同，它并没有把session保存在Web服务器端，而是把session的全部信息进行序列化之后再进行一次加密操作，最后把加密后的密文设置到响应cookie中。</p>
<p>客户端下次请求时会自动带上加密后的cookie信息，Flask服务再次通过解密和反序列化操作来获取cookie信息。Flask中设置session的示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">escape</span><span class="p">,</span> <span class="n">request</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;_5#y2L&quot;F4Q8z</span><span class="se">\n\xec</span><span class="s1">]/&#39;</span>  <span class="c1"># session 加密密钥</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;username&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;登录名：</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">escape</span><span class="p">(</span><span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="s1">&#39;登录失败&#39;</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
    <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>示例中定义了login和index两个接口，对应的URL分别为/login和/。</p>
<p>在login中获取username参数值并设置为session的username值，之后把用户请求跳转至index接口；在index接口中通过获取session的username来确定当前请求的具体用户。</p>
<p>在访问上述请求时，观察首次响应内容和第一次之后请求内容的cookie，会发现自动带上了一个名为session的cookie字段，其值为一串加密后的密文。该session字段就是前文提到的Flask实现
session的具体内容。</p>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id26">2.7 启动设置</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>通过默认方式启动Flask之后，只有本机可以通过http://127.0.0.1:5000来访问Web服务；其他机器如果希望访问该Web服务，则需要在启动时修改host配置参数。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;success&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>示例中指定host为’0.0.0.0’，表示该Web服务可以被任意IP地址访问。如果只希望被指定的IP地址访问，则可以设置host为特定的IP。</p>
<p>Flask在启动时也可以指定监听的端口，默认情况下Flask只监听5000端口，如果希望Web服务通过80端口来访问，则可以指定port参数为80。具体示例如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;success&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>此外，还可以在启动Flask时指定debug为True，表示以调试模式启动Web服务。这样做的好处是当修改了Web代码后，Flask会自动重新加载最新的代码以保证Web功能可以及时更新。</p>
<p>最后，Flask默认以单进程、单线程的方式启动Web服务，因此当有任意一个用户请求被阻塞之后，整个Web服务就会被阻塞。为了避免这类情况的发生，可以设置以多进程、多线程的方式来启动Flask：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># 多线程启动</span>
<span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1"># 多进程启动</span>
</pre></div>
</div>
<blockquote>
<div><p>注意</p>
<p>Flask只能设置为多进程或者多线程启动，两者不能同时进行设置，否则会抛出相关异常。</p>
<p>Flask自带的多进程、多线程处理机制并不是最高效的，对于正式的生产环境通常建议通过WSGI的方式来部署和启动。</p>
</div></blockquote>
</section>
<section id="id8">
<h3><a class="toc-backref" href="#id27">2.8 项目分层</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>前面在介绍Flask基础功能时，为了便于演示，把代码都写在同一个文件中；而实际项目开发时，随着功能模块的增多，并不会一直都把代码写在同一个文件中。为了便于项目代码结构的管理，通常会对项目结构进行拆分和规划，而最常用的方式就是分层思想。</p>
<p>通过分层思想来管理项目代码，应用最广泛的莫过于Java的Web开发，其推崇的MVC分层架构一直沿用至今。接下来将从单个文件开始，介绍如何把项目拆分为MVC的结构形式。这里假设有一个名为app.py的文件，其内容如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;执行 DB 操作&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&lt;h1&gt;Hello Python&lt;/h1&gt;&#39;</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>在app.py文件所在目录有4个子目录，分别为对应MVC的model、templates、controller及存放静态文件的static目录。具体的目录结构如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ tree -L <span class="m">2</span> flaskProject/
flaskProject/
├── __pycache__
│   └── app.cpython-38.pyc
├── app.py
├── controller
│   └── __init__.py
├── model
│   └── __init__.py
├── static
│   ├── foo
│   └── test.png
├── templates
│   └── test.html
└── venv
    ├── Lib
    ├── pyvenv.cfg
    └── Scripts
</pre></div>
</div>
<ul class="simple">
<li><p>model目录用于存放与数据模型操作相关的模块</p></li>
<li><p>templates目录用于存放与用户界面相关的HTML模板文件</p></li>
<li><p>controller目录用于存放接收和处理用户请求的业务模块</p></li>
<li><p>static目录用于存放非HTML的静态资源文件。</p></li>
</ul>
<p>首先，Web项目拆分的第一步是把用户处理函数迁移到controller目录中，这将使得Flask启动文件变得更加简洁。在controller目录中新建一个index.py文件，其内容如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;执行 DB 操作&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s1">&#39;&lt;h1&gt;Hello Python&lt;/h1&gt;&#39;</span>
</pre></div>
</div>
<p>之后，需要更新app.py文件内容，从外部导入处理函数并绑定路由。更改后的app.py文件内容如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">controller.index</span> <span class="kn">import</span> <span class="n">index</span>  <span class="c1"># 从 controller 导入</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)(</span><span class="n">index</span><span class="p">)</span>  <span class="c1"># 绑定路由</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>接下来，需要把返回给用户的视图内容迁移到templates目录中。在templates目录下新建一个index.html，其内容如下：</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello Python<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>之后，需要对controller:raw-latex:<cite>index</cite>.py文件内容进行修改，修改后的内容如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;执行 DB 操作&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>之后，需要把数据模型相关的操作迁移到model目录。具体要做的是在model目录下新建一个db.py文件，其内容如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_something_in_db</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;执行 DB 操作&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>最后，再次对controller:raw-latex:<cite>index</cite>.py文件内容进行修改，修改后的内容如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>
<span class="kn">from</span> <span class="nn">model.db</span> <span class="kn">import</span> <span class="n">do_something_in_db</span>


<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="n">do_something_in_db</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>至此，将单个文件拆分为MVC项目结构的工作内容已经完成，最后来看一下拆分完成之后的项目整体结构：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ tree -L 2 flaskProject/
flaskProject/
├── app.py
├── controller
│   ├── __init__.py
│   └── index.py
├── model
│   ├── __init__.py
│   └── db.py
├── static
│   ├── foo
│   └── test.png
├── templates
│   └── index.html
└── venv
    ├── Lib
    ├── pyvenv.cfg
    └── Scripts
</pre></div>
</div>
<p>此后，添加新的Web接口时，就可以按照前面介绍的步骤，把相应的功能模块或者文件添加到对应的目录下并正确引用。</p>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id28">2.9 项目部署</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>当项目完成开发之后就需要部署到生产环境，与开发环境不同的是，生产环境需要保证Web服务运行的稳定性和执行效率。</p>
<p>而Flask自带的Web服务器在性能、稳定性、安全性上都不是最佳选择，替代方案是在生产环境通过Flask的WSGI进行部署和启动Web服务。</p>
<p>为了让Flask支持WSGI方式的部署，需要对Flask启动文件进行修改。修改后的文件内容如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">controller.index</span> <span class="kn">import</span> <span class="n">index</span>

<span class="k">def</span> <span class="nf">create_app</span><span class="p">():</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">app</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">create_app</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>修改后的文件中添加了一个create_app函数，它主要用来创建Flask实例对象；这个实例对象既可以用来直接启动Flask内置的Web服务器，也可以传递给WSGI服务器，用于启动Web服务。</p>
<p>支持Flask的WSGI服务器有很多，包括Gunicorn、Gevent、Twisted、waitress、uWSGI等。其中除了uWSGI是由C语言开发之外，其他都是用Python开发的第三方WSGI库。</p>
<p>以waitress为例，首先需要安装waitress的第三方库。具体命令如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install waitress
</pre></div>
</div>
<p>之后，确保当前目录为Flask启动文件所在目录，在命令行执行如下命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ waitress-serve --listen<span class="o">=</span>*:80 --call app:create_app
Serving on http://youcomputername:80
Serving on http://localhost:80
</pre></div>
</div>
<p>完整的Flask项目初始结构被存放在https://github.com/five3/python-sdet。</p>
<p>后续项目的后端开发也将基于该基础项目结构。在运行该基础项目之前，需要安装相应的依赖库，可在项目的根目录执行如下命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install-r requirements.txt
</pre></div>
</div>
</section>
<section id="flask-restful">
<h3><a class="toc-backref" href="#id29">2.10 Flask 开发 RESTful 服务</a><a class="headerlink" href="#flask-restful" title="Permalink to this headline">¶</a></h3>
<section id="restful">
<h4>RESTful定义<a class="headerlink" href="#restful" title="Permalink to this headline">¶</a></h4>
<p>RESTFUL是一种网络应用程序的设计风格和开发方式，基于HTTP，可以使用XML格式定义或JSON格式定义。</p>
</section>
<section id="id10">
<h4>RESTFUL特点<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<ol class="arabic simple">
<li><p>每一个URI代表1种资源；</p></li>
<li><p>客户端使用GET、POST、PUT、DELETE4个表示操作方式的动词对服务端资源进行操作：GET用来获取资源，POST用来新建资源（也可以用于更新资源），PUT用来更新资源，DELETE用来删除资源；</p></li>
<li><p>通过操作资源的表现形式来操作资源；</p></li>
<li><p>资源的表现形式是XML或者HTML；</p></li>
<li><p>客户端与服务端之间的交互在请求之间是无状态的，从客户端到服务端的每个请求都必须包含理解请求所必需的信息。</p></li>
</ol>
</section>
<section id="id11">
<h4>Flask RESTful框架<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>基于<code class="docutils literal notranslate"><span class="pre">Flask</span></code>开发<code class="docutils literal notranslate"><span class="pre">RESTful</span></code>的框架<code class="docutils literal notranslate"><span class="pre">Flask-RESTful</span></code>。官网地址http://www.pythondoc.com/Flask-RESTful/index.html</p>
</section>
<section id="id12">
<h4>安装<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">flask</span><span class="o">-</span><span class="n">restful</span>
</pre></div>
</div>
</section>
<section id="id13">
<h4>简单样例<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">import</span> <span class="nn">flask_restful</span> <span class="k">as</span> <span class="nn">restful</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">restful</span><span class="o">.</span><span class="n">Api</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">(</span><span class="n">restful</span><span class="o">.</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">}</span>

<span class="n">api</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id14">
<h4>完整样例<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask_restful</span> <span class="kn">import</span> <span class="n">reqparse</span><span class="p">,</span> <span class="n">abort</span><span class="p">,</span> <span class="n">Api</span><span class="p">,</span> <span class="n">Resource</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">marshal_with</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>


<span class="n">TODOS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;todo1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;build an API&#39;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;xxx&quot;</span><span class="p">},</span>
    <span class="s1">&#39;todo2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;?????&#39;</span><span class="p">},</span>
    <span class="s1">&#39;todo3&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;profit!&#39;</span><span class="p">},</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">abort_if_todo_doesnt_exist</span><span class="p">(</span><span class="n">todo_id</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">todo_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TODOS</span><span class="p">:</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Todo </span><span class="si">{}</span><span class="s2"> doesn&#39;t exist&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">todo_id</span><span class="p">))</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">reqparse</span><span class="o">.</span><span class="n">RequestParser</span><span class="p">()</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;task&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;task field&quot;</span><span class="p">)</span>


<span class="n">resource_fields</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span>   <span class="n">fields</span><span class="o">.</span><span class="n">String</span>
<span class="p">}</span>


<span class="k">class</span> <span class="nc">Todo</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="nd">@marshal_with</span><span class="p">(</span><span class="n">resource_fields</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo_id</span><span class="p">):</span>
        <span class="n">abort_if_todo_doesnt_exist</span><span class="p">(</span><span class="n">todo_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TODOS</span><span class="p">[</span><span class="n">todo_id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo_id</span><span class="p">):</span>
        <span class="n">abort_if_todo_doesnt_exist</span><span class="p">(</span><span class="n">todo_id</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">TODOS</span><span class="p">[</span><span class="n">todo_id</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">204</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">todo_id</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        <span class="n">task</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]}</span>
        <span class="n">TODOS</span><span class="p">[</span><span class="n">todo_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span>
        <span class="k">return</span> <span class="n">task</span><span class="p">,</span> <span class="mi">201</span>


<span class="k">class</span> <span class="nc">TodoList</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">TODOS</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
        <span class="n">todo_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">TODOS</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;todo&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">todo_id</span> <span class="o">=</span> <span class="s1">&#39;todo</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">todo_id</span>
        <span class="n">TODOS</span><span class="p">[</span><span class="n">todo_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">TODOS</span><span class="p">[</span><span class="n">todo_id</span><span class="p">],</span> <span class="mi">201</span>


<span class="n">api</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">TodoList</span><span class="p">,</span> <span class="s1">&#39;/todos&#39;</span><span class="p">)</span>
<span class="n">api</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">Todo</span><span class="p">,</span> <span class="s1">&#39;/todos/&lt;todo_id&gt;&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="2.%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E5%BA%93.html" class="btn btn-neutral float-left" title="4.2. 数据存储库" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../5.Web%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80/index.html" class="btn btn-neutral float-right" title="5. Web前端开发基础" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>