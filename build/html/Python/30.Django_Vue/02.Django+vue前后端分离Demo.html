<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>29.2. Django+vue前后端分离Demo &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="30. 编写Python的90个有效方法" href="../31.%E7%BC%96%E5%86%99Python%E7%9A%8490%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95/index.html" />
    <link rel="prev" title="29.1. Django+Vue.js快速构建项目示例" href="01.Django%2BVue.js%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%A4%BA%E4%BE%8B.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> 小健_Python_go_Devops
            <img src="../../_static/python_go.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../Go/index.html">Go语言学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Go_vs_Python/index.html">Go vs Python</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Python全栈系列</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../01.Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/index.html">1. Python数据类型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../02.Python%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/index.html">2. Python流程控制语句</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.Python%E5%87%BD%E6%95%B0/index.html">3. Python函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.Python%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0/index.html">4. Python内建函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../05.Python%E6%8E%A8%E5%AF%BC%E5%BC%8F%E5%AD%A6%E4%B9%A0/index.html">5. Python推导式学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../06.Python%E8%BF%AD%E4%BB%A3%E5%99%A8_%E7%94%9F%E6%88%90%E5%99%A8_%E8%A3%85%E9%A5%B0%E5%99%A8/index.html">6. Python生成器、迭代器、装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../07.Python%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1_OOP/index.html">7. Python面对对象设计_OOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../08.Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/index.html">8. Python异常处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../09.Python%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/index.html">9. Python文件操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../10.Python%E4%B8%AD%E7%9A%84%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/index.html">10. Python中包和模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../11.Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/index.html">11. Python正则表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../12.Python%E6%A0%87%E5%87%86%E5%BA%93/index.html">12. Python 标准库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../13.Python%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">13. Python对数据库的操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../14.Python%E4%B8%89%E6%96%B9%E5%BA%93/index.html">14. Python 三方库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/index.html">15. Python 网络编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../16.Python%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/index.html">16. Python 进程和线程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../17.Python%E8%AF%AD%E8%A8%80%E7%9A%84%E6%89%A9%E5%B1%95%E4%B8%8E%E5%B5%8C%E5%85%A5/index.html">17. Python与C语言扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="../18.%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%9A%84Python%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.html">18. 系统管理员的Python脚本编程指南-读书笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../20.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/index.html">19. Python自动化运维最佳实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../21.Python%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/index.html">20. Python进阶学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../22.Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/index.html">21. Python网络爬虫</a></li>
<li class="toctree-l2"><a class="reference internal" href="../23.%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/index.html">22. 前端基础知识</a></li>
<li class="toctree-l2"><a class="reference internal" href="../24.Python%E6%A1%86%E6%9E%B6/index.html">23. Python框架</a></li>
<li class="toctree-l2"><a class="reference internal" href="../25.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/index.html">24. Python开发环境部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../26.%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6/index.html">25. 我的第一本算法书</a></li>
<li class="toctree-l2"><a class="reference internal" href="../27.Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/index.html">26. Python3网络爬虫开发实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../28.Python%E8%AE%A9%E7%B9%81%E7%90%90%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96/index.html">27. Python让繁琐的工作自动化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../29.%E7%96%AF%E7%8B%82%E7%9A%84Python%E8%AE%B2%E4%B9%89/index.html">28. 疯狂的Python讲义</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">29. Django_Vue</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="01.Django%2BVue.js%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%A4%BA%E4%BE%8B.html">29.1. Django+Vue.js快速构建项目示例</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">29.2. Django+vue前后端分离Demo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#django">29.2.1. Django部分</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id12">29.2.2. 前端部分</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id31">29.2.3. 参考文献</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../31.%E7%BC%96%E5%86%99Python%E7%9A%8490%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95/index.html">30. 编写Python的90个有效方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../32.Vue3.0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/index.html">31. Vue3.0管理系统</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5/index.html">Python测试开发入门与实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Vue/index.html">Vue.js企业开发实战</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Vue_Node.js/index.html">Vue.js+Node.js开发实战</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">小健_Python_go_Devops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Python全栈系列</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">29. </span>Django_Vue</a> &raquo;</li>
      <li><span class="section-number">29.2. </span>Django+vue前后端分离Demo</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Python/30.Django_Vue/02.Django+vue前后端分离Demo.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#django-vuedemo" id="id32">Django+vue前后端分离Demo</a></p>
<ul>
<li><p><a class="reference internal" href="#django" id="id33">Django部分</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id34">1.环境准备</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id35">2.创建项目</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id36">3.后端准备</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id37">4.启动服务测试接口</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id12" id="id38">前端部分</a></p>
<ul>
<li><p><a class="reference internal" href="#id13" id="id39">5.前端准备</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id40">6. 解决跨域</a></p></li>
<li><p><a class="reference internal" href="#id21" id="id41">7.启动项目</a></p></li>
<li><p><a class="reference internal" href="#id26" id="id42">8.整合项目</a></p></li>
<li><p><a class="reference internal" href="#id29" id="id43">9. 再次启动项目</a></p></li>
<li><p><a class="reference internal" href="#id30" id="id44">10.环境搭建与部署</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id31" id="id45">参考文献</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="django-vuedemo">
<h1><a class="toc-backref" href="#id32"><span class="section-number">29.2. </span>Django+vue前后端分离Demo</a><a class="headerlink" href="#django-vuedemo" title="Permalink to this headline">¶</a></h1>
<p>从零开始搭建Django+vue前后端分离项目</p>
<section id="django">
<h2><a class="toc-backref" href="#id33"><span class="section-number">29.2.1. </span>Django部分</a><a class="headerlink" href="#django" title="Permalink to this headline">¶</a></h2>
<section id="id1">
<h3><a class="toc-backref" href="#id34">1.环境准备</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python --version
Python 3.7.0

18793@DESKTOP-PMJTNGI MINGW64 /d/0项目/book_project
$ python -m django --version
3.1.7
</pre></div>
</div>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id35">2.创建项目</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>## 方法1:
1.创建项目：django-admin startproject book_project
2.再新建app：
进入项目根目录：
cd book_project
python3 manage.py startapp book


## 方法2:
pycharm---推荐
</pre></div>
</div>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id36">3.后端准备</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<section id="settings">
<h4>3.1 更改settings配置<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h4>
<section id="id4">
<h5>3.1.1 更改数据库配置<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>在book_project下的settings.py配置文件中，把默认的sqllite3数据库换成我们的mysql数据库</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;book_demo&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;admin#123&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="pymysql">
<h5>3.1.2 导入pymysql包<a class="headerlink" href="#pymysql" title="Permalink to this headline">¶</a></h5>
<p>在项目setting文件同级__init__.py文件下加入</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymysql</span>

<span class="n">pymysql</span><span class="o">.</span><span class="n">version_info</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;final&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">i</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pypi</span><span class="o">.</span><span class="n">doubanio</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">simple</span><span class="o">/</span> <span class="o">--</span><span class="n">trusted</span><span class="o">-</span><span class="n">host</span> <span class="n">pypi</span><span class="o">.</span><span class="n">doutsnio</span><span class="o">.</span><span class="n">com</span> <span class="n">pymysql</span>
</pre></div>
</div>
</section>
<section id="installed-apps">
<h5>3.1.3 更改installed_apps<a class="headerlink" href="#installed-apps" title="Permalink to this headline">¶</a></h5>
<p>将创建的app加入到installed_apps里面</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;book.apps.BookConfig&#39;</span><span class="p">,</span>
    <span class="s1">&#39;book&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="model">
<h4>3.2 创建model<a class="headerlink" href="#model" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">models.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="c1"># Create your models here.</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">book_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
    <span class="n">add_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;书名&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">verbose_name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">book_name</span>
</pre></div>
</div>
</section>
<section id="id5">
<h4>3.3 新增接口<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>在app目录下的views里我们新增两个接口，</p>
<ul class="simple">
<li><p>show_books:
返回所有的书籍列表（通过JsonResponse返回能被前端识别的json格式数据）</p></li>
<li><p>add_book: 接受一个get请求，往数据库里添加一条book数据</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create your views here.</span>
<span class="kn">from</span> <span class="nn">book.models</span> <span class="kn">import</span> <span class="n">Book</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.http</span> <span class="kn">import</span> <span class="n">require_http_methods</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span>
<span class="kn">from</span> <span class="nn">django.core</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="c1"># Create your views here.</span>
<span class="nd">@require_http_methods</span><span class="p">([</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">add_book</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="p">(</span><span class="n">book_name</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;book_name&#39;</span><span class="p">))</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;success&#39;</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;error_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span>
        <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;error_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>


<span class="nd">@require_http_methods</span><span class="p">([</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">show_books</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">books</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">books</span><span class="p">))</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;success&#39;</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;error_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20000</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;error_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="app">
<h4>3.4 创建app路由<a class="headerlink" href="#app" title="Permalink to this headline">¶</a></h4>
<section id="id6">
<h5>3.4.1 将新接口加入到app的路由下<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<p>在app目录下，新增一个urls.py文件，把我们新增的两个接口添加到路由里</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">book</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;add_book$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_book</span><span class="p">),</span>
    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;show_books/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">show_books</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id7">
<h5>3.4.2 将app的路由，导入到项目路由<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<p>把app下的urls添加到项目book_project下的urls中，才能完成路由</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>

<span class="kn">from</span> <span class="nn">book</span> <span class="kn">import</span> <span class="n">urls</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
<section id="id8">
<h4>3.5 初始化数据库<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>进入项目根目录，输入</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
</pre></div>
</div>
</section>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id37">4.启动服务测试接口</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<section id="id10">
<h4>4.1 启动服务<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>进入项目根目录，输入：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python manage.py runserver
Watching for file changes with StatReloader
Performing system checks...

System check identified no issues (0 silenced).
March 08, 2021 - 22:57:29
Django version 3.1.7, using settings &#39;book_project.settings&#39;
Starting development server at http://127.0.0.1:8000/
Quit the server with CTRL-BREAK.
</pre></div>
</div>
</section>
<section id="id11">
<h4>4.2 验证接口<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>postman调用：</p>
<p>插入书籍接口：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>http://127.0.0.1:8000/api/add_book?book_name=雪山飞狐-金庸版
</pre></div>
</div>
<p>查询书籍接口：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">show_books</span><span class="o">/</span>
</pre></div>
</div>
<img alt="../../_images/postman0001.png" src="../../_images/postman0001.png" />
<p>至此后端接口准备完毕，下面开始前端</p>
</section>
</section>
</section>
<section id="id12">
<h2><a class="toc-backref" href="#id38"><span class="section-number">29.2.2. </span>前端部分</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>前端用的是vue-admin-template是vue-element-admin的基础模版</p>
<p>使用规则见：<a class="reference external" href="https://panjiachen.github.io/vue-element-admin-site/zh/guide/#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">https://panjiachen.github.io/vue-element-admin-site/zh/guide/#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84</a></p>
<section id="id13">
<h3><a class="toc-backref" href="#id39">5.前端准备</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<section id="id14">
<h4>5.1 下载模版<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 克隆项目</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">PanJiaChen</span><span class="o">/</span><span class="n">vue</span><span class="o">-</span><span class="n">admin</span><span class="o">-</span><span class="n">template</span><span class="o">.</span><span class="n">git</span>
<span class="c1"># 也可以多下载个完整的模版，用到组件时，copy过来</span>
<span class="c1"># git clone https://github.com/PanJiaChen/vue-element-admin.git</span>

<span class="c1"># 进入项目目录</span>
<span class="n">cd</span> <span class="n">vue</span><span class="o">-</span><span class="n">admin</span><span class="o">-</span><span class="n">template</span>

<span class="c1"># 安装依赖， 建议不要用 cnpm 安装 会有各种诡异的bug 可以通过如下操作解决 npm 下载速度慢的问题</span>
<span class="n">npm</span> <span class="n">install</span> <span class="o">--</span><span class="n">registry</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">registry</span><span class="o">.</span><span class="n">npm</span><span class="o">.</span><span class="n">taobao</span><span class="o">.</span><span class="n">org</span>

<span class="c1"># 本地开发 启动项目</span>
<span class="n">npm</span> <span class="n">run</span> <span class="n">dev</span>
<span class="c1"># ps：启动的时候报错了，提示提示vue-cli-service: command not found</span>
<span class="c1"># 进入到项目目录下，执行：rm –rf node_modules and npm install</span>
</pre></div>
</div>
</section>
<section id="id15">
<h4>5.2 项目目录结构，启动效果<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
</section>
<section id="api">
<h4>5.3 与服务端交互，添加api<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">src/api/book.js</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">request</span> <span class="kn">from</span> <span class="s1">&#39;@/utils/request&#39;</span>

<span class="n">export</span> <span class="n">function</span> <span class="n">getList</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">request</span><span class="p">({</span>
    <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;/api/show_books/&#39;</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;get&#39;</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="n">export</span> <span class="n">function</span> <span class="n">addbook</span><span class="p">(</span><span class="n">book_name</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">request</span><span class="p">({</span>
    <span class="n">url</span><span class="p">:</span> <span class="s1">&#39;/api/add_book&#39;</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span>
    <span class="n">params</span><span class="p">:</span> <span class="p">{</span> <span class="n">book_name</span> <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="book">
<h4>5.4 加侧边栏-book<a class="headerlink" href="#book" title="Permalink to this headline">¶</a></h4>
<section id="viewsvue">
<h5>5.4.1 添加views的vue文件<a class="headerlink" href="#viewsvue" title="Permalink to this headline">¶</a></h5>
<p>在src-&gt;views-&gt;创建book文件夹-&gt;index.vue</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;template&gt;
  &lt;div class=&quot;app-container&quot;&gt;
    &lt;el-row display=&quot;margin-top:10px&quot;&gt;
      &lt;el-input v-model=&quot;input_bookname&quot; placeholder=&quot;请输入书名&quot; style=&quot;display:inline-table; width: 30%; float:left&quot;&gt;&lt;/el-input&gt;
      &lt;el-button type=&quot;primary&quot; @click=&quot;addBook()&quot; style=&quot;float:left; margin: 2px;&quot;&gt;新增&lt;/el-button&gt;
    &lt;/el-row&gt;
    &lt;el-row&gt;
      &lt;el-table :data=&quot;list_book&quot; element-loading-text=&quot;Loading&quot; border fit highlight-current-row&gt;
        &lt;el-table-column align=&quot;center&quot; label=&quot;ID&quot; width=&quot;95&quot;&gt;
          &lt;template slot-scope=&quot;scope&quot;&gt;
            {{ scope.row.pk }}
          &lt;/template&gt;
        &lt;/el-table-column&gt;
        &lt;el-table-column label=&quot;Book_name&quot;&gt;
          &lt;template slot-scope=&quot;scope&quot;&gt;
            {{ scope.row.fields.book_name }}
          &lt;/template&gt;
        &lt;/el-table-column&gt;
        &lt;el-table-column label=&quot;Time&quot; align=&quot;center&quot;&gt;
          &lt;template slot-scope=&quot;scope&quot;&gt;
            &lt;span&gt;{{ scope.row.fields.add_time }}&lt;/span&gt;
          &lt;/template&gt;
        &lt;/el-table-column&gt;
      &lt;/el-table&gt;
    &lt;/el-row&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import {
  getList,
  addbook
} from &#39;@/api/book&#39;

export default {
  filters: {
    statusFilter(status) {
      const statusMap = {
        published: &#39;success&#39;,
        draft: &#39;gray&#39;,
        deleted: &#39;danger&#39;
      }
      return statusMap[status]
    }
  },
  data() {
    return {
      list_book: null,
      listLoading: true,
      input_bookname: &#39;&#39;
    }
  },
  created() {
    this.getList()
  },
  methods: {
    getList() {
      this.listLoading = true
      getList().then(response =&gt; {
        if (response.error_num === 0) {
          this.list_book = response[&#39;list&#39;]
          this.listLoading = false
        } else {
          this.$message.error(&#39;查询书籍失败&#39;)
          console.log(response[&#39;msg&#39;])
        }
      })
    },
    addBook() {
      addbook(this.input_bookname).then(response =&gt; {
        if (response.error_num === 0) {
          this.getList()
          this.input_bookname = &#39;&#39;
        } else {
          this.$message.error(&#39;新增书籍失败，请重试&#39;)
          console.log(response[&#39;msg&#39;])
        }
      })
    }
  }
}
&lt;/script&gt;
</pre></div>
</div>
</section>
<section id="id16">
<h5>5.4.2 给菜单加路由，就完成了新增一个侧边栏<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h5>
<p>修改src-&gt;router-&gt;index.js文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="n">path</span><span class="p">:</span> <span class="s1">&#39;/book_test&#39;</span><span class="p">,</span>
  <span class="n">component</span><span class="p">:</span> <span class="n">Layout</span><span class="p">,</span>
  <span class="n">children</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="n">path</span><span class="p">:</span> <span class="s1">&#39;book&#39;</span><span class="p">,</span>
      <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;Book&#39;</span><span class="p">,</span>
      <span class="n">component</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="n">import</span><span class="p">(</span><span class="s1">&#39;@/views/book/index&#39;</span><span class="p">),</span>
      <span class="n">meta</span><span class="p">:</span> <span class="p">{</span> <span class="n">title</span><span class="p">:</span> <span class="s1">&#39;Book&#39;</span><span class="p">,</span> <span class="n">icon</span><span class="p">:</span> <span class="s1">&#39;form&#39;</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
</section>
</section>
<section id="id17">
<h4>5.5 启动前端项目<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>启动命令：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">run</span> <span class="n">dev</span>
</pre></div>
</div>
<p>启动后会出现异常，异常情况很多。404/500/403等等情况</p>
<p>先解决跨域</p>
</section>
</section>
<section id="id18">
<h3><a class="toc-backref" href="#id40">6. 解决跨域</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<section id="id19">
<h4>6.1 后端django修改<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">django</span><span class="o">-</span><span class="n">cors</span><span class="o">-</span><span class="n">headers</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;https://pypi.doubanio.com/simple/&quot;</span>
</pre></div>
</div>
<p>在book_project-&gt;settings文件夹下，修改如下内容，注意顺序</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;corsheaders.middleware.CorsMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">CORS_ORIGIN_ALLOW_ALL</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="id20">
<h4>6.2 前端添加跨域相关<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>添加proxy</p>
<p>ps: 不同版本可能位置不一样。我下载的这个模版是下面的路径
主目录的vue.config.js文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">devServer</span><span class="p">:</span> <span class="p">{</span>
  <span class="n">port</span><span class="p">:</span> <span class="n">port</span><span class="p">,</span>
  <span class="nb">open</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
  <span class="n">overlay</span><span class="p">:</span> <span class="p">{</span>
    <span class="n">warnings</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">true</span>
  <span class="p">},</span>
  <span class="n">proxy</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;/api&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="n">target</span><span class="p">:</span> <span class="s1">&#39;http://127.0.0.1:8000&#39;</span><span class="p">,</span>
      <span class="n">changeOrigin</span><span class="p">:</span> <span class="n">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
</pre></div>
</div>
<p>.env.development文件修改</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># just a flag</span>
<span class="n">ENV</span> <span class="o">=</span> <span class="s1">&#39;development&#39;</span>

<span class="c1"># base api</span>
<span class="c1"># VUE_APP_BASE_API = &#39;/dev-api&#39;</span>
<span class="n">VUE_APP_BASE_API</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</pre></div>
</div>
</section>
</section>
<section id="id21">
<h3><a class="toc-backref" href="#id41">7.启动项目</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<section id="id22">
<h4>7.1 启动后端项目<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">runserver</span>
</pre></div>
</div>
</section>
<section id="id23">
<span id="id24"></span><h4>7.2 启动前端项目<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">run</span> <span class="n">dev</span>
</pre></div>
</div>
</section>
<section id="id25">
<h4>7.3 查看效果<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
</section>
</section>
<section id="id26">
<h3><a class="toc-backref" href="#id42">8.整合项目</a><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>目前我们已经分别完成了Django后端和Vue.js前端工程的创建和编写，但实际上它们是运行在各自的服务器上，和我们的要求是不一致的。
因此我们须要把Django的TemplateView指向我们刚才生成的前端dist文件</p>
<section id="dist">
<h4>8.1 前端打包，生成dist文件<a class="headerlink" href="#dist" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">## 打包vue项目，会将所有东西打包成一个dist文件夹</span>
<span class="n">npm</span> <span class="n">run</span> <span class="n">build</span><span class="p">:</span><span class="n">prod</span>
</pre></div>
</div>
</section>
<section id="id27">
<h4>8.2 配置django<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<section id="appfront-vuedist">
<h5>8.2.1 创建appfront文件夹，将vue打包的dist复制过来<a class="headerlink" href="#appfront-vuedist" title="Permalink to this headline">¶</a></h5>
</section>
<section id="urls">
<h5>8.2.2 修改入口urls文件<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>

<span class="kn">from</span> <span class="nn">book</span> <span class="kn">import</span> <span class="n">urls</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">re_path</span><span class="p">(</span><span class="s1">&#39;api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">urls</span><span class="p">)),</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">TemplateView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s1">&#39;index.html&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="settings-index-html">
<h5>8.2.3 修改settings文件，让代码能找到index.html<a class="headerlink" href="#settings-index-html" title="Permalink to this headline">¶</a></h5>
<p>TEMPLATES更改DIRS，配置下模版</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="c1"># &#39;DIRS&#39;: [BASE_DIR / &#39;templates&#39;],</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;appfront/dist&#39;</span><span class="p">],</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id28">
<h5>8.2.4 修改settings文件，配置一下静态文件的搜索路径<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;appfront/dist/static&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="id29">
<h3><a class="toc-backref" href="#id43">9. 再次启动项目</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>此次不用专门启动前端了,直接</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">runserver</span>
</pre></div>
</div>
<p>然后访问<code class="docutils literal notranslate"><span class="pre">http://127.0.0.1:8000/</span></code>就到了入口页面</p>
<img alt="../../_images/vue-admin0001.png" src="../../_images/vue-admin0001.png" />
</section>
<section id="id30">
<h3><a class="toc-backref" href="#id44">10.环境搭建与部署</a><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>CentOS 系统可以使用 yum 安装必要的包</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 如果你使用git来托管代码的话</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">git</span>

<span class="c1"># 如果你要在服务器上构建前端</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">nodejs</span>
<span class="n">yum</span> <span class="n">install</span> <span class="n">npm</span>

<span class="n">yum</span> <span class="n">install</span> <span class="n">nginx</span>
</pre></div>
</div>
<blockquote>
<div><p>我们使用 uwsgi 来处理 Django 请求，使用 nginx 处理 static
文件（即之前 build 之后 dist
里面的static，这里默认前端已经打包好了，如果在服务端打包前端需要安装nodejs，npm等）</p>
</div></blockquote>
<p>安装uWsgi</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">yum</span> <span class="n">install</span> <span class="n">uwsgi</span>
<span class="c1"># 或者</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">uwsgi</span>
</pre></div>
</div>
<p>我们使用配置文件启动uwsgi，比较清楚</p>
<p>uwsgi配置文件：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[uwsgi]
socket = 127.0.0.1:9292
stats = 127.0.0.1:9293
workers = 4
# 项目根目录
chdir = /opt/inner_ulb_manager
touch-reload = /opt/inner_ulb_manager
py-auto-reload = 1
# 在项目跟目录和项目同名的文件夹里面的一个文件
module= inner_ulb_manager.wsgi
pidfile = /var/run/inner_ulb_manager.pid
daemonize = /var/log/inner_ulb_manager.log
</pre></div>
</div>
<p>nginx 配置文件：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>server {
    listen 8888;
    server_name 120.132.**.75;
    root /opt/inner_ulb_manager;
    access_log /var/log/nginx/access_narwhals.log;
    error_log /var/log/nginx/error_narwhals.log;

    location / {
            uwsgi_pass 127.0.0.1:9292;
            include /etc/nginx/uwsgi_params;
    }
    location /static/ {
            root  /opt/inner_ulb_manager/;
            access_log off;
    }
    location ^~ /admin/ {
            uwsgi_pass 127.0.0.1:9292;
            include /etc/nginx/uwsgi_params;
    }
}
</pre></div>
</div>
<p>/opt/inner_ulb_manager/static 即为静态文件目录，那么现在我们静态文件还在
frontend/dist 怎么办，不怕，Django给我们提供了命令：</p>
<p>先去settings里面配置：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>STATIC_ROOT = os.path.join(BASE_DIR, &quot;static&quot;)
</pre></div>
</div>
<p>然后在存在manage.py的目录，即项目跟目录执行：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>python manage.py collectstatic
</pre></div>
</div>
<p>这样frontend/dist/static里面的东西就到了项目根目录的static文件夹里面了</p>
<p>那么为什么不直接手动把构建好的dist/static拷过来呢，因为开始提过Django自带的App：admin
也有一些静态文件（css,js等），它会一并collect过来，毕竟nginx只认项目跟目录的静态文件，它不知道django把它自己的需求文件放到哪了</p>
<p>开头说过Django配置灵活，那么我们专门为Django创建一个生产环境的配置
prod.py</p>
<p>prod.py 与 默认 settings.py 同目录</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># 导入公共配置
from .settings import *

# 生产环境关闭DEBUG模式
DEBUG = False

# 生产环境开启跨域
CORS_ORIGIN_ALLOW_ALL = False

# 特别说明，下面这个不需要，因为前端是VueJS构建的，它默认使用static作为静态文件入口，我们nginx配置static为入口即可，保持一致，没Django什么事
STATIC_URL = &#39;/static/&#39;
</pre></div>
</div>
<p>如何使用这个配置呢，进入 wisg.py 即uwsgi配置里面的module配置修改为：</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>import os

from django.core.wsgi import get_wsgi_application

os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;**inner_ulb_manager.prod**&quot;)

application = get_wsgi_application()
</pre></div>
</div>
<p>启动uwsgi</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>uwsgi --ini inner_ulb_manager.ini
</pre></div>
</div>
<p>启动ngingx</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>service nginx start
</pre></div>
</div>
<p>至此，部署就完成了。</p>
</section>
</section>
<section id="id31">
<h2><a class="toc-backref" href="#id45"><span class="section-number">29.2.3. </span>参考文献</a><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.cnblogs.com/zhangxue521/p/12957816.html">https://www.cnblogs.com/zhangxue521/p/12957816.html</a></p>
<p><a class="reference external" href="https://zhuanlan.zhihu.com/p/24893786">https://zhuanlan.zhihu.com/p/24893786</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="01.Django%2BVue.js%E5%BF%AB%E9%80%9F%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE%E7%A4%BA%E4%BE%8B.html" class="btn btn-neutral float-left" title="29.1. Django+Vue.js快速构建项目示例" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../31.%E7%BC%96%E5%86%99Python%E7%9A%8490%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95/index.html" class="btn btn-neutral float-right" title="30. 编写Python的90个有效方法" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>