<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>23.4.6. 玩转Django2.0-模型与数据库 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="23.4.7. 玩转Django2.0-模板" href="06.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E6%9D%BF.html" />
    <link rel="prev" title="23.4.5. 玩转Django2.0-视图和路由" href="05.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A7%86%E5%9B%BE%E5%92%8C%E8%B7%AF%E7%94%B1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> 小健_Python_go_Devops
            <img src="../../../_static/python_go.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Go/index.html">Go语言学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Go_vs_Python/index.html">Go vs Python</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Python全栈系列</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../01.Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/index.html">1. Python数据类型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02.Python%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/index.html">2. Python流程控制语句</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03.Python%E5%87%BD%E6%95%B0/index.html">3. Python函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../04.Python%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0/index.html">4. Python内建函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../05.Python%E6%8E%A8%E5%AF%BC%E5%BC%8F%E5%AD%A6%E4%B9%A0/index.html">5. Python推导式学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../06.Python%E8%BF%AD%E4%BB%A3%E5%99%A8_%E7%94%9F%E6%88%90%E5%99%A8_%E8%A3%85%E9%A5%B0%E5%99%A8/index.html">6. Python生成器、迭代器、装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../07.Python%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1_OOP/index.html">7. Python面对对象设计_OOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../08.Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/index.html">8. Python异常处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../09.Python%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/index.html">9. Python文件操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../10.Python%E4%B8%AD%E7%9A%84%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/index.html">10. Python中包和模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../11.Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/index.html">11. Python正则表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../12.Python%E6%A0%87%E5%87%86%E5%BA%93/index.html">12. Python 标准库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../13.Python%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">13. Python对数据库的操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../14.Python%E4%B8%89%E6%96%B9%E5%BA%93/index.html">14. Python 三方库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../15.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/index.html">15. Python 网络编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../16.Python%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/index.html">16. Python 进程和线程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../17.Python%E8%AF%AD%E8%A8%80%E7%9A%84%E6%89%A9%E5%B1%95%E4%B8%8E%E5%B5%8C%E5%85%A5/index.html">17. Python与C语言扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../18.%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%9A%84Python%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.html">18. 系统管理员的Python脚本编程指南-读书笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../20.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/index.html">19. Python自动化运维最佳实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../21.Python%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/index.html">20. Python进阶学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../22.Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/index.html">21. Python网络爬虫</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../23.%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/index.html">22. 前端基础知识</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">23. Python框架</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../01.%E5%B8%B8%E7%94%A8%E7%9A%84GUI%E6%A1%86%E6%9E%B6/index.html">23.1. 常用的GUI框架</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02.Flask/index.html">23.2. Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03.Scrapy/index.html">23.3. Scrapy</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">23.4. Django</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="01.%E5%AE%89%E8%A3%85DjangoWeb%E6%A1%86%E6%9E%B6.html">23.4.1. 安装DjangoWeb框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="02.Django%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8.html">23.4.2. Django框架的使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="03.Django%E6%B5%81%E7%A8%8B%E8%B7%91%E9%80%9A.html">23.4.3. Django流程跑通</a></li>
<li class="toctree-l4"><a class="reference internal" href="04.%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83-%E5%BC%80%E5%8F%91Django%E7%AB%99%E7%82%B9.html">23.4.4. 实战演练-开发Django站点</a></li>
<li class="toctree-l4"><a class="reference internal" href="05.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A7%86%E5%9B%BE%E5%92%8C%E8%B7%AF%E7%94%B1.html">23.4.5. 玩转Django2.0-视图和路由</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">23.4.6. 玩转Django2.0-模型与数据库</a></li>
<li class="toctree-l4"><a class="reference internal" href="06.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E6%9D%BF.html">23.4.7. 玩转Django2.0-模板</a></li>
<li class="toctree-l4"><a class="reference internal" href="07.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A1%A8%E5%8D%95%E4%B8%8E%E6%A8%A1%E5%9E%8B.html">23.4.8. 玩转Django2.0-表单与模型</a></li>
<li class="toctree-l4"><a class="reference internal" href="08.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93.html">23.4.9. 玩转Django2.0-模型与数据库</a></li>
<li class="toctree-l4"><a class="reference internal" href="09.%E7%8E%A9%E8%BD%ACDjango2.0-admin%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F.html">23.4.10. 玩转Django2.0-admin后台系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="10.%E7%8E%A9%E8%BD%ACDjango2.0-Auth%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F.html">23.4.11. 玩转Django2.0-Auth认证系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="11.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%B8%B8%E7%94%A8%E7%9A%84Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F.html">23.4.12. 玩转Django2.0-常用的Web应用程序</a></li>
<li class="toctree-l4"><a class="reference internal" href="12.%E7%8E%A9%E8%BD%ACDjango2.0-%E9%9F%B3%E4%B9%90%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91.html">23.4.13. 玩转Django2.0-音乐网站开发</a></li>
<li class="toctree-l4"><a class="reference internal" href="13.%E7%8E%A9%E8%BD%ACDjango2.0-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8.html">23.4.14. 玩转Django2.0-第三方功能应用</a></li>
<li class="toctree-l4"><a class="reference internal" href="14.%E7%8E%A9%E8%BD%ACDjango2.0-Django%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2.html">23.4.15. 玩转Django2.0-Django项目上线部署</a></li>
<li class="toctree-l4"><a class="reference internal" href="15.%E7%8E%A9%E8%BD%ACDjango2.0-Django-Rest-Framework%E6%A1%86%E6%9E%B6.html">23.4.16. 玩转Django2.0-Django-Rest-Framework框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="16.%E7%8E%A9%E8%BD%ACDjango2.0-django%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E4%B8%80.html">23.4.17. 玩转Django2.0-django图书管理系统一</a></li>
<li class="toctree-l4"><a class="reference internal" href="17.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB-django%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91%E4%B8%80.html">23.4.18. 玩转Django2.0-前后端分离-django主机管理开发一</a></li>
<li class="toctree-l4"><a class="reference internal" href="18.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB-django%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91%E4%BA%8C.html">23.4.19. 前后端分离-django主机管理开发二</a></li>
<li class="toctree-l4"><a class="reference internal" href="20.drf-%E8%AE%A4%E8%AF%81.html">23.4.20. drf-认证</a></li>
<li class="toctree-l4"><a class="reference internal" href="21.drf-%E8%A7%86%E5%9B%BE.html">23.4.21. drf视图</a></li>
<li class="toctree-l4"><a class="reference internal" href="29.%E9%99%84%E5%BD%951.Django%E5%85%A5%E9%97%A8-%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0.html">23.4.22. 附录1.Django入门+实战教程+笔记</a></li>
<li class="toctree-l4"><a class="reference internal" href="30.%E9%99%84%E5%BD%951.Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2.html">23.4.23. 附录1.Django项目的部署</a></li>
<li class="toctree-l4"><a class="reference internal" href="30.%E9%99%84%E5%BD%952.Django-REST-framework%E5%AD%A6%E4%B9%A0.html">23.4.24. django-rest-framework学习</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../05.Tornado/index.html">23.5. Tornado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06.Python%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-Django-Flask/index.html">23.6. Python高效开发实战-Django、Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07.Python-Django-Web%E5%85%B8%E5%9E%8B%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/index.html">23.7. Python-Django-Web典型模块开发实战</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../25.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/index.html">24. Python开发环境部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../26.%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6/index.html">25. 我的第一本算法书</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../27.Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/index.html">26. Python3网络爬虫开发实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../28.Python%E8%AE%A9%E7%B9%81%E7%90%90%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96/index.html">27. Python让繁琐的工作自动化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../29.%E7%96%AF%E7%8B%82%E7%9A%84Python%E8%AE%B2%E4%B9%89/index.html">28. 疯狂的Python讲义</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../30.Django_Vue/index.html">29. Django_Vue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../31.%E7%BC%96%E5%86%99Python%E7%9A%8490%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95/index.html">30. 编写Python的90个有效方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../32.Vue3.0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/index.html">31. Vue3.0管理系统</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5/index.html">Python测试开发入门与实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vue/index.html">Vue.js企业开发实战</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vue_Node.js/index.html">Vue.js+Node.js开发实战</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">小健_Python_go_Devops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Python全栈系列</a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">23. </span>Python框架</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">23.4. </span>Django</a> &raquo;</li>
      <li><span class="section-number">23.4.6. </span>玩转Django2.0-模型与数据库</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/Python/24.Python框架/04.Django/06.玩转Django2.0-模型与数据库.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#django2-0" id="id22">玩转Django2.0-模型与数据库</a></p>
<ul>
<li><p><a class="reference internal" href="#orm" id="id23">1. ORM优缺点</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id24">ORM的优点</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id25">ORM的缺点</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id26">ORM的映射关系</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id27">写项目的注意点</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id5" id="id28">2. 单表操作</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id29">2.1 创建库</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id30">2.2 创建表</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id31">2.3 更多字段和参数</a></p></li>
<li><p><a class="reference internal" href="#settings" id="id32">2.4 settings配置</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id12" id="id33">3.构建模型</a></p></li>
<li><p><a class="reference internal" href="#id13" id="id34">4. 数据表的关系</a></p>
<ul>
<li><p><a class="reference internal" href="#id14" id="id35">4.1 一对一关系</a></p></li>
<li><p><a class="reference internal" href="#id15" id="id36">4.2 一对多关系</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id37">4.3 多对多关系</a></p></li>
<li><p><a class="reference internal" href="#id17" id="id38">4.4 如何确定表关系？</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id18" id="id39">5.数据表的读写</a></p>
<ul>
<li><p><a class="reference internal" href="#id19" id="id40">5.1 多表查询</a></p></li>
<li><p><a class="reference internal" href="#id20" id="id41">5.2 ORM操作</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id21" id="id42">6. 文献参考</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="django2-0">
<h1><a class="toc-backref" href="#id22"><span class="section-number">23.4.6. </span>玩转Django2.0-模型与数据库</a><a class="headerlink" href="#django2-0" title="Permalink to this headline">¶</a></h1>
<p>Django对各种数据库提供了很好的支持，包括：PostgreSQL、MySQL、SQLite和Oracle，而且为这些数据库提供了统一的调用API，这些API统称为ORM框架。通过使用Django内置的ORM框架可以实现数据库连接和读写操作。</p>
<section id="orm">
<h2><a class="toc-backref" href="#id23">1. ORM优缺点</a><a class="headerlink" href="#orm" title="Permalink to this headline">¶</a></h2>
<section id="id1">
<h3><a class="toc-backref" href="#id24">ORM的优点</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>1.符合python语法。</p>
<p>2.自己写的sql语句，效率不够高。因为它直接传参，就可以使用了。</p>
<ol class="arabic simple" start="3">
<li><p>不需要自己写SQL，对于类的操作，会转换成相应的SQL语句，来操作数据库。(核心功能)</p></li>
</ol>
<p>4.它不属于硬编码，它不针对于MySQL。比如公司发展了，需要换成oracle数据库。</p>
<p>如果项目中的sql语句写死了，那么项目中的所有的sql语句，都得更换。如果用了ORM，只需要改一处，
直接修改setting.py中的数据库引擎，换成oracle，就可以了。这样，方便数据库迭代，这是它最大的优点。</p>
</div></blockquote>
</section>
<section id="id2">
<h3><a class="toc-backref" href="#id25">ORM的缺点</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>1.执行效率低。，它是从上层到下层的操作。
它有一个翻译的过程。所以不如直接写SQL操作的执行效率低。</p>
<p>但是影响不大。真遇到这种请情况，优化SQL就可以了。
效率问题，跟SQL有很大的关系。
现在不关心ORM效率问题。除非SQL语句的造诣达到一定级别的时候，就需要使用原生SQL语句。orm还提供了，执行原生SQL的接口。可以直接执行原生SQL。</p>
<p>刚开始写ORM时，一定要对应SQL语句，去写ORM</p>
</div></blockquote>
<ul class="simple">
<li><p><em>MVC或者MVC框架中包括一个重要的部分，就是ORM，它实现了数据模型与数据库的解耦，即数据模型的设计不需要依赖于特定的数据库，通过简单的配置就可以轻松更换数据库，这极大的减轻了开发人员的工作量，不需要面对因数据库变更而导致的无效劳动</em></p></li>
<li><p><em>ORM是“对象-关系-映射”的简称。</em></p></li>
</ul>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id26">ORM的映射关系</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>          <span class="n">ORM引擎</span>
<span class="n">python</span> <span class="o">---------------&gt;</span> <span class="n">sql</span>

<span class="n">类名</span>                        <span class="n">表名</span>
<span class="n">属性变量</span>                    <span class="n">字段</span>
<span class="n">属性值</span>                      <span class="n">约束条件</span>

<span class="n">对象</span>                        <span class="n">一条记录</span>
</pre></div>
</div>
<p>比如save()，就可以增加一条记录。所以是对象对应一条记录。</p>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id27">写项目的注意点</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p><em>写任何一个项目，</em> <em>第一件事情，就是产品经理给你提需求。</em>
<em>最关键的时候，了解产品需求，逻辑关系。判断中途是否有bug！</em></p>
<p><em>如果做不了，一定要直接说，不能藏着。否则后期拖进度，就麻烦了。</em>
<em>一开始做宏观的梳理，否则后面会出现bug。导致项目推到重构！！！</em></p>
<p><em>对于表的设计，要慎重考虑。</em>
<em>早期，会经历很多碰壁的过程，这样你就能成长！</em></p>
<p><em>先创建表，分模块来创建表。</em> <em>到了写代码的时候，反而是最简单的。</em>
<em>比如一个商城项目，设计表，梳理流程，花了2个月。写代码，几个星期就完成了</em></p>
</section>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id28">2. 单表操作</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<section id="id6">
<h3><a class="toc-backref" href="#id29">2.1 创建库</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p><strong>ORM没法创建数据库，它只能操作表！手动创建数据库！！！</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">xiao</span><span class="o">&gt;</span><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">CREATE</span> <span class="n">DATABASE</span> <span class="n">book</span> <span class="n">DEFAULT</span> <span class="n">CHARACTER</span> <span class="n">SET</span> <span class="n">utf8</span> <span class="n">COLLATE</span> <span class="n">utf8_general_ci</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.01</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id30">2.2 创建表</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<section id="id8">
<h4>创建模型<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>示例</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
     <span class="nb">id</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
     <span class="n">title</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
     <span class="n">state</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">()</span>
     <span class="n">pub_date</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>
     <span class="n">price</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
     <span class="n">publish</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
<p>类名，首先字母要大写，<strong>它必须继承models.Model。这是固定写法！</strong></p>
<p><strong>表名为 app名称_模型类名称</strong></p>
<p>例如：</p>
<p>表名: app01_book</p>
</section>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id31">2.3 更多字段和参数</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<section id="id10">
<h4>最常用的字段<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;1&gt; CharField
        字符串字段, 用于较短的字符串.
        CharField 要求必须有一个参数 maxlength, 用于从数据库层和Django校验层限制该字段所允许的最大字符数.

&lt;2&gt; IntegerField
       #用于保存一个整数.

&lt;3&gt; FloatField
        一个浮点数. 必须 提供两个参数:

        参数    描述
        max_digits    总位数(不包括小数点和符号)
        decimal_places    小数位数
                举例来说, 要保存最大值为 999 (小数点后保存2位),你要这样定义字段:

                models.FloatField(..., max_digits=5, decimal_places=2)
                要保存最大值一百万(小数点后保存10位)的话,你要这样定义:

                models.FloatField(..., max_digits=19, decimal_places=10)
                admin 用一个文本框(&lt;input type=&quot;text&quot;&gt;)表示该字段保存的数据.

&lt;4&gt; AutoField
        一个 IntegerField, 添加记录时它会自动增长. 你通常不需要直接使用这个字段;
        自定义一个主键：my_id=models.AutoField(primary_key=True)
        如果你不指定主键的话,系统会自动添加一个主键字段到你的 model.

&lt;5&gt; BooleanField
        A true/false field. admin 用 checkbox 来表示此类字段.

&lt;6&gt; TextField
        一个容量很大的文本字段.
        admin 用一个 &lt;textarea&gt; (文本区域)表示该字段数据.(一个多行编辑框).

&lt;7&gt; EmailField
        一个带有检查Email合法性的 CharField,不接受 maxlength 参数.

&lt;8&gt; DateField
        一个日期字段. 共有下列额外的可选参数:
        Argument    描述
        auto_now    当对象被保存时,自动将该字段的值设置为当前时间.通常用于表示 &quot;last-modified&quot; 时间戳.
        auto_now_add    当对象首次被创建时,自动将该字段的值设置为当前时间.通常用于表示对象创建时间.
        （仅仅在admin中有意义...)

&lt;9&gt; DateTimeField
         一个日期时间字段. 类似 DateField 支持同样的附加选项.

&lt;10&gt; ImageField
        类似 FileField, 不过要校验上传对象是否是一个合法图片.#它有两个可选参数:height_field和width_field,
        如果提供这两个参数,则图片将按提供的高度和宽度规格保存.
&lt;11&gt; FileField
     一个文件上传字段.
     要求一个必须有的参数: upload_to, 一个用于保存上载文件的本地文件系统路径. 这个路径必须包含 strftime #formatting,
     该格式将被上载文件的 date/time
     替换(so that uploaded files don&#39;t fill up the given directory).
     admin 用一个&lt;input type=&quot;file&quot;&gt;部件表示该字段保存的数据(一个文件上传部件) .

     注意：在一个 model 中使用 FileField 或 ImageField 需要以下步骤:
            （1）在你的 settings 文件中, 定义一个完整路径给 MEDIA_ROOT 以便让 Django在此处保存上传文件.
            (出于性能考虑,这些文件并不保存到数据库.) 定义MEDIA_URL 作为该目录的公共 URL. 要确保该目录对
             WEB服务器用户帐号是可写的.
            （2） 在你的 model 中添加 FileField 或 ImageField, 并确保定义了 upload_to 选项,以告诉 Django
             使用 MEDIA_ROOT 的哪个子目录保存上传文件.你的数据库中要保存的只是文件的路径(相对于 MEDIA_ROOT).
             出于习惯你一定很想使用 Django 提供的 get_&lt;#fieldname&gt;_url 函数.举例来说,如果你的 ImageField
             叫作 mug_shot, 你就可以在模板中以 {{ object.#get_mug_shot_url }} 这样的方式得到图像的绝对路径.

&lt;12&gt; URLField
      用于保存 URL. 若 verify_exists 参数为 True (默认), 给定的 URL 会预先检查是否存在( 即URL是否被有效装入且
      没有返回404响应).
      admin 用一个 &lt;input type=&quot;text&quot;&gt; 文本框表示该字段保存的数据(一个单行编辑框)

&lt;13&gt; NullBooleanField
       类似 BooleanField, 不过允许 NULL 作为其中一个选项. 推荐使用这个字段而不要用 BooleanField 加 null=True 选项
       admin 用一个选择框 &lt;select&gt; (三个可选择的值: &quot;Unknown&quot;, &quot;Yes&quot; 和 &quot;No&quot; ) 来表示这种字段数据.

&lt;14&gt; SlugField
       &quot;Slug&quot; 是一个报纸术语. slug 是某个东西的小小标记(短签), 只包含字母,数字,下划线和连字符.#它们通常用于URLs
       若你使用 Django 开发版本,你可以指定 maxlength. 若 maxlength 未指定, Django 会使用默认长度: 50.  #在
       以前的 Django 版本,没有任何办法改变50 这个长度.
       这暗示了 db_index=True.
       它接受一个额外的参数: prepopulate_from, which is a list of fields from which to auto-#populate
       the slug, via JavaScript,in the object&#39;s admin form: models.SlugField
       (prepopulate_from=(&quot;pre_name&quot;, &quot;name&quot;))prepopulate_from 不接受 DateTimeFields.

&lt;13&gt; XMLField
        一个校验值是否为合法XML的 TextField,必须提供参数: schema_path, 它是一个用来校验文本的 RelaxNG schema #的文件系统路径.

&lt;14&gt; FilePathField
        可选项目为某个特定目录下的文件名. 支持三个特殊的参数, 其中第一个是必须提供的.
        参数    描述
        path    必需参数. 一个目录的绝对文件系统路径. FilePathField 据此得到可选项目.
        Example: &quot;/home/images&quot;.
        match    可选参数. 一个正则表达式, 作为一个字符串, FilePathField 将使用它过滤文件名.
        注意这个正则表达式只会应用到 base filename 而不是
        路径全名. Example: &quot;foo.*\.txt^&quot;, 将匹配文件 foo23.txt 却不匹配 bar.txt 或 foo23.gif.
        recursive可选参数.要么 True 要么 False. 默认值是 False. 是否包括 path 下面的全部子目录.
        这三个参数可以同时使用.
        match 仅应用于 base filename, 而不是路径全名. 那么,这个例子:
        FilePathField(path=&quot;/home/images&quot;, match=&quot;foo.*&quot;, recursive=True)
        ...会匹配 /home/images/foo.gif 而不匹配 /home/images/foo/bar.gif

&lt;15&gt; IPAddressField
        一个字符串形式的 IP 地址, (i.e. &quot;24.124.1.30&quot;).
&lt;16&gt; CommaSeparatedIntegerField
        用于存放逗号分隔的整数值. 类似 CharField, 必须要有maxlength参数.
</pre></div>
</div>
</section>
<section id="id11">
<h4>常见的参数<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(1)null

如果为True，Django 将用NULL 来在数据库中存储空值。 默认值是 False.

(1)blank

如果为True，该字段允许不填。默认为False。
要注意，这与 null 不同。null纯粹是数据库范畴的，而 blank 是数据验证范畴的。
如果一个字段的blank=True，表单的验证将允许该字段是空值。如果字段的blank=False，该字段就是必填的。

(2)default

字段的默认值。可以是一个值或者可调用对象。如果可调用 ，每有新对象被创建它都会被调用。

(3)primary_key

如果为True，那么这个字段就是模型的主键。如果你没有指定任何一个字段的primary_key=True，
Django 就会自动添加一个IntegerField字段做为主键，所以除非你想覆盖默认的主键行为，
否则没必要设置任何一个字段的primary_key=True。

(4)unique

如果该值设置为 True, 这个数据字段的值在整张表中必须是唯一的

(5)choices
由二元组组成的一个可迭代对象（例如，列表或元组），用来给字段提供选择项。 如果设置了choices ，默认的表单将是一个选择框而不是标准的文本框，&lt;br&gt;而且这个选择框的选项就是choices 中的选项。
</pre></div>
</div>
<blockquote>
<div><p>参考django官方文档</p>
<p>模型字段参考</p>
<p><a class="reference external" href="https://c.isme.pub/2018/08/29/python-django-model/">https://c.isme.pub/2018/08/29/python-django-model/</a></p>
<p><a class="reference external" href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/fields/#module-django.db.models.fields">https://docs.djangoproject.com/zh-hans/3.2/ref/models/fields/#module-django.db.models.fields</a></p>
</div></blockquote>
</section>
</section>
<section id="settings">
<h3><a class="toc-backref" href="#id32">2.4 settings配置</a><a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h3>
<p>settings.py文件里面的INSTALLED_APPS。注册你的app</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;app01&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>不注册它，你的数据库就不知道该给哪个app创建表。</p>
<p>若想将模型转为mysql数据库中的表，需要在settings中配置：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>   <span class="c1"># 数据库引擎mysql</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;book&#39;</span><span class="p">,</span>       <span class="c1"># 你要存储数据的库名，事先要创建之</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>      <span class="c1"># 数据库用户名</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>      <span class="c1"># 密码</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="c1"># 主机</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>      <span class="c1"># 数据库使用的端口</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>注意1：NAME即数据库的名字，在mysql连接前该数据库必须已经创建，而上面的sqlite数据库下的db.sqlite3则是项目自动创建
USER和PASSWORD分别是数据库的用户名和密码。</p>
<p><strong>由于ORM不能创建数据库，需要手动创建。</strong></p>
<p>如步骤2.1上所示</p>
<p><strong>django连接MySQL，使用的是pymysql模块，必须得安装2个模块。否则后面会创建表不成功！或者提示no
module named MySQLdb</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">PyMYSQL</span>
</pre></div>
</div>
<p>在project/project/__init__.py文件中加入代码：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymysql</span>

<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</pre></div>
</div>
<p><strong>注意：某些windows电脑安装 mysqlclient会提示C++缺失。使用如下办法：</strong></p>
<blockquote>
<div><p>django连接MySQL，使用的是pymysql模块，必须得安装2个模块。否则后面会创建表不成功！或者提示no
module named MySQLdb</p>
<p>pip install pymysql pip install mysqlclient</p>
</div></blockquote>
<p>接下来要在pycharm的teminal中通过命令创建数据库的表了。有2条命令，分别是：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
</pre></div>
</div>
<p>注意2: 如果想打印orm转换过程中的sql，需要在settings中进行如下配置：</p>
<p>最后一行添加即可！</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;console&#39;</span><span class="p">:{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="s1">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django.db.backends&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>如果想删除数据库重新创建表，可以执行如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">drop</span> <span class="n">database</span> <span class="n">book</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">11</span> <span class="n">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">1.95</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="n">CREATE</span> <span class="n">DATABASE</span> <span class="n">book</span> <span class="n">DEFAULT</span> <span class="n">CHARACTER</span> <span class="n">SET</span> <span class="n">utf8</span> <span class="n">COLLATE</span> <span class="n">utf8_general_ci</span><span class="p">;</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">1</span> <span class="n">row</span> <span class="n">affected</span> <span class="p">(</span><span class="mf">0.00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
</div>
<p>重新执行上面2个命令</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
</pre></div>
</div>
<blockquote>
<div><p>参考文献：</p>
<p><a class="reference external" href="https://www.cnblogs.com/nulige/p/6590990.html">https://www.cnblogs.com/nulige/p/6590990.html</a></p>
<p><a class="reference external" href="https://www.cnblogs.com/xiao987334176/p/9229163.html#autoid-4-2-3">https://www.cnblogs.com/xiao987334176/p/9229163.html#autoid-4-2-3</a></p>
</div></blockquote>
<p>以MyDjangl项目为例，配置信息如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;mydjango&#39;</span><span class="p">,</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;admin#123&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="id12">
<h2><a class="toc-backref" href="#id33">3.构建模型</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h2>
<p>在项目index的models.py文件中定义模型如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="c1"># 创建产品分类表</span>
<span class="k">class</span> <span class="nc">Type</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Product</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">auto_created</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<p>　　上述代码分别定义了模型Type和Product，说明如下：</p>
<p>　　　　1、模型以类的形式进行定义，并且继承Django的models.Model类。一个类代表模板数据库的一张数据表，类的命名一般以首字母大写开头。</p>
<p>　　　　2、模型的字段以类属性进行定义，如id=models.IntegerField(primary_key=True)代表在数据表Type中命名一个名为id的字段，该字段的数据类型为整型并设置为主键。</p>
<p>　　完成模型的定义后，接着在目标数据库中创建相应的数据表，在模板数据库中创建表是通过Django的管理工具manage.py完成的，创建指令如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#根据models.py内容生成相关的py文件，该文件用于创建数据表</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span>
<span class="n">或者</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span> <span class="n">index</span>

<span class="c1">#创建数据表</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
<span class="c1">#or</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span> <span class="n">index</span>
</pre></div>
</div>
</section>
<section id="id13">
<h2><a class="toc-backref" href="#id34">4. 数据表的关系</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<p>一个模型对应目标数据库的一个数据表，但我们知道，每个数据表之间是可以存在关联的，表与表之间有三种关系：一对一/一对多和多对多。</p>
<section id="id14">
<h3><a class="toc-backref" href="#id35">4.1 一对一关系</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>　　一对一存在于在两个数据表中，第一个表的某一行数据只与第二个表的某一行数据相关，同时第二个表的某一行数据也只与第一个表的某一行数据相关，这种表关系被称为一对一关系。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#一对一关系</span>
<span class="k">class</span> <span class="nc">Performer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">nationality</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">masterpiece</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Performer_info</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">performer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">Performer</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">birth</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">elapse</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id15">
<h3><a class="toc-backref" href="#id36">4.2 一对多关系</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>一对多存在于两个或两个以上的数据表中，第一个表的数据可以与第二个表的一道多行数据进行关联，但是第二个表的每一行数据只能与第一个表的某一行进行管理。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#一对多关系</span>
<span class="k">class</span> <span class="nc">Performer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">nationality</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">masterpiece</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Program</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">performer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Performer</span><span class="p">,</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id16">
<h3><a class="toc-backref" href="#id37">4.3 多对多关系</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>　多对多存在于两个或两个以上的数据表中，第一个表的某一行数据可以与第二个表的一到多行数据进行关联，同时在第二个表中的某一行数据也可以与第一个表的一到多行数据进行关联。</p>
<p>多对多关系会在两张表的基础之上，新增一个映射表。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#多对多</span>
<span class="k">class</span> <span class="nc">Performer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">nationality</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">masterpiece</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Manytomany</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">performer</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Performer</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id17">
<h3><a class="toc-backref" href="#id38">4.4 如何确定表关系？</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>参考文献</p>
<p><a class="reference external" href="https://www.cnblogs.com/xiao987334176/p/9239786.html#autoid-3-0-0">https://www.cnblogs.com/xiao987334176/p/9239786.html#autoid-3-0-0</a></p>
</div></blockquote>
</section>
</section>
<section id="id18">
<h2><a class="toc-backref" href="#id39">5.数据表的读写</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h2>
<p>在MyDjango项目中使用shell模式(启动命令行和执行脚本)进行讲述，该模式主要为方便开发人员开发和调式程序。在PyCharm的Terminal下开启shell模式，输入python
manage.py shell指令即可开启。</p>
<ul class="simple">
<li><p>插入数据</p></li>
</ul>
<p>方法1</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">djangoProject</span><span class="p">)</span> <span class="n">D</span><span class="p">:</span>\<span class="n">djangoProject</span><span class="o">&gt;</span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">shell</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">index.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span><span class="s2">&quot;荣耀v2&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">weight</span><span class="o">=</span><span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="s2">&quot;手机&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>方法2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">djangoProject</span><span class="p">)</span> <span class="n">D</span><span class="p">:</span>\<span class="n">djangoProject</span><span class="o">&gt;</span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">shell</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">index.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;荣耀v2&quot;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;手机&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>update更新数据</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Huawei v1&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>　除此之外，还可以使用update方法实现单条和多条数据的更新，使用方法如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#通过Django的ORM框架提供的API实现</span>
<span class="c1">#更新单条数据，查询条件filter使用于查询单条数据</span>
<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;华为荣耀V10&#39;</span><span class="p">)</span>
<span class="c1">#更新多条数据，查询条件filter以列表格式返回，查询结果可能是一条或多条数据</span>
<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;荣耀V9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">)</span>
<span class="c1">#全表数据更新，不使用查询条件，默认对全表的数据进行更新</span>
<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果要对数据进行删除处理，有三种方式：删除表中全部数据、删除一条数据和删除多条数据。实现三种删除方式的代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#删除一条id为1的数据</span>
<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="c1">#删除多条数据</span>
<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;119g&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

<span class="c1">#删除表中全部数据</span>
<span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>　数据删除有ORM框架的delete方法实现。从数据的删除和更新可以看到这两种数据操作都使用查询条件get和filter，查询条件get和filter的区别如下：</p>
<p>　　　　1、查询条件get：查询字段必须是主键或者唯一约束的字段，并且查询的数据必须存在，如果查询的字段有重复值或者查询的数据不存在，程序都会抛出异常信息。</p>
<p>　　　　2、查询条件filter：查询字段没有限制，只要该字段是数据表的某一字段即可。查询结果以列表的形式返回，如果查询结果为空（查询的数据在数据库中找不到），就返回空列表。</p>
<p>数据查询是数据库操作中最为复杂并且内容最多的部分，我们以代码的形式来讲述如何通过ORM框架提供的API实现数据查询，代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">index.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1">#全表查询，等同于SQL语句Select * from index_product,数据以类不形式返回</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="s1">&#39;华为荣耀V9&#39;</span>

<span class="c1">#查询前5条数据，等同于SQL语句Select * from index_product LIMIT 5</span>
<span class="c1">#SQL语句里面的LIMIT方法，在Django中使用Python的列表截取分解即可实现</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">p</span>


<span class="c1">#查询某个字段，等同于SQL语句Select  name from index_product</span>
<span class="c1">#values方法，以列表形式返回数据，列表元素以字典格式表示</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="s1">&#39;华为荣耀V9&#39;</span>

<span class="c1">#values_list方法，以列表表示返回数据，列表元素以元组格式表示</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">47</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values_list</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">48</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[(</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">,),</span> <span class="p">(</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">,)]</span><span class="o">&gt;</span>

<span class="c1">#使用get方法查询数据，等于同SQL语句Select * from index_product where id=2</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">49</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">50</span><span class="p">]:</span> <span class="s1">&#39;华为荣耀V9&#39;</span>

<span class="c1">#使用filter方法查询数据，注意区分get和filter的差异</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">51</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">52</span><span class="p">]:</span> <span class="s1">&#39;华为荣耀V9&#39;</span>


<span class="c1">#SQL的 and查询主要在filter里面添加多个查询条件</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">53</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">54</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>


<span class="c1">#SQL的or查询，需要引入Q，编写格式Q(field=value)|Q(field=value)</span>
<span class="c1">#等同于SQL语句Select * from index_product where name=&#39;华为荣耀V9‘ or id=9</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">55</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Q</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">57</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;华为荣耀V&#39;</span><span class="p">)</span><span class="o">|</span><span class="n">Q</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">9</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">58</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>

<span class="c1">#使用count方法统计查询数据的数据量</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">63</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">64</span><span class="p">]:</span> <span class="mi">8</span>

<span class="c1">#去重查询，distinct方法无需设置参数，去重方式根据values设置的字段执行</span>
<span class="c1">#等同SQL语句Select DISTINCT name from index_product where name=&#39;华为荣耀V9’</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">65</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">distinct</span><span class="p">()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">66</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;华为荣耀V9&#39;</span><span class="p">}]</span><span class="o">&gt;</span>


<span class="c1">#根据字段id降序排列，降序只要在order_by里面的字段前面加&quot;-即可&quot;</span>
<span class="c1">#order_by可设置多字段排序，如Product.objects.order_by(&#39;-id&#39;, &#39;name&#39;)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">67</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">68</span><span class="p">]:</span> <span class="o">&lt;</span><span class="n">QuerySet</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">Product</span><span class="p">:</span> <span class="n">Product</span> <span class="nb">object</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="p">]</span><span class="o">&gt;</span>

<span class="c1">#聚合查询，实现对数据值求和、求平均值等。Django提供annotate和aggregate方法实现</span>
<span class="c1">#annotate类似于SQL里面的GROUP BY方法，如果不设置values，就会默认对主键进行GROUP BY分组</span>
<span class="c1">#等同于SQL语句Select name,SUM(id) AS &#39;id_sum&#39; from index_product GROUP BY NAME ORDER BY NULL</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">69</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Sum</span><span class="p">,</span> <span class="n">Count</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">70</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Sum</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">71</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="s2">&quot;index_product&quot;</span><span class="o">.</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">SUM</span><span class="p">(</span><span class="s2">&quot;index_product&quot;</span><span class="o">.</span><span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="n">AS</span> <span class="s2">&quot;id__sum&quot;</span> <span class="n">FROM</span> <span class="s2">&quot;index_product&quot;</span> <span class="n">GROUP</span> <span class="n">BY</span> <span class="s2">&quot;index_product&quot;</span><span class="o">.</span><span class="s2">&quot;name&quot;</span>

<span class="c1">#aggregate是将某个字段的值进行计算并置返回技术结果</span>
<span class="c1">#等同于SQL语句Select COUNT(id) AS &#39;id_count&#39; from index_product</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">72</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">django.db.models</span> <span class="kn">import</span> <span class="n">Count</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">73</span><span class="p">]:</span> <span class="n">p</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">id_count</span><span class="o">=</span><span class="n">Count</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="n">p</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">74</span><span class="p">]:</span> <span class="p">{</span><span class="s1">&#39;id_count&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
</pre></div>
</div>
<section id="id19">
<h3><a class="toc-backref" href="#id40">5.1 多表查询</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>　　一对多或一对一的表关系是通过外键实现关联的，而多表查询分为正向查询和反向查询。以模型Product和Type为例：</p>
<p>　　　　1、如果查询对象的主体是模型Type，要查询模型Type的数据，那么该查询成为正向查询。</p>
<p>　　　　2、如果查询对象的主体是模型Type，要通过模型Type查询模型Product的数据，那么该查询称为反向查询。</p>
<p>　　无论是正向查询还是反向查询，两者的实现方法大致相同，代码如下：</p>
</section>
<section id="id20">
<h3><a class="toc-backref" href="#id41">5.2 ORM操作</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>参考文献：</p>
<p><a class="reference external" href="https://www.cnblogs.com/nulige/p/6590990.html">https://www.cnblogs.com/nulige/p/6590990.html</a></p>
</div></blockquote>
</section>
</section>
<section id="id21">
<h2><a class="toc-backref" href="#id42">6. 文献参考</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><p>参考文献</p>
<p><a class="reference external" href="https://www.cnblogs.com/zhaop8078/p/11553275.html">https://www.cnblogs.com/zhaop8078/p/11553275.html</a></p>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="05.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A7%86%E5%9B%BE%E5%92%8C%E8%B7%AF%E7%94%B1.html" class="btn btn-neutral float-left" title="23.4.5. 玩转Django2.0-视图和路由" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="06.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E6%9D%BF.html" class="btn btn-neutral float-right" title="23.4.7. 玩转Django2.0-模板" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>