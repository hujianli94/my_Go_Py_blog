<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>23.4.24. django-rest-framework学习 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="23.5. Tornado" href="../05.Tornado/index.html" />
    <link rel="prev" title="23.4.23. 附录1.Django项目的部署" href="30.%E9%99%84%E5%BD%951.Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> 小健_Python_go_Devops
            <img src="../../../_static/python_go.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Go/index.html">Go语言学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Go_vs_Python/index.html">Go vs Python</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Python全栈系列</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../01.Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/index.html">1. Python数据类型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02.Python%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/index.html">2. Python流程控制语句</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03.Python%E5%87%BD%E6%95%B0/index.html">3. Python函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../04.Python%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0/index.html">4. Python内建函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../05.Python%E6%8E%A8%E5%AF%BC%E5%BC%8F%E5%AD%A6%E4%B9%A0/index.html">5. Python推导式学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../06.Python%E8%BF%AD%E4%BB%A3%E5%99%A8_%E7%94%9F%E6%88%90%E5%99%A8_%E8%A3%85%E9%A5%B0%E5%99%A8/index.html">6. Python生成器、迭代器、装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../07.Python%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1_OOP/index.html">7. Python面对对象设计_OOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../08.Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/index.html">8. Python异常处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../09.Python%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/index.html">9. Python文件操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../10.Python%E4%B8%AD%E7%9A%84%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/index.html">10. Python中包和模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../11.Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/index.html">11. Python正则表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../12.Python%E6%A0%87%E5%87%86%E5%BA%93/index.html">12. Python 标准库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../13.Python%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">13. Python对数据库的操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../14.Python%E4%B8%89%E6%96%B9%E5%BA%93/index.html">14. Python 三方库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../15.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/index.html">15. Python 网络编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../16.Python%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/index.html">16. Python 进程和线程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../17.Python%E8%AF%AD%E8%A8%80%E7%9A%84%E6%89%A9%E5%B1%95%E4%B8%8E%E5%B5%8C%E5%85%A5/index.html">17. Python与C语言扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../18.%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%9A%84Python%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.html">18. 系统管理员的Python脚本编程指南-读书笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../20.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/index.html">19. Python自动化运维最佳实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../21.Python%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/index.html">20. Python进阶学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../22.Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/index.html">21. Python网络爬虫</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../23.%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/index.html">22. 前端基础知识</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">23. Python框架</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../01.%E5%B8%B8%E7%94%A8%E7%9A%84GUI%E6%A1%86%E6%9E%B6/index.html">23.1. 常用的GUI框架</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02.Flask/index.html">23.2. Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03.Scrapy/index.html">23.3. Scrapy</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">23.4. Django</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="01.%E5%AE%89%E8%A3%85DjangoWeb%E6%A1%86%E6%9E%B6.html">23.4.1. 安装DjangoWeb框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="02.Django%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8.html">23.4.2. Django框架的使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="03.Django%E6%B5%81%E7%A8%8B%E8%B7%91%E9%80%9A.html">23.4.3. Django流程跑通</a></li>
<li class="toctree-l4"><a class="reference internal" href="04.%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83-%E5%BC%80%E5%8F%91Django%E7%AB%99%E7%82%B9.html">23.4.4. 实战演练-开发Django站点</a></li>
<li class="toctree-l4"><a class="reference internal" href="05.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A7%86%E5%9B%BE%E5%92%8C%E8%B7%AF%E7%94%B1.html">23.4.5. 玩转Django2.0-视图和路由</a></li>
<li class="toctree-l4"><a class="reference internal" href="06.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93.html">23.4.6. 玩转Django2.0-模型与数据库</a></li>
<li class="toctree-l4"><a class="reference internal" href="06.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E6%9D%BF.html">23.4.7. 玩转Django2.0-模板</a></li>
<li class="toctree-l4"><a class="reference internal" href="07.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A1%A8%E5%8D%95%E4%B8%8E%E6%A8%A1%E5%9E%8B.html">23.4.8. 玩转Django2.0-表单与模型</a></li>
<li class="toctree-l4"><a class="reference internal" href="08.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93.html">23.4.9. 玩转Django2.0-模型与数据库</a></li>
<li class="toctree-l4"><a class="reference internal" href="09.%E7%8E%A9%E8%BD%ACDjango2.0-admin%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F.html">23.4.10. 玩转Django2.0-admin后台系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="10.%E7%8E%A9%E8%BD%ACDjango2.0-Auth%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F.html">23.4.11. 玩转Django2.0-Auth认证系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="11.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%B8%B8%E7%94%A8%E7%9A%84Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F.html">23.4.12. 玩转Django2.0-常用的Web应用程序</a></li>
<li class="toctree-l4"><a class="reference internal" href="12.%E7%8E%A9%E8%BD%ACDjango2.0-%E9%9F%B3%E4%B9%90%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91.html">23.4.13. 玩转Django2.0-音乐网站开发</a></li>
<li class="toctree-l4"><a class="reference internal" href="13.%E7%8E%A9%E8%BD%ACDjango2.0-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8.html">23.4.14. 玩转Django2.0-第三方功能应用</a></li>
<li class="toctree-l4"><a class="reference internal" href="14.%E7%8E%A9%E8%BD%ACDjango2.0-Django%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2.html">23.4.15. 玩转Django2.0-Django项目上线部署</a></li>
<li class="toctree-l4"><a class="reference internal" href="15.%E7%8E%A9%E8%BD%ACDjango2.0-Django-Rest-Framework%E6%A1%86%E6%9E%B6.html">23.4.16. 玩转Django2.0-Django-Rest-Framework框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="16.%E7%8E%A9%E8%BD%ACDjango2.0-django%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E4%B8%80.html">23.4.17. 玩转Django2.0-django图书管理系统一</a></li>
<li class="toctree-l4"><a class="reference internal" href="17.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB-django%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91%E4%B8%80.html">23.4.18. 玩转Django2.0-前后端分离-django主机管理开发一</a></li>
<li class="toctree-l4"><a class="reference internal" href="18.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB-django%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91%E4%BA%8C.html">23.4.19. 前后端分离-django主机管理开发二</a></li>
<li class="toctree-l4"><a class="reference internal" href="20.drf-%E8%AE%A4%E8%AF%81.html">23.4.20. drf-认证</a></li>
<li class="toctree-l4"><a class="reference internal" href="21.drf-%E8%A7%86%E5%9B%BE.html">23.4.21. drf视图</a></li>
<li class="toctree-l4"><a class="reference internal" href="29.%E9%99%84%E5%BD%951.Django%E5%85%A5%E9%97%A8-%E5%AE%9E%E6%88%98%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0.html">23.4.22. 附录1.Django入门+实战教程+笔记</a></li>
<li class="toctree-l4"><a class="reference internal" href="30.%E9%99%84%E5%BD%951.Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2.html">23.4.23. 附录1.Django项目的部署</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">23.4.24. django-rest-framework学习</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../05.Tornado/index.html">23.5. Tornado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06.Python%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-Django-Flask/index.html">23.6. Python高效开发实战-Django、Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07.Python-Django-Web%E5%85%B8%E5%9E%8B%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/index.html">23.7. Python-Django-Web典型模块开发实战</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../25.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/index.html">24. Python开发环境部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../26.%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6/index.html">25. 我的第一本算法书</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../27.Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/index.html">26. Python3网络爬虫开发实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../28.Python%E8%AE%A9%E7%B9%81%E7%90%90%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96/index.html">27. Python让繁琐的工作自动化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../29.%E7%96%AF%E7%8B%82%E7%9A%84Python%E8%AE%B2%E4%B9%89/index.html">28. 疯狂的Python讲义</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../30.Django_Vue/index.html">29. Django_Vue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../31.%E7%BC%96%E5%86%99Python%E7%9A%8490%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95/index.html">30. 编写Python的90个有效方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../32.Vue3.0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/index.html">31. Vue3.0管理系统</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5/index.html">Python测试开发入门与实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vue/index.html">Vue.js企业开发实战</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vue_Node.js/index.html">Vue.js+Node.js开发实战</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">小健_Python_go_Devops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Python全栈系列</a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">23. </span>Python框架</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">23.4. </span>Django</a> &raquo;</li>
      <li><span class="section-number">23.4.24. </span>django-rest-framework学习</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/Python/24.Python框架/04.Django/30.附录2.Django-REST-framework学习.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#django-rest-framework" id="id54">django-rest-framework学习</a></p>
<ul>
<li><p><a class="reference internal" href="#djangorestframework" id="id55">1. 引入DjangoRESTframework</a></p>
<ul>
<li><p><a class="reference internal" href="#web" id="id56">1.1 Web应用模式</a></p></li>
<li><p><a class="reference internal" href="#restful" id="id57">1.2 认识RESTful</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id58">1.3 RESTful设计方法</a></p></li>
<li><p><a class="reference internal" href="#djangorest" id="id59">1.4 使用Django开发REST 接口</a></p></li>
<li><p><a class="reference internal" href="#rest" id="id60">1.5 明确REST接口开发的核心任务</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id61">1.6 Django REST framework 简介</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#drf" id="id62">2. DRF工程搭建</a></p>
<ul>
<li><p><a class="reference internal" href="#id10" id="id63">2.1 环境安装与配置</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id64">2.2 见识DRF的魅力</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#serializer" id="id65">3. Serializer序列化器</a></p>
<ul>
<li><p><a class="reference internal" href="#id16" id="id66">3.1 定义Serializer</a></p></li>
<li><p><a class="reference internal" href="#id18" id="id67">3.2 字段与选项</a></p></li>
<li><p><a class="reference internal" href="#id19" id="id68">3.3 创建Serializer对象</a></p></li>
<li><p><a class="reference internal" href="#id20" id="id69">3.4 序列化使用</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id27" id="id70">4. 视图</a></p>
<ul>
<li><p><a class="reference internal" href="#request-response" id="id71">4.1 Request 与 Response</a></p></li>
<li><p><a class="reference internal" href="#id33" id="id72">4.2 视图概览</a></p></li>
<li><p><a class="reference internal" href="#id34" id="id73">4.2.1 2个视图基类</a></p></li>
<li><p><a class="reference internal" href="#id35" id="id74">4.2.2 5个视图扩展类</a></p></li>
<li><p><a class="reference internal" href="#id36" id="id75">4.2.3 9个视图子类</a></p></li>
<li><p><a class="reference internal" href="#id37" id="id76">4.2.4 视图类的使用</a></p></li>
<li><p><a class="reference internal" href="#viewset" id="id77">4.2.5 视图集ViewSet</a></p></li>
<li><p><a class="reference internal" href="#id47" id="id78">4.3 视图集和路由器</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id48" id="id79">5.总结</a></p>
<ul>
<li><p><a class="reference internal" href="#id50" id="id80">两个基类</a></p></li>
<li><p><a class="reference internal" href="#rest-framework-mixins" id="id81">5个视图扩展类(rest_framework.mixins)</a></p></li>
<li><p><a class="reference internal" href="#rest-framework-generics" id="id82">9个子类视图(rest_framework.generics)</a></p></li>
<li><p><a class="reference internal" href="#id51" id="id83">视图集</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id52" id="id84">6. 视图继承关系图</a></p></li>
<li><p><a class="reference internal" href="#id53" id="id85">7. 深度解析Django REST Framework 批量操作</a></p></li>
<li><p><a class="reference internal" href="#django-drf-vue-element" id="id86">8.Django（drf）配合 Vue Element 实现文件上传下载功能</a></p></li>
<li><p><a class="reference internal" href="#django" id="id87">9. django知识查询</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="django-rest-framework">
<h1><a class="toc-backref" href="#id54"><span class="section-number">23.4.24. </span>django-rest-framework学习</a><a class="headerlink" href="#django-rest-framework" title="Permalink to this headline">¶</a></h1>
<section id="djangorestframework">
<h2><a class="toc-backref" href="#id55">1. 引入DjangoRESTframework</a><a class="headerlink" href="#djangorestframework" title="Permalink to this headline">¶</a></h2>
<section id="web">
<h3><a class="toc-backref" href="#id56">1.1 Web应用模式</a><a class="headerlink" href="#web" title="Permalink to this headline">¶</a></h3>
<section id="id1">
<h4>前后端不分离<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<img alt="../../../_images/image-20220314142939520.png" src="../../../_images/image-20220314142939520.png" />
</section>
<section id="id2">
<h4>前后端分离<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<img alt="../../../_images/image-20220314143051095.png" src="../../../_images/image-20220314143051095.png" />
<p>在前后端分离的应用模式中，后端仅返回前端所需的数据，不在渲染HTML页面，不再控制前端的效果，至于前端用户看到什么效果，从后端的数据如何加载到前端，都由前端自己决定，</p>
<p>网页有网页的处理方式，APP有app的处理方式，但无论那种前端，所需的数据基本相同，后端仅需开发一套逻辑对外提供数据即可。</p>
<p>在前后端分离项目中，前端与后端的耦合度相对较低。</p>
<p>在前后端分离模式中，我们通常将后端开发的每个视图称为一个接口，或者API，前端通过访问接口对数据进行CURD（增删改查）</p>
</section>
</section>
<section id="restful">
<h3><a class="toc-backref" href="#id57">1.2 认识RESTful</a><a class="headerlink" href="#restful" title="Permalink to this headline">¶</a></h3>
<p><strong>在前后端分离的应用模式里，API接口如何定义？</strong></p>
<p>参考：</p>
<p><a class="reference external" href="https://www.cnblogs.com/welan/p/9875103.html">RESTful 规范</a></p>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id58">1.3 RESTful设计方法</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>(1）如果是对同一个表进行数据操作（增、删、改、查），应该使用一条API，然后根据method的不同，进行不同的操作。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GET</span><span class="o">/</span><span class="n">POST</span><span class="o">/</span><span class="n">PUT</span><span class="o">/</span><span class="n">DELETE</span><span class="o">/</span><span class="n">PATCH</span>
</pre></div>
</div>
<p>（2）面向资源编程，通过API提交的参数最好是名词，比如name，尽量少用动词。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">name</span>
</pre></div>
</div>
<p>（3）体现版本，在API中加入像v1、v2这样的版本代号：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">name</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="n">name</span>
</pre></div>
</div>
<p>（4）体现API，让使用者一眼能看出这是API而不是URL，应该在API中加入提示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">name</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="n">name</span>
</pre></div>
</div>
<p>（5）使用HTTPS，这一项原本是为了安全考虑，但是随着国内外互联网环境对安全性越来越重视，谷歌浏览器对所有不是HTTPS请求的链接全都会提示用户此链接为不安全链接，腾讯等平台也对小程序等产品强制要求使用HTTPS协议。不过，好在国内许多提供云服务的公司，像腾讯云、阿里云等，都提供免费的SSL证书，供开发者去申请。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">name</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v2</span><span class="o">/</span><span class="n">name</span>
</pre></div>
</div>
<p>（6）响应式设置状态码，例如，200和201代表操作成功，403代表权限不够，404代表没有指定资源，500代表运行时发现代码逻辑错误等。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;adgbag&#39;</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>（7）API的参数中加入筛选条件参数，也可以理解为获取资源优先选择GET的方式。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>https://www.abc.com/api/v2/name?page=1&amp;size=10
</pre></div>
</div>
<p>（8）返回值的规范，不同的method操作成功后，后端应该响应的返回值如下：</p>
<p>不同的提交方式代表对数据进行不同的操作：</p>
<ul class="simple">
<li><p>GET：所有列表。</p></li>
<li><p>POST：新增的数据。</p></li>
<li><p>GET：单条数据。</p></li>
<li><p>PUT：更新，返回更新的数据。</p></li>
<li><p>PATCH：局部更新，返回更新的数据。</p></li>
<li><p>DELETE：删除，返回空文档。</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">name</span><span class="o">/</span><span class="mi">1</span>
</pre></div>
</div>
<p>（9）返回错误信息，应该加入错误代号code，让用户能直接看出是哪种类型的错误。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ret {
    code:1000，
    data:{
        {&#39;id&#39;:1,&#39;title&#39;:&#39;lala&#39;}
    }
}
</pre></div>
</div>
<p>（10）返回的详细信息，应该以字典的形式放在data中。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ret {   code:1000，
        data:{
            {   &#39;id&#39;:1,
                &#39;title&#39;:&#39;lala&#39;,
                &#39;detail&#39;:http://www.……
            }
        }
 }
</pre></div>
</div>
<ol class="arabic simple" start="11">
<li><p>服务器返回的数据格式，应该尽量使用JSON，避免使用XML。</p></li>
</ol>
</section>
<section id="djangorest">
<h3><a class="toc-backref" href="#id59">1.4 使用Django开发REST 接口</a><a class="headerlink" href="#djangorest" title="Permalink to this headline">¶</a></h3>
<p>我们以在Django框架中使用的图书英雄案例来写一套支持图书数据增删改查的REST
API接口，来理解REST API的开发。</p>
<p>在此案例中，前后端均发送JSON格式数据。</p>
<p><code class="docutils literal notranslate"><span class="pre">models.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="c1"># Create your models here.</span>
<span class="c1"># 定义英雄模型类HeroInfo</span>


<span class="k">class</span> <span class="nc">BookInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">btitle</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;名称&#39;</span><span class="p">)</span>
    <span class="n">bpub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;发布日期&#39;</span><span class="p">)</span>
    <span class="n">bread</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;阅读量&#39;</span><span class="p">)</span>
    <span class="n">bcomment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;评论量&#39;</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;booktest&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;图片&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">view.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BookInfo</span>
<span class="kn">import</span> <span class="nn">json</span>


<span class="k">class</span> <span class="nc">BooksAPIVIew</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    查询所有图书、增加图书</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        查询所有图书</span>
<span class="sd">        路由：GET /books/</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">book_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
            <span class="n">book_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
                <span class="s1">&#39;bpub_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
                <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
                <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
                <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="p">})</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">book_list</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        新增图书</span>
<span class="sd">        路由：POST /books/</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">json_bytes</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">json_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">book_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>

        <span class="c1"># 此处详细的校验参数省略</span>

        <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">btitle</span><span class="o">=</span><span class="n">book_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;btitle&#39;</span><span class="p">),</span>
            <span class="n">bpub_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">book_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bpub_date&#39;</span><span class="p">),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
            <span class="s1">&#39;bpub_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
            <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
            <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">BookAPIView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        获取单个图书信息</span>
<span class="sd">        路由： GET  /books/&lt;pk&gt;/</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
            <span class="s1">&#39;bpub_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
            <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
            <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        修改图书信息</span>
<span class="sd">        路由： PUT  /books/&lt;pk&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

        <span class="n">json_bytes</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">json_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="n">book_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>

        <span class="c1"># 此处详细的校验参数省略</span>

        <span class="n">book</span><span class="o">.</span><span class="n">btitle</span> <span class="o">=</span> <span class="n">book_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;btitle&#39;</span><span class="p">)</span>
        <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">book_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bpub_date&#39;</span><span class="p">),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">({</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
            <span class="s1">&#39;bpub_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
            <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
            <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        删除图书</span>
<span class="sd">        路由： DELETE /books/&lt;pk&gt;/</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

        <span class="n">book</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">204</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">urls.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf8 -*-</span>
<span class="c1"># auther; 18793</span>
<span class="c1"># Date：2022/3/14 12:22</span>
<span class="c1"># filename: urls.py</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>


<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^books/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BooksAPIVIew</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
    <span class="n">re_path</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^books/(?P&lt;pk&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookAPIView</span><span class="o">.</span><span class="n">as_view</span><span class="p">())</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>测试</strong> 使用Postman测试上述接口</p>
<section id="id4">
<h4>1） 获取所有图书数据<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>GET 方式访问 <a class="reference external" href="http://127.0.0.1:8000/books/">http://127.0.0.1:8000/books/</a>， 返回状态码200，数据如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;雪山飞狐&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-03-14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;bcomment&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;/home&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;笑傲江湖&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-03-14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;bcomment&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;天龙八部&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-03-14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s2">&quot;bcomment&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;连城诀&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-03-14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;bcomment&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id5">
<h4>2）获取单一图书数据<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>GET 访问 <a class="reference external" href="http://127.0.0.1:8000/books/1/">http://127.0.0.1:8000/books/1/</a> ，返回状态码200， 数据如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;雪山飞狐&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-03-14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;bcomment&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;/home&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>GET 访问http://127.0.0.1:8000/books/100/，返回状态码404</p>
</section>
<section id="id6">
<h4>3）新增图书数据<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>POST 访问http://127.0.0.1:8000/books/，发送JSON数据：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;三国演义&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;1990-02-03&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>返回状态码201，数据如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;三国演义&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;1990-02-03&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;bcomment&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id7">
<h4>4）修改图书数据<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p>PUT 访问http://127.0.0.1:8000/books/5/，发送JSON数据：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;射雕英雄传&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;1990-02-03&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>返回状态码200，数据如下</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;btitle&quot;</span><span class="p">:</span> <span class="s2">&quot;射雕英雄传&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bpub_date&quot;</span><span class="p">:</span> <span class="s2">&quot;1990-02-03&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;bcomment&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="id8">
<h4>5）删除图书数据<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>DELETE 访问http://127.0.0.1:8000/books/5/，返回204状态码</p>
<p><strong>源码</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">view.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">JsonResponse</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">GET         /books/</span>
<span class="sd">POST        /books/</span>
<span class="sd">GET         /books/&lt;pk&gt;/</span>
<span class="sd">PUT         /books/&lt;pk&gt;/</span>
<span class="sd">DELETE      /books/&lt;pk&gt;/</span>

<span class="sd">响应数据  JSON</span>
<span class="sd"># 列表视图: 路由后边没有pk/ID</span>
<span class="sd"># 详情视图: 路由后面   pk/ID</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BookInfo</span>


<span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;查询所有图书接口&quot;&quot;&quot;</span>
        <span class="c1"># 1. 查询出所有图书模型</span>
        <span class="n">books</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="c1"># 2. 遍历查询集，去除里边的每个书籍模型对象，把模型对象转换成字典</span>
        <span class="c1"># 定义一个列表保存所有字典</span>
        <span class="n">book_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">books</span><span class="p">:</span>
            <span class="n">book_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
                <span class="s1">&#39;bput_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
                <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
                <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">book_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">book_dict</span><span class="p">)</span>  <span class="c1"># 将转换好的字典添加到列表中</span>
        <span class="c1"># 3. 响应给前端</span>
        <span class="c1"># 如果book_;list 不是一个字典的话就需要将safe设置成False.</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">book_list</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;新增图书接口&quot;&quot;&quot;</span>
        <span class="c1"># 获取前端传入的请求体数据(json) request.body</span>
        <span class="n">json_str_bytes</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
        <span class="c1"># 把bytes类型的json字符串转换成json_str</span>
        <span class="n">json_str</span> <span class="o">=</span> <span class="n">json_str_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="c1"># 利用json.loads将json字符串扎UN干哈UN从json（字典/列表）</span>
        <span class="n">book_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
        <span class="c1"># 创建模型对象并保存（把字典转换成模型并储存）</span>
        <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="p">(</span>
            <span class="n">btitle</span><span class="o">=</span><span class="n">book_dict</span><span class="p">[</span><span class="s1">&#39;btitle&#39;</span><span class="p">],</span>
            <span class="n">bpub_date</span><span class="o">=</span><span class="n">book_dict</span><span class="p">[</span><span class="s1">&#39;bpub_date&#39;</span><span class="p">],</span>

        <span class="p">)</span>
        <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="c1"># 把新增的模型转换成字典</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
            <span class="s1">&#39;bput_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
            <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
            <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span><span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># 响应（把新增的数据再响应回去，201）</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">json_dict</span><span class="p">,</span><span class="n">status</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">BookDetailView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;详情视图&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;查询指定某个图书馆接口&quot;&quot;&quot;</span>
        <span class="c1"># 1. 获取出指定pk的那个模型对象</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;查询的数据不存在&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
        <span class="c1"># 2. 模型对象转字典</span>
        <span class="n">book_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
            <span class="s1">&#39;bput_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
            <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
            <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span><span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># 3. 响应</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">book_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;修改指定图书馆接口&quot;&quot;&quot;</span>
        <span class="c1"># 先查询要修改的模型对象</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;查询的数据不存在&#39;</span><span class="p">},</span> <span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
        <span class="c1"># 获取前端传入的新数据（把数据转换成字典）</span>
        <span class="c1"># json_str_bytes = request.body</span>
        <span class="c1"># json_str = json_str_bytes.decode()</span>
        <span class="c1"># book_dict = json.loads(json_str)</span>

        <span class="n">book_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="c1"># 重新给模型指定的属性赋值</span>
        <span class="n">book</span><span class="o">.</span><span class="n">btitle</span> <span class="o">=</span> <span class="n">book_dict</span><span class="p">[</span><span class="s1">&#39;btitle&#39;</span><span class="p">]</span>
        <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span> <span class="o">=</span> <span class="n">book_dict</span><span class="p">[</span><span class="s1">&#39;bpub_date&#39;</span><span class="p">]</span>

        <span class="c1"># 调用save方法进行修改操作</span>
        <span class="n">book</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
        <span class="c1"># 把修改后的模型再转换成字典</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
            <span class="s1">&#39;bput_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
            <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
            <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
            <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># 响应</span>
        <span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">json_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">pk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;删除指定图书接口&quot;&quot;&quot;</span>
        <span class="c1"># 获取要删除的模型对象</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">pk</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span><span class="s1">&#39;查询的数据不存在&#39;</span><span class="p">},</span><span class="n">status</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
        <span class="c1"># 删除指定模型对象</span>
        <span class="n">book</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>  <span class="c1"># 物理删除（真正从数据库删除）</span>
        <span class="c1"># book.is_delete = True</span>
        <span class="c1"># book.save()  # （逻辑删除）</span>
        <span class="c1"># 响应：删除时不需要有响应体但要指定状态码为 204</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="mi">204</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">models.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="c1"># Create your models here.</span>
<span class="c1"># 定义图书模型类BookInfo</span>
<span class="k">class</span> <span class="nc">BookInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">btitle</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;名称&#39;</span><span class="p">)</span>
    <span class="n">bpub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;发布日期&#39;</span><span class="p">)</span>
    <span class="n">bread</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;阅读量&#39;</span><span class="p">)</span>
    <span class="n">bcomment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;评论量&#39;</span><span class="p">)</span>
    <span class="n">is_delete</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;逻辑删除&#39;</span><span class="p">)</span>
    <span class="c1"># 注意,如果模型已经迁移建表并且表中如果已经有数据了,那么后新增的字段,必须给默认值或可以为空,不然迁移就报错</span>
    <span class="c1"># upload_to 指定上传到media_root配置项的目录中再创建booktest里面</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;booktest&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;图片&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;tb_books&#39;</span>  <span class="c1"># 指明数据库表名</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;图书&#39;</span>  <span class="c1"># 在admin站点中显示的名称</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">verbose_name</span>  <span class="c1"># 显示的复数名称</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;定义每个数据对象的显示信息&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">btitle</span>

    <span class="k">def</span> <span class="nf">pub_date_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bpub_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># 修改方法名在列表界面的展示</span>
    <span class="n">pub_date_format</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;发布日期&#39;</span>
    <span class="c1"># 指定自定义方法的排序依据</span>
    <span class="n">pub_date_format</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s1">&#39;bpub_date&#39;</span>


<span class="c1"># 定义英雄模型类HeroInfo</span>
<span class="k">class</span> <span class="nc">HeroInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">GENDER_CHOICES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;female&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;male&#39;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">hname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;名称&#39;</span><span class="p">)</span>
    <span class="n">hgender</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SmallIntegerField</span><span class="p">(</span><span class="n">choices</span><span class="o">=</span><span class="n">GENDER_CHOICES</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;性别&#39;</span><span class="p">)</span>
    <span class="n">hcomment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;描述信息&#39;</span><span class="p">)</span>
    <span class="n">hbook</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">BookInfo</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;图书&#39;</span><span class="p">)</span>  <span class="c1"># 外键</span>
    <span class="n">is_delete</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;逻辑删除&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;tb_heros&#39;</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;英雄&#39;</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">verbose_name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hname</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hbook</span><span class="o">.</span><span class="n">bread</span>
    <span class="n">read</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="s1">&#39;阅读量&#39;</span>
    <span class="n">read</span><span class="o">.</span><span class="n">admin_order_field</span> <span class="o">=</span> <span class="s1">&#39;hbook__bread&#39;</span>
    <span class="c1"># HeroInfo.objects.filter(hbook__bread=xx)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">urls.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># 列表视图的路由</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^books/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookListView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
    <span class="c1"># 详情视图的路由</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^books/(?P&lt;pk&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">settings.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 配置项目中静态文件存放/读取目录</span>
<span class="n">STATICFILES_DIRS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># http://127.0.0.1:8000/static/index.html</span>
    <span class="c1"># http://127.0.0.1:8000/static/mm03.jpg</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;static_files&#39;</span><span class="p">),</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;static_files/good&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># 指定上传文件存储目录</span>
<span class="n">MEDIA_ROOT</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span><span class="s2">&quot;static_files/media&quot;</span><span class="p">)</span>


<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;book&#39;</span><span class="p">,</span>  <span class="c1"># 数据库名称</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>  <span class="c1"># 服务器</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;OSChina@2020&#39;</span><span class="p">,</span>  <span class="c1"># 密码</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;init_command&quot;</span><span class="p">:</span> <span class="s2">&quot;SET default_storage_engine=INNODB;&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="rest">
<h3><a class="toc-backref" href="#id60">1.5 明确REST接口开发的核心任务</a><a class="headerlink" href="#rest" title="Permalink to this headline">¶</a></h3>
<p>分析一下上节的案例，可以发现，在开发REST
API接口时，视图中做的最主要有三件事：</p>
<ul class="simple">
<li><p>1.将请求的数据（如JSON格式）转换为模型类对象</p></li>
<li><p>2.操作数据库</p></li>
<li><p>3.将模型类对象转换为响应的数据（如JSON格式）</p></li>
</ul>
<section id="serialization">
<h4>序列化Serialization<a class="headerlink" href="#serialization" title="Permalink to this headline">¶</a></h4>
<p>简而言之，我们可以将序列化理解为：</p>
<p>将程序中的一个数据结构类型转换为其他格式（字典、JSON、XML等），例如将Django中的模型类对象装换为JSON字符串，这个转换过程我们称为序列化。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">queryset</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">book_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># 序列化</span>
<span class="k">for</span> <span class="n">book</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">:</span>
    <span class="n">book_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="s1">&#39;btitle&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">btitle</span><span class="p">,</span>
        <span class="s1">&#39;bpub_date&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bpub_date</span><span class="p">,</span>
        <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bread</span><span class="p">,</span>
        <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">bcomment</span><span class="p">,</span>
        <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">url</span> <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">image</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
    <span class="p">})</span>
<span class="k">return</span> <span class="n">JsonResponse</span><span class="p">(</span><span class="n">book_list</span><span class="p">,</span> <span class="n">safe</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>反之，将其他格式（字典、JSON、XML等）转换为程序中的数据，例如将JSON字符串转换为Django中的模型类对象，这个过程我们称为反序列化。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">json_bytes</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span>
<span class="n">json_str</span> <span class="o">=</span> <span class="n">json_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

<span class="c1"># 反序列化</span>
<span class="n">book_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
<span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">btitle</span><span class="o">=</span><span class="n">book_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;btitle&#39;</span><span class="p">),</span>
    <span class="n">bpub_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">book_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bpub_date&#39;</span><span class="p">),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>我们可以看到，在开发REST
API时，视图中要频繁的进行序列化与反序列化的编写。</p>
<p>总结 在开发REST API接口时，我们在视图中需要做的最核心的事是：</p>
<ul class="simple">
<li><p>将数据库数据序列化为前端所需要的格式，并返回；</p></li>
<li><p>将前端发送的数据反序列化为模型类对象，并保存到数据库中</p></li>
</ul>
</section>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id61">1.6 Django REST framework 简介</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>在序列化与反序列化时，虽然操作的数据不尽相同，但是执行的过程却是相似的，也就是说这部分代码是可以复用简化编写的。</p></li>
<li><p>在开发RESTAPI的视图中，虽然每个视图具体操作的数据不同，但增、删、改、查的实现流程基本套路化，所以这部分代码也是可以复用简化编写的：</p></li>
</ol>
<ul class="simple">
<li><p>增：校验请求数据 -&gt; 执行反序列化过程 -&gt; 保存数据库 -&gt;
将保存的对象序列化并返回</p></li>
<li><p>删：判断要删除的数据是否存在 -&gt;执行数据库删除</p></li>
<li><p>改：判断要修改的数据是否存在 -&gt; 校验请求的数据 -&gt; 执行反序列化过程 -&gt;
保存数据库 -&gt; 将保存的对象序列化并返回</p></li>
<li><p>查：查询数据库 -&gt; 将数据序列化并返回</p></li>
</ul>
<blockquote>
<div><p>Django REST
framework可以帮助我们简化上述两部分的代码编写，大大提高REST
API的开发速度。</p>
</div></blockquote>
<p><strong>认识Django REST framework</strong></p>
<blockquote>
<div><p>Django REST framework 框架是一个用于构建Web API
的强大而又灵活的工具。</p>
<p>通常简称为DRF框架 或 REST framework。</p>
<p>DRF框架是建立在Django框架基础之上，由Tom
Christie大牛二次开发的开源项目。</p>
</div></blockquote>
<p>特点</p>
<blockquote>
<div><ul class="simple">
<li><p>提供了定义序列化器Serializer的方法，可以快速根据 Django ORM
或者其它库自动序列化/反序列化；</p></li>
<li><p>提供了丰富的类视图、Mixin扩展类，简化视图的编写；</p></li>
<li><p>丰富的定制层级：函数视图、类视图、视图集合到自动生成 API，
满足各种需要；</p></li>
<li><p>多种身份认证和权限认证方式的支持；</p></li>
<li><p>内置了限流系统；</p></li>
<li><p>直观的 API web 界面；</p></li>
<li><p>可扩展性，插件丰富</p></li>
</ul>
</div></blockquote>
</section>
</section>
<section id="drf">
<h2><a class="toc-backref" href="#id62">2. DRF工程搭建</a><a class="headerlink" href="#drf" title="Permalink to this headline">¶</a></h2>
<section id="id10">
<h3><a class="toc-backref" href="#id63">2.1 环境安装与配置</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>DRF需要以下依赖：</p>
</div></blockquote>
<ul class="simple">
<li><p>Python (2.7, 3.4, 3.5, 3.6, 3.7)</p></li>
<li><p>Django (1.11, 2.0, 2.1)</p></li>
</ul>
<p>1.安装DRF, 建议安装如下组合套装</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">Djangorestframework</span> <span class="n">markdown</span> <span class="n">Django</span><span class="o">-</span><span class="nb">filter</span> <span class="n">pillow</span> <span class="n">Django</span><span class="o">-</span><span class="n">guardian</span> <span class="n">coreapi</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;https://pypi.doubanio.com/simple/&quot;</span>
</pre></div>
</div>
<p>2.添加rest_framework应用</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;app01.apps.App01Config&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id11">
<h3><a class="toc-backref" href="#id64">2.2 见识DRF的魅力</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<section id="id12">
<h4>2.2.1 创建序列化器<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>在booktest应用中新建serializers.py用于保存该应用的序列化器。
创建一个BookInfoSerializer用于序列化与反序列化。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf8 -*-</span>
<span class="c1"># auther; 18793</span>
<span class="c1"># Date：2022/3/14 12:18</span>
<span class="c1"># filename: serializer.py</span>
<span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BookInfo</span>

<span class="k">class</span> <span class="nc">BookInfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BookInfo</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s1">&#39;__all__&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>model 指明该序列化器处理的数据字段从模型类BookInfo参考生成</p></li>
<li><p>fields
指明该序列化器包含模型类中的哪些字段，’<strong>all</strong>’指明包含所有字段</p></li>
</ul>
</section>
<section id="id13">
<h4>2.2.2 编写视图<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>在booktest应用的views.py中创建视图BookInfoViewSet，这是一个视图集合。</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework.viewsets</span> <span class="kn">import</span> <span class="n">ModelViewSet</span>
<span class="kn">from</span> <span class="nn">.serializer</span> <span class="kn">import</span> <span class="n">BookInfoSerializer</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">BookInfo</span>


<span class="k">class</span> <span class="nc">BookInfoViewSet</span><span class="p">(</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">BookInfoSerializer</span>
</pre></div>
</div>
<ul class="simple">
<li><p>queryset 指明该视图集在查询数据时使用的查询集</p></li>
<li><p>serializer_class 指明该视图在进行序列化或反序列化时使用的序列化器</p></li>
</ul>
</section>
<section id="id14">
<h4>2.2.3 定义路由<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>在app01应用的urls.py中定义路由信息。</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf8 -*-</span>
<span class="c1"># auther; 18793</span>
<span class="c1"># Date：2022/3/14 12:22</span>
<span class="c1"># filename: urls.py</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">re_path</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>
<span class="kn">from</span> <span class="nn">rest_framework.routers</span> <span class="kn">import</span> <span class="n">DefaultRouter</span>

<span class="n">router</span> <span class="o">=</span> <span class="n">DefaultRouter</span><span class="p">()</span>
<span class="n">router</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;books&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookInfoViewSet</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">router</span><span class="o">.</span><span class="n">urls</span>
</pre></div>
</div>
</section>
<section id="id15">
<h4>2.2.4 运行测试<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>运行当前程序（与运行Django一样）</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">runserver</span>
</pre></div>
</div>
<blockquote>
<div><p>在浏览器中输入网址127.0.0.1:8000，可以看到DRF提供的API Web浏览页面：</p>
</div></blockquote>
<img alt="../../../_images/image-20220314171221896.png" src="../../../_images/image-20220314171221896.png" />
<p>1）点击链接127.0.0.1:8000/api/books/ 可以访问获取所有数据的接口—（get
查所有）</p>
<p>2）在页面底下表单部分填写图书信息，可以访问添加新图书的接口，保存新书—（post
新建）</p>
<p>3）在浏览器中输入网址127.0.0.1:8000/books/1/，可以访问获取单一图书信息的接口（id为1的图书）—（get
查单个）</p>
<p>4）在页面底部表单中填写图书信息，可以访问修改图书的接口—（put –更新）</p>
<p>5） 在浏览器中输入网址127.0.0.1:8000/books/6/，可以删除单个图书信息
—-（delete 删单个）</p>
<p>至此，是不是发现Django REST framework很好用！</p>
</section>
</section>
</section>
<section id="serializer">
<h2><a class="toc-backref" href="#id65">3. Serializer序列化器</a><a class="headerlink" href="#serializer" title="Permalink to this headline">¶</a></h2>
<p><strong>序列化器的作用：</strong></p>
<ol class="arabic simple">
<li><p>进行数据的校验</p></li>
<li><p>对数据对象进行转换</p></li>
</ol>
<section id="id16">
<h3><a class="toc-backref" href="#id66">3.1 定义Serializer</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<section id="id17">
<h4>1. 定义方法<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>Django REST
framework中的Serializer使用类来定义，须继承自rest_framework.serializers.Serializer。</p>
<p>例如，我们已有了一个数据库模型类BookInfo</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookInfo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">btitle</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;名称&#39;</span><span class="p">)</span>
    <span class="n">bpub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;发布日期&#39;</span><span class="p">)</span>
    <span class="n">bread</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;阅读量&#39;</span><span class="p">)</span>
    <span class="n">bcomment</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;评论量&#39;</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;booktest&#39;</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;图片&#39;</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>我们想为这个模型类提供一个序列化器，可以定义如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookInfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">btitle</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;名称&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">bpub_date</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;发布日期&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bread</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;阅读量&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">bcomment</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;评论量&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">serializers</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;图片&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>注意：serializer不是只能为数据库模型类定义，也可以为非数据库模型类的数据定义。serializer是独立于数据库之外的存在。</p>
</section>
</section>
<section id="id18">
<h3><a class="toc-backref" href="#id67">3.2 字段与选项</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>参考</p>
<p><a class="reference external" href="https://q1mi.github.io/Django-REST-framework-documentation/api-guide/fields_zh/">https://q1mi.github.io/Django-REST-framework-documentation/api-guide/fields_zh/</a></p>
</section>
<section id="id19">
<h3><a class="toc-backref" href="#id68">3.3 创建Serializer对象</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>定义好Serializer类后，就可以创建Serializer对象了。</p>
</div></blockquote>
<p>Serializer的构造方法为：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Serializer</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">empty</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>说明：</p>
<p>1）用于序列化时，将模型类对象传入instance参数</p>
<p>2）用于反序列化时，将要被反序列化的数据传入data参数</p>
<p>3）除了instance和data参数外，在构造Serializer对象时，还可通过context参数额外添加数据，如</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span> <span class="o">=</span> <span class="n">AccountSerializer</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;request&#39;</span><span class="p">:</span> <span class="n">request</span><span class="p">})</span>
</pre></div>
</div>
<blockquote>
<div><p>通过context参数附加的数据，可以通过Serializer对象的context属性获取。</p>
</div></blockquote>
</section>
<section id="id20">
<h3><a class="toc-backref" href="#id69">3.4 序列化使用</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>我们在django shell中来学习序列化器的使用。</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">shell</span>
</pre></div>
</div>
<section id="id21">
<h4>1 基本使用<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>1） 先查询出一个图书对象</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">booktest.models</span> <span class="kn">import</span> <span class="n">BookInfo</span>

<span class="n">book</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>2） 构造序列化器对象</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">booktest.serializers</span> <span class="kn">import</span> <span class="n">BookInfoSerializer</span>

<span class="n">serializer</span> <span class="o">=</span> <span class="n">BookInfoSerializer</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>3）获取序列化数据 通过data属性可以获取序列化后的数据</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">serializer</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># {&#39;id&#39;: 2, &#39;btitle&#39;: &#39;天龙八部&#39;, &#39;bpub_date&#39;: &#39;1986-07-24&#39;, &#39;bread&#39;: 36, &#39;bcomment&#39;: 40, &#39;image&#39;: None}</span>
</pre></div>
</div>
<blockquote>
<div><p>4）如果要被序列化的是包含多条数据的查询集QuerySet，可以通过添加many=True参数补充说明</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">book_qs</span> <span class="o">=</span> <span class="n">BookInfo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">serializer</span> <span class="o">=</span> <span class="n">BookInfoSerializer</span><span class="p">(</span><span class="n">book_qs</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># [OrderedDict([(&#39;id&#39;, 2), (&#39;btitle&#39;, &#39;天龙八部&#39;), (&#39;bpub_date&#39;, &#39;1986-07-24&#39;), (&#39;bread&#39;, 36), (&#39;bcomment&#39;, 40), (&#39;image&#39;, N]), OrderedDict([(&#39;id&#39;, 3), (&#39;btitle&#39;, &#39;笑傲江湖&#39;), (&#39;bpub_date&#39;, &#39;1995-12-24&#39;), (&#39;bread&#39;, 20), (&#39;bcomment&#39;, 80), (&#39;image&#39;ne)]), OrderedDict([(&#39;id&#39;, 4), (&#39;btitle&#39;, &#39;雪山飞狐&#39;), (&#39;bpub_date&#39;, &#39;1987-11-11&#39;), (&#39;bread&#39;, 58), (&#39;bcomment&#39;, 24), (&#39;ima None)]), OrderedDict([(&#39;id&#39;, 5), (&#39;btitle&#39;, &#39;西游记&#39;), (&#39;bpub_date&#39;, &#39;1988-01-01&#39;), (&#39;bread&#39;, 10), (&#39;bcomment&#39;, 10), (&#39;im&#39;, &#39;booktest/xiyouji.png&#39;)])]</span>
</pre></div>
</div>
</section>
<section id="id22">
<h4>2.序列化的方式<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<section id="serializers-serializer">
<h5>2.1 serializers.Serializer<a class="headerlink" href="#serializers-serializer" title="Permalink to this headline">¶</a></h5>
<p>示例</p>
<p><code class="docutils literal notranslate"><span class="pre">serializers.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">UserProfile</span><span class="p">,</span><span class="n">Book</span>

<span class="k">class</span> <span class="nc">BookSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">Serializer</span><span class="p">):</span>
    <span class="n">title</span><span class="o">=</span><span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">isbn</span><span class="o">=</span><span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">author</span><span class="o">=</span><span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">publish</span><span class="o">=</span><span class="n">serializers</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">rate</span><span class="o">=</span><span class="n">serializers</span><span class="o">.</span><span class="n">FloatField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="serializers-modelserializer">
<h5>2.2 serializers.ModelSerializer<a class="headerlink" href="#serializers-modelserializer" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><p>ModelSerializer与常规的Serializer相同，但提供了：</p>
</div></blockquote>
<ul class="simple">
<li><p>基于模型类自动生成一系列字段</p></li>
<li><p>包含默认的create()和update()的实现</p></li>
</ul>
</section>
<section id="id23">
<h5>1.定义<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">serializers.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">UserProfile</span><span class="p">,</span><span class="n">Book</span>

<span class="k">class</span> <span class="nc">BookModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
        <span class="n">fields</span><span class="o">=</span><span class="s2">&quot;__all__&quot;</span>                                <span class="c1">#将整个表的所有字段都序列化</span>
</pre></div>
</div>
<ul class="simple">
<li><p>model 指明参照哪个模型类</p></li>
<li><p>fields 指明为模型类的哪些字段生成</p></li>
</ul>
</section>
<section id="id24">
<h5>2.指定字段<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. 使用fields来明确字段，__all__表名包含所有字段，也可以写明具体哪些字段
fields = __all__


2. 使用exclude可以明确排除掉哪些字段
exclude = (&#39;image&#39;,)

3.显示指明字段
fields = (&#39;id&#39;, &#39;hname&#39;, &#39;hgender&#39;, &#39;hcomment&#39;, &#39;hbook&#39;)

4.指明只读字段
        fields = (&#39;id&#39;, &#39;btitle&#39;, &#39;bpub_date&#39;， &#39;bread&#39;, &#39;bcomment&#39;)
        read_only_fields = (&#39;id&#39;, &#39;bread&#39;, &#39;bcomment&#39;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookInfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BookInfo</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;btitle&#39;</span><span class="p">,</span> <span class="s1">&#39;bpub_date&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookInfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BookInfo</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;btitle&#39;</span><span class="p">,</span> <span class="s1">&#39;bpub_date&#39;</span><span class="p">,</span><span class="s1">&#39;bread&#39;</span><span class="p">,</span> <span class="s1">&#39;bcomment&#39;</span><span class="p">)</span>
        <span class="n">read_only_fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;bread&#39;</span><span class="p">,</span> <span class="s1">&#39;bcomment&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id25">
<h5>3.添加额外参数<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h5>
<p>我们可以使用extra_kwargs参数为ModelSerializer添加或修改原有的选项参数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookInfoSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">BookInfo</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;btitle&#39;</span><span class="p">,</span> <span class="s1">&#39;bpub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;bread&#39;</span><span class="p">,</span> <span class="s1">&#39;bcomment&#39;</span><span class="p">)</span>
        <span class="n">extra_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;bread&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;min_value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s1">&#39;bcomment&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;min_value&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">}</span>

<span class="c1"># BookInfoSerializer():</span>
<span class="c1">#    id = IntegerField(label=&#39;ID&#39;, read_only=True)</span>
<span class="c1">#    btitle = CharField(label=&#39;名称&#39;, max_length=20)</span>
<span class="c1">#    bpub_date = DateField(allow_null=True, label=&#39;发布日期&#39;, required=False)</span>
<span class="c1">#    bread = IntegerField(label=&#39;阅读量&#39;, max_value=2147483647, min_value=0, required=True)</span>
<span class="c1">#    bcomment = IntegerField(label=&#39;评论量&#39;, max_value=2147483647, min_value=0, required=True)</span>
</pre></div>
</div>
</section>
<section id="id26">
<h5>4.总结<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h5>
<p>Serializer和ModelSerializer两种序列化方式中，前者比较容易理解，适用于新手；后者则在商业项目中被使用的更多，在实际开发中建议大家多使用后者。</p>
<p>许多教材中都将Django REST
framework的Serializer和ModelSerializer，与Django的Form和ModelForm做对比，虽然二者相似，在优劣选择上却是不同的</p>
<p>ModelSerializer有Serializer所有的优点，同时并没有比Serializer明显的不足之外，<strong>所以ModelSerializer比Serializer更优。</strong></p>
</section>
</section>
</section>
</section>
<section id="id27">
<h2><a class="toc-backref" href="#id70">4. 视图</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h2>
<section id="request-response">
<h3><a class="toc-backref" href="#id71">4.1 Request 与 Response</a><a class="headerlink" href="#request-response" title="Permalink to this headline">¶</a></h3>
<section id="request">
<h4>1. Request<a class="headerlink" href="#request" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>REST framework
传入视图的request对象不再是Django默认的HttpRequest对象，而是REST
framework提供的扩展了HttpRequest类的Request类的对象。</p>
</div></blockquote>
<blockquote>
<div><p>REST
framework提供了Parser解析器，在接收到请求后会自动根据Content-Type指明的请求数据类型（如JSON、表单等）将请求数据进行parse解析，解析为类字典对象保存到Request对象中。</p>
<p>Request对象的数据是自动根据前端发送数据的格式进行解析之后的结果。</p>
</div></blockquote>
<blockquote>
<div><p>无论前端发送的哪种格式的数据，我们都可以以统一的方式读取数据。</p>
</div></blockquote>
<section id="id28">
<h5>常用属性<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h5>
</section>
<section id="data">
<h5>1）.data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><p>request.data
返回解析之后的请求体数据。类似于Django中标准的request.POST和
request.FILES属性，但提供如下特性：</p>
<ul class="simple">
<li><p>包含了解析之后的文件和非文件数据</p></li>
<li><p>包含了对POST、PUT、PATCH请求方式解析后的数据</p></li>
<li><p>利用了REST
framework的parsers解析器，不仅支持表单类型数据，也支持JSON数据</p></li>
</ul>
</div></blockquote>
</section>
<section id="query-params">
<h5>2）.query_params<a class="headerlink" href="#query-params" title="Permalink to this headline">¶</a></h5>
<blockquote>
<div><p>request.query_params与Django标准的request.GET相同，只是更换了更正确的名称而已。</p>
</div></blockquote>
</section>
</section>
<section id="response">
<h4>2. Response<a class="headerlink" href="#response" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>rest_framework.response.Response</p>
</div></blockquote>
<blockquote>
<div><p>REST
framework提供了一个响应类Response，使用该类构造响应对象时，响应的具体数据内容会被转换（render渲染）成符合前端需求的类型。</p>
<p>REST
framework提供了Renderer渲染器，用来根据请求头中的Accept（接收数据类型声明）来自动转换响应数据到对应格式。如果前端请求中未进行Accept声明，则会采用默认方式处理响应数据，我们可以通过配置来修改默认响应格式。</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">REST_FRAMEWORK</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;DEFAULT_RENDERER_CLASSES&#39;</span><span class="p">:</span> <span class="p">(</span>  <span class="c1"># 默认响应渲染类</span>
        <span class="s1">&#39;rest_framework.renderers.JSONRenderer&#39;</span><span class="p">,</span>  <span class="c1"># json渲染器</span>
        <span class="s1">&#39;rest_framework.renderers.BrowsableAPIRenderer&#39;</span><span class="p">,</span>  <span class="c1"># 浏览API渲染器</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="id29">
<h5>构造方式<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Response</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><p>data数据不要是render处理之后的数据，只需传递python的内建类型数据即可，REST
framework会使用renderer渲染器处理data。</p>
<p>data不能是复杂结构的数据，如Django的模型类对象，对于这样的数据我们可以使用Serializer序列化器序列化处理后（转为了Python字典类型）再传递给data参数。
参数说明：</p>
<ul class="simple">
<li><p>data: 为响应准备的序列化处理后的数据；</p></li>
<li><p>status: 状态码，默认200；</p></li>
<li><p>template_name: 模板名称，如果使用HTMLRenderer 时需指明；</p></li>
<li><p>headers: 用于存放响应头信息的字典；</p></li>
<li><p>content_type: 响应数据的Content-Type，通常此参数无需传递，REST
framework会根据前端所需类型数据来设置该参数。</p></li>
</ul>
</div></blockquote>
</section>
<section id="id30">
<span id="id31"></span><h5>常用属性：<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h5>
<p><strong>1）.data</strong></p>
<blockquote>
<div><p>传给response对象的序列化后，但尚未render处理的数据</p>
</div></blockquote>
<p><strong>2）.status_code</strong></p>
<blockquote>
<div><p>状态码的数字</p>
</div></blockquote>
<p><strong>3）.content</strong></p>
<blockquote>
<div><p>经过render处理后的响应数据</p>
</div></blockquote>
</section>
</section>
<section id="id32">
<h4>3. 状态码<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>为了方便设置状态码，REST
framewrok在rest_framework.status模块中提供了常用状态码常量。</p>
</div></blockquote>
<p><strong>1）信息告知 - 1xx</strong></p>
<blockquote>
<div><p>HTTP_100_CONTINUE HTTP_101_SWITCHING_PROTOCOLS</p>
</div></blockquote>
<p><strong>2）成功 - 2xx</strong></p>
<blockquote>
<div><p>HTTP_200_OK HTTP_201_CREATED HTTP_202_ACCEPTED
HTTP_203_NON_AUTHORITATIVE_INFORMATION HTTP_204_NO_CONTENT
HTTP_205_RESET_CONTENT HTTP_206_PARTIAL_CONTENT HTTP_207_MULTI_STATUS</p>
</div></blockquote>
<p><strong>3）重定向 - 3xx</strong></p>
<blockquote>
<div><p>HTTP_300_MULTIPLE_CHOICES HTTP_301_MOVED_PERMANENTLY HTTP_302_FOUND
HTTP_303_SEE_OTHER HTTP_304_NOT_MODIFIED HTTP_305_USE_PROXY
HTTP_306_RESERVED HTTP_307_TEMPORARY_REDIRECT</p>
</div></blockquote>
<p><strong>4）客户端错误 - 4xx</strong></p>
<blockquote>
<div><p>HTTP_400_BAD_REQUEST HTTP_401_UNAUTHORIZED HTTP_402_PAYMENT_REQUIRED
HTTP_403_FORBIDDEN HTTP_404_NOT_FOUND HTTP_405_METHOD_NOT_ALLOWED
HTTP_406_NOT_ACCEPTABLE HTTP_407_PROXY_AUTHENTICATION_REQUIRED
HTTP_408_REQUEST_TIMEOUT HTTP_409_CONFLICT HTTP_410_GONE
HTTP_411_LENGTH_REQUIRED HTTP_412_PRECONDITION_FAILED
HTTP_413_REQUEST_ENTITY_TOO_LARGE HTTP_414_REQUEST_URI_TOO_LONG
HTTP_415_UNSUPPORTED_MEDIA_TYPE
HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE HTTP_417_EXPECTATION_FAILED
HTTP_422_UNPROCESSABLE_ENTITY HTTP_423_LOCKED
HTTP_424_FAILED_DEPENDENCY HTTP_428_PRECONDITION_REQUIRED
HTTP_429_TOO_MANY_REQUESTS HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE
HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS</p>
</div></blockquote>
<p><strong>5）服务器错误 - 5xx</strong></p>
<blockquote>
<div><p>HTTP_500_INTERNAL_SERVER_ERROR HTTP_501_NOT_IMPLEMENTED
HTTP_502_BAD_GATEWAY HTTP_503_SERVICE_UNAVAILABLE
HTTP_504_GATEWAY_TIMEOUT HTTP_505_HTTP_VERSION_NOT_SUPPORTED
HTTP_507_INSUFFICIENT_STORAGE
HTTP_511_NETWORK_AUTHENTICATION_REQUIRED</p>
</div></blockquote>
</section>
</section>
<section id="id33">
<h3><a class="toc-backref" href="#id72">4.2 视图概览</a><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>REST framework 提供了众多的通用视图基类与扩展类，以简化视图的编写。</p>
</div></blockquote>
<p>视图的继承关系：</p>
<img alt="../../../_images/image-20220314191218421.png" src="../../../_images/image-20220314191218421.png" />
</section>
<section id="id34">
<h3><a class="toc-backref" href="#id73">4.2.1 2个视图基类</a><a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<section id="apiview">
<h4>APIView<a class="headerlink" href="#apiview" title="Permalink to this headline">¶</a></h4>
<p>APIView 是REST framework提供的所有视图的基类，继承自Django的View父类。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>from rest_framework.views import APIView

APIView与View的不同之处在于：

传入到视图方法中的是REST framework的Request对象，而不是Django的HttpRequeset对象；
视图方法可以返回REST framework的Response对象，视图会为响应数据设置（render）符合前端要求的格式；
任何APIException异常都会被捕获到，并且处理成合适的响应信息；
在进行dispatch()分发前，会对请求进行身份认证、权限检查、流量控制。
支持定义的类属性

authentication_classes 列表或元祖，身份认证类
permissoin_classes 列表或元祖，权限检查类
throttle_classes 列表或元祖，流量控制类

在APIView中仍以常规的类视图定义方法来实现get() 、post() 或者其他请求方式的方法
</pre></div>
</div>
</section>
<section id="genericapiview">
<h4>GenericAPIView[通用视图类]<a class="headerlink" href="#genericapiview" title="Permalink to this headline">¶</a></h4>
<p>继承自<code class="docutils literal notranslate"><span class="pre">APIVIew</span></code>，主要增加了操作序列化器和数据库查询的方法，作用是为下面Mixin扩展类的执行提供方法支持。通常在使用时，可搭配一个或多个Mixin扩展类。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>from rest_framework.generics import GenericAPIView

GenericAPIView(APIView):做了一些封装
    -属性：
         queryset  # 要序列化的数据
         serializer_class  # 指明视图使用的序列化器
    -方法：
          get_queryset：获取qs数据(返回视图使用的查询集，主要用来提供给Mixin扩展类使用，
                是列表视图与详情视图获取数据的基础，默认返回queryset属性)

        get_object：获取一条数据的对象(返回详情视图所需的模型类数据对象，主要用来
             提供给Mixin扩展类使用。在试图中可以调用该方法获取详情信息的模型类对象)

        get_serializer：以后使用它来实例化得到ser对象(返回序列化器对象，主要用来
                  提供给Mixin扩展类使用，如果我们在视图中想要获取序列化器对象，也可以直接调用此方法)

        get_serializer_class：获取序列化类，注意跟上面区分
</pre></div>
</div>
</section>
</section>
<section id="id35">
<h3><a class="toc-backref" href="#id74">4.2.2 5个视图扩展类</a><a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>作用：</p>
<p>提供了几种后端视图（对数据资源进行曾删改查）处理流程的实现，如果需要编写的视图属于这五种，则视图可以通过继承相应的扩展类来复用代码，减少自己编写的代码量。</p>
<p>这五个扩展类需要搭配GenericAPIView父类，因为五个扩展类的实现需要调用GenericAPIView提供的序列化器与数据库查询的方法。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1 查所有：ListModelMixin
    列表视图扩展类，提供list(request, *args, **kwargs)方法快速实现列表视图，返回200状态码。
     该Mixin的list方法会对数据进行过滤和分页。

2 查一个：RetrieveModelMixin
    创建视图扩展类，提供create(request, *args, **kwargs)方法快速实现创建资源的视图，成功返回201状态码。
     如果序列化器对前端发送的数据验证失败，返回400错误。

3 增一个：CreateModelMixin
    详情视图扩展类，提供retrieve(request, *args, **kwargs)方法，可以快速实现返回一个存在的数据对象。
     如果存在，返回200， 否则返回404

4 改一个：UpdateModelMixin
    更新视图扩展类，提供update(request, *args, **kwargs)方法，可以快速实现更新一个存在的数据对象。
    同时也提供partial_update(request, *args, **kwargs)方法，可以实现局部更新。
     成功返回200，序列化器校验数据失败时，返回400错误。

5 删一个：DestroyModelMixin
    删除视图扩展类，提供destroy(request, *args, **kwargs)方法，可以快速实现删除一个存在的数据对象
    成功返回204，不存在返回404。
</pre></div>
</div>
</section>
<section id="id36">
<h3><a class="toc-backref" href="#id75">4.2.3 9个视图子类</a><a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1）查所有：ListAPIView
提供 get 方法
继承自：GenericAPIView、ListModelMixin


2）增一个：CreateAPIView
提供 post 方法
继承自： GenericAPIView、CreateModelMixin


3）查所有+增一个：ListCreateAPIView
提供 get 和 post 方法
继承自： GenericAPIView、ListModelMixin、CreateModelMixin


4）查一个：RetrieveAPIView
提供 get 方法
继承自: GenericAPIView、RetrieveModelMixin


5）改一个：UpdateAPIView
提供 put 和 patch 方法
继承自：GenericAPIView、UpdateModelMixin


6）删一个：DestoryAPIView
提供 delete 方法
继承自：GenericAPIView、DestoryModelMixin


7）查一个+改一个：RetrieveUpdateAPIView
提供 get、put、patch方法
继承自： GenericAPIView、RetrieveModelMixin、UpdateModelMixin


8）查一个+删一个：RetrieveDestroyAPIView
提供 get 和 delete 方法
继承自： GenericAPIView、RetrieveModelMixin、DestoryModelMixin


9） 查一个+改一个+删一个：RetrieveUpdateDestoryAPIView
提供 get、put、patch、delete方法
继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin
</pre></div>
</div>
</section>
<section id="id37">
<h3><a class="toc-backref" href="#id76">4.2.4 视图类的使用</a><a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>下面把APIView 、GenericAPIView、5个视图扩展类、9个视图子类分四层来做演示</p>
<section id="id38">
<h4>模型层<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">models.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;书名&#39;</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DecimalField</span><span class="p">(</span><span class="n">max_digits</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">decimal_places</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;价格&#39;</span><span class="p">)</span>
    <span class="n">publish_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;出版时间&#39;</span><span class="p">)</span>

    <span class="n">publish</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s1">&#39;Publish&#39;</span><span class="p">,</span><span class="n">to_field</span><span class="o">=</span><span class="s1">&#39;nid&#39;</span><span class="p">,</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">authors</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s1">&#39;Author&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;书籍表&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;名字&#39;</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;年龄&#39;</span><span class="p">)</span>
    <span class="n">author_detail</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s1">&#39;AuthorDetail&#39;</span><span class="p">,</span><span class="n">to_field</span><span class="o">=</span><span class="s1">&#39;nid&#39;</span><span class="p">,</span><span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;作者表&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">AuthorDetail</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">telephone</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BigIntegerField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;电话&#39;</span><span class="p">)</span>
    <span class="n">birthday</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;生日&#39;</span><span class="p">)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;地址&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;作者详情表&#39;</span>

<span class="k">class</span> <span class="nc">Publish</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">nid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;社名&#39;</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;地址&#39;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;邮箱&#39;</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;出版社表&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</section>
<section id="id39">
<h4>路由层<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">urls.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>

    <span class="c1"># 查询所有书籍，新增一本书籍</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;book/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>

    <span class="c1"># 查询，修改，删除单本书籍</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;book/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookSingleView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>

    <span class="c1"># 查询所有作者，增加一个作者</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;author/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">AuthorView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>

    <span class="c1"># 查询，修改，删除单个作者</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;author/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">AuthorSingleView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>

    <span class="c1"># 查询所有作者详情，新增一个作者详情</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;authordetail/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">AuthorDetailView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>

    <span class="c1"># 查询，修改，删除单个作者详情</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;authordetail/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">AuthorDetailSingleView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>

    <span class="c1"># 查询所有出版社，新增一个出版社</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;publish/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">PublishView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>

    <span class="c1"># 查询，修改，删除单个出版社</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;publish/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">PublishSingleView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id40">
<h4>视图层<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">views.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>from rest_framework.response import Response
from app01 import serializer
from app01 import models




************************** 第一层：继承APIview **************************
from rest_framework.views import APIView

# 查询所有书籍，增加书籍
class BookView(APIView):
    def get(self, request):
        books = models.Book.objects.all()
        ser = serializer.BookModelSerializer(instance=books, many=True)
        return Response(ser.data)

    def post(self, request):
        ser = serializer.BookModelSerializer(data=request.data)
        if ser.is_valid():
            # 直接保存，保存到哪个表里？需要重写save
            ser.save()
            return Response(ser.data)

        return Response(ser.errors)


# 查询，修改，删除单本书籍
class BookSingleView(APIView):
    def get(self, request, *args, **kwargs):
        book = models.Book.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
        ser = serializer.BookModelSerializer(instance=book)
        print(ser.instance)
        return Response(ser.data)

    def put(self, request, *args, **kwargs):
        book = models.Book.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
        ser = serializer.BookModelSerializer(instance=book, data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        else:
            return Response(&#39;数据校验有误&#39;)

    def delete(self, request, *args, **kwargs):
        book = models.Book.objects.filter(pk=kwargs.get(&#39;pk&#39;)).delete()
        print(book)
        if book[0] &gt; 0:
            return Response(&#39;&#39;)
        else:
            return Response(&#39;要删的不存在&#39;)


# 查询所有作者，增加作者
class AuthorView(APIView):
    def get(self,request):
        author = models.Author.objects.all()
        ser = serializer.AuthorModelSerializer(instance=author,many=True)
        return Response(ser.data)

    def post(self,request):
        ser = serializer.AuthorModelSerializer(data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        return Response(ser.errors)


# 查询，修改，删除单个作者
class AuthorSingleView(APIView):
    def get(self,request, *args, **kwargs):
        author = models.Author.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
        ser = serializer.AuthorModelSerializer(instance=author)
        return Response(ser.data)

    def put(self, request, *args, **kwargs):
        author = models.Author.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()

        ser = serializer.AuthorModelSerializer(instance=author, data=request.data)

        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        return Response(ser.errors)

    def delete(self, request, *args, **kwargs):
        author = models.Author.objects.filter(pk=kwargs.get(&#39;pk&#39;)).delete()
        if author[0] &gt; 0:
            return Response(&#39;&#39;)

        return Response(&#39;要删的不存在&#39;)


# 查询所有作者详情，增加作者详情
class AuthorDetailView(APIView):
    def get(self, request):
        author_detail = models.AuthorDetail.objects.all()
        ser = serializer.AuthorDatailModelserializer(instance=author_detail, many=True)
        return Response(ser.data)

    def post(self,request):
        ser = serializer.AuthorDatailModelserializer(data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        return Response(ser.errors)


# 查询，修改，删除，单个作者详情
class AuthorDetailSingleView(APIView):
    def get(self, request, *args, **kwargs):
        author_detail = models.AuthorDetail.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
        ser = serializer.AuthorDatailModelserializer(instance=author_detail)
        return Response(ser.data)

    def put(self, request, *args, **kwargs):
        author_detail = models.AuthorDetail.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
        ser = serializer.AuthorDatailModelserializer(instance=author_detail, data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        return Response(&#39;数据校验有误&#39;)

    def delete(self, request,*args,**kwargs):
        author_detail = models.AuthorDetail.objects.filter(pk=kwargs.get(&#39;pk&#39;)).delete()
        if author_detail[0] &gt; 0:
            return Response(&#39;&#39;)
        return Response(&#39;要删的数据不存在&#39;)


# 查询所有出版社，增加出版社
class PublishView(APIView):
    def get(self, request):
        publish = models.Publish.objects.all()
        ser = serializer.PublishModelSerializer(instance=publish, many=True)
        return Response(ser.data)

    def post(self, request):
        ser = serializer.PublishModelSerializer(data=request.data)
        if ser.is_valid():
            # 直接保存，保存到哪个表里？需要重写save
            ser.save()
            return Response(ser.data)

        return Response(ser.errors)


# 查询，修改，删除单个出版社
class PublishSingleView(APIView):
    def get(self, request, *args, **kwargs):
        publish = models.Publish.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
        ser = serializer.PublishModelSerializer(instance=publish)
        print(ser.instance)
        return Response(ser.data)

    def put(self, request, *args, **kwargs):
        publish = models.Publish.objects.filter(pk=kwargs.get(&#39;pk&#39;)).first()
        ser = serializer.PublishModelSerializer(instance=publish, data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        else:
            return Response(&#39;数据校验有误&#39;)

    def delete(self, request, *args, **kwargs):
        publish = models.Publish.objects.filter(pk=kwargs.get(&#39;pk&#39;)).delete()
        if publish[0] &gt; 0:
            return Response(&#39;&#39;)
        else:
            return Response(&#39;要删的不存在&#39;)





















*************************  第二层：继承GenericAPIView **************************

from rest_framework.generics import GenericAPIView
# 查询所有书籍，增加书籍
class BookView(GenericAPIView):
    queryset = models.Book.objects.all()  # 要序列化的数据
    serializer_class = serializer.BookModelSerializer  # 要序列化的类
    def get(self, request):
        qs = self.get_queryset() # 推荐用self.get_queryset来获取要序列化的数据
        ser = self.get_serializer(qs, many=True) # 推荐使用self.get_serializer获取实例化后并且传入数据的对象
        return Response(ser.data)

    def post(self, request):
        ser = self.get_serializer(data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)

        return Response(ser.errors)


# 查询，修改，删除单本书籍
class BookSingleView(GenericAPIView):
    queryset = models.Book.objects.all()  # 要序列化的数据
    serializer_class = serializer.BookModelSerializer  # 要序列化的类
    def get(self, request, *args, **kwargs):
        obj = self.get_object()   # 获取单条self.get_object要序列化的数据
        ser = self.get_serializer(obj) # 第一个参数是instance=obj，可以直接写obj
        return Response(ser.data)

    def put(self, request, *args, **kwargs):
        obj = self.get_object()
        ser = self.get_serializer(instance=obj, data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        else:
            return Response(ser.errors)

    def delete(self, request, *args, **kwargs):
        res = self.get_object().delete()  # get_object()拿到对象直接删除了
        if res[0] &gt; 0:
            return Response(&#39;&#39;)
        else:
            return Response(&#39;要删的不存在&#39;)


# 查询所有作者，新增作者
class AuthorView(GenericAPIView):
    queryset = models.Author.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorModelSerializer # 要序列化的类
    def get(self, request):
        qs = self.get_queryset() # 推荐用self.get_queryset来获取要序列化的数据
        ser = self.get_serializer(qs, many=True) # 推荐使用self.get_serializer获取实例化后并且传入数据的对象
        return Response(ser.data)

    def post(self, request):
        ser = self.get_serializer(data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)

        return Response(ser.errors)


# 查询，修改，删除单个作者
class AuthorSingleView(GenericAPIView):
    queryset = models.Author.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorModelSerializer  # 要序列化的类
    def get(self, request, *args, **kwargs):
        obj = self.get_object()   # 获取单条self.get_object要序列化的数据
        ser = self.get_serializer(obj) # 第一个参数是instance=obj，可以直接写obj
        return Response(ser.data)

    def put(self, request, *args, **kwargs):
        obj = self.get_object()
        ser = self.get_serializer(instance=obj, data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        else:
            return Response(ser.errors)

    def delete(self, request, *args, **kwargs):
        res = self.get_object().delete()  # get_object()拿到对象直接删除了
        if res[0] &gt; 0:
            return Response(&#39;&#39;)
        else:
            return Response(&#39;要删的不存在&#39;)


# 查询所有作者详情，增加作者详情
class AuthorDetailView(GenericAPIView):
    queryset = models.AuthorDetail.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorDatailModelserializer  # 要序列化的类

    def get(self, request) :
        qs = self.get_queryset()  # 推荐用self.get_queryset来获取要序列化的数据
        ser = self.get_serializer(qs, many=True)  # 推荐使用self.get_serializer获取实例化后并且传入数据的对象
        return Response(ser.data)

    def post(self, request) :
        ser = self.get_serializer(data=request.data)
        if ser.is_valid() :
            ser.save()
            return Response(ser.data)

        return Response(ser.errors)


# 查询，修改，删除，单个作者详情
class AuthorDetailSingleView(GenericAPIView):
    queryset = models.AuthorDetail.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorDatailModelserializer  # 要序列化的类

    def get(self, request, *args, **kwargs) :
        obj = self.get_object()  # 获取单条self.get_object要序列化的数据
        ser = self.get_serializer(obj)  # 第一个参数是instance=obj，可以直接写obj
        return Response(ser.data)

    def put(self, request, *args, **kwargs) :
        obj = self.get_object()
        ser = self.get_serializer(instance=obj, data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        else :
            return Response(ser.errors)

    def delete(self, request, *args, **kwargs) :
        res = self.get_object().delete()  # get_object()拿到对象直接删除了
        if res[0] &gt; 0 :
            return Response(&#39;&#39;)
        else :
            return Response(&#39;要删的不存在&#39;)

# 查询所有出版社，增加出版社
class PublishView(GenericAPIView) :
    queryset = models.Publish.objects.all()  # 要序列化的数据
    serializer_class = serializer.PublishModelSerializer  # 要序列化的类

    def get(self, request):
        qs = self.get_queryset()  # 推荐用self.get_queryset来获取要序列化的数据
        ser = self.get_serializer(qs, many=True)  # 推荐使用self.get_serializer获取实例化后并且传入数据的对象
        return Response(ser.data)

    def post(self, request):
        ser = self.get_serializer(data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)

        return Response(ser.errors)


# 查询，修改，删除，单个作者详情
class PublishSingleView(GenericAPIView):
    queryset = models.Publish.objects.all()  # 要序列化的数据
    serializer_class = serializer.PublishModelSerializer  # 要序列化的类

    def get(self, request, *args, **kwargs) :
        obj = self.get_object()  # 获取单条self.get_object要序列化的数据
        ser = self.get_serializer(obj)  # 第一个参数是instance=obj，可以直接写obj
        return Response(ser.data)

    def put(self, request, *args, **kwargs) :
        obj = self.get_object()
        ser = self.get_serializer(instance=obj, data=request.data)
        if ser.is_valid():
            ser.save()
            return Response(ser.data)
        else :
            return Response(ser.errors)

    def delete(self, request, *args, **kwargs) :
        res = self.get_object().delete()  # get_object()拿到对象直接删除了
        if res[0] &gt; 0 :
            return Response(&#39;&#39;)
        else :
            return Response(&#39;要删的不存在&#39;)














******************* 第三层：继承GenericAPIView+5个视图扩展类 *******************
#  5个视图扩展类：每个类内部只有一个方法，一个类只完成一个事

from rest_framework.generics import GenericAPIView
from rest_framework.mixins import CreateModelMixin,RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin,ListModelMixin

# 查询所有书籍，增加一本书籍
class BookView(GenericAPIView, ListModelMixin, CreateModelMixin):
    queryset = models.Book.objects.all()  # 要序列化的数据
    serializer_class = serializer.BookModelSerializer  # 要序列化的类

    def get(self, request, *args, **kwargs):  # 不管有值无值最好都把 *args, **kwargs传过来
        return self.list(request, *args, **kwargs)

    def post(self, request):
        return self.create(request)


# 查询，修改，删除单本书籍
class BookSingleView(GenericAPIView, RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin):
    queryset = models.Book.objects.all()  # 要序列化的数据
    serializer_class = serializer.BookModelSerializer  # 要序列化的类

    def get(self, request, *args, **kwargs):
        return self.retrieve(request, *args, **kwargs)

    def put(self, request, *args, **kwargs):
        return self.update(request, *args, **kwargs)

    def delete(self, request, *args, **kwargs):
        return self.destroy(request, *args, **kwargs)


# 查询所有作者，新增作者
class AuthorView(GenericAPIView, ListModelMixin, CreateModelMixin):
    queryset = models.Author.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorModelSerializer # 要序列化的类

    def get(self, request, *args, **kwargs):
        return self.list(request, *args, **kwargs)

    def post(self, request):
        return self.create(request)


# 查询，修改，删除单个作者
class AuthorSingleView(GenericAPIView, RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin):
    queryset = models.Author.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorModelSerializer  # 要序列化的类

    def get(self, request, *args, **kwargs):
        return self.retrieve(request, *args, **kwargs)

    def put(self, request, *args, **kwargs):
        return self.update(request, *args, **kwargs)

    def delete(self, request, *args, **kwargs):
        return self.destroy(request, *args, **kwargs)


# 查询所有作者详情，增加作者详情
class AuthorDetailView(GenericAPIView, ListModelMixin, CreateModelMixin):
    queryset = models.AuthorDetail.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorDatailModelserializer  # 要序列化的类

    def get(self, request, *args, **kwargs):
        return self.list(request, *args, **kwargs)

    def post(self, request):
        return self.create(request)


# 查询，修改，删除，单个作者详情
class AuthorDetailSingleView(GenericAPIView, RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin):
    queryset = models.AuthorDetail.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorDatailModelserializer  # 要序列化的类

    def get(self, request, *args, **kwargs):
        return self.retrieve(request, *args, **kwargs)

    def put(self, request, *args, **kwargs):
        return self.update(request, *args, **kwargs)

    def delete(self, request, *args, **kwargs):
        return self.destroy(request, *args, **kwargs)


# 查询所有出版社，增加出版社
class PublishView(GenericAPIView, ListModelMixin, CreateModelMixin):
    queryset = models.Publish.objects.all()  # 要序列化的数据
    serializer_class = serializer.PublishModelSerializer  # 要序列化的类

    def get(self, request, *args, **kwargs):
        return self.list(request, *args, **kwargs)

    def post(self, request):
        return self.create(request)


# 查询，修改，删除，单个作者详情
class PublishSingleView(GenericAPIView, RetrieveModelMixin, UpdateModelMixin, DestroyModelMixin):
    queryset = models.Publish.objects.all()  # 要序列化的数据
    serializer_class = serializer.PublishModelSerializer  # 要序列化的类

    def get(self, request, *args, **kwargs):
        return self.retrieve(request, *args, **kwargs)

    def put(self, request, *args, **kwargs):
        return self.update(request, *args, **kwargs)

    def delete(self, request, *args, **kwargs):
        return self.destroy(request, *args, **kwargs)








*************** 第四层：9个视图子类 GenericAPIView+5个视图扩展类之一，之二，或之三 ****************
from rest_framework.generics import CreateAPIView, ListAPIView, ListCreateAPIView
from rest_framework.generics import RetrieveAPIView, UpdateAPIView, DestroyAPIView, RetrieveUpdateAPIView, RetrieveDestroyAPIView, RetrieveUpdateDestroyAPIView


# 查询所有书籍，增加一本书籍
class BookView(ListCreateAPIView):
    queryset = models.Book.objects.all()  # 要序列化的数据
    serializer_class = serializer.BookModelSerializer  # 要序列化的类


# 查询，修改，删除单本书籍
class BookSingleView(RetrieveUpdateDestroyAPIView):
    queryset = models.Book.objects.all()  # 要序列化的数据
    serializer_class = serializer.BookModelSerializer  # 要序列化的类


# 查询所有作者，新增一个作者
class AuthorView(ListAPIView, CreateAPIView):
    queryset = models.Author.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorModelSerializer # 要序列化的类


# 查询，修改，删除单个作者
class AuthorSingleView(RetrieveAPIView, UpdateAPIView, DestroyAPIView):
    queryset = models.Author.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorModelSerializer  # 要序列化的类


# 查询所有作者详情，增加作者详情
class AuthorDetailView(ListCreateAPIView):
    queryset = models.AuthorDetail.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorDatailModelserializer  # 要序列化的类


# 查询，修改，删除，单个作者详情
class AuthorDetailSingleView(RetrieveUpdateAPIView, DestroyAPIView):
    queryset = models.AuthorDetail.objects.all()  # 要序列化的数据
    serializer_class = serializer.AuthorDatailModelserializer  # 要序列化的类


# 查询所有出版社，增加一个出版社
class PublishView(ListAPIView, CreateAPIView):
    queryset = models.Publish.objects.all()  # 要序列化的数据
    serializer_class = serializer.PublishModelSerializer  # 要序列化的类


# 查询，删除，修改单个作者详情
class PublishSingleView(RetrieveDestroyAPIView, UpdateAPIView):
    queryset = models.Publish.objects.all()  # 要序列化的数据
    serializer_class = serializer.PublishModelSerializer  # 要序列化的类
</pre></div>
</div>
</section>
</section>
<section id="viewset">
<h3><a class="toc-backref" href="#id77">4.2.5 视图集ViewSet</a><a class="headerlink" href="#viewset" title="Permalink to this headline">¶</a></h3>
<p>使用视图集ViewSet，可以将一系列逻辑相关的动作放到一个类中：</p>
<ul class="simple">
<li><p>list() 提供一组数据</p></li>
<li><p>retrieve() 提供单个数据</p></li>
<li><p>create() 创建数据</p></li>
<li><p>update() 保存数据</p></li>
<li><p>destory() 删除数据</p></li>
</ul>
<p>ViewSet视图集类不再实现get()、post()等方法，而是实现动作 <strong>action</strong> 如
list() 、create() 等。</p>
<p>视图集只在使用as_view()方法的时候，才会将<strong>action</strong>动作与具体请求方式对应上。</p>
<section id="id41">
<h4>常用的视图集父类<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1） ViewSet
继承自APIView与ViewSetMixin，作用也与APIView基本类似，提供了身份认证、权限校验、流量管理等。

ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典（如{‘get’:’list’}）的映射处理工作。

在ViewSet中，没有提供任何动作action方法，需要我们自己实现action方法。





2）GenericViewSet
使用ViewSet通常并不方便，因为list、retrieve、create、update、destory等方法都需要自己编写，而这些方法与前面讲过的Mixin扩展类提供的方法同名，
所以我们可以通过继承Mixin扩展类来复用这些方法而无需自己编写。但是Mixin扩展类依赖与GenericAPIView，所以还需要继承GenericAPIView。

GenericViewSet就帮助我们完成了这样的继承工作，继承自GenericAPIView与ViewSetMixin，在实现了调用as_view()时传入字典（如{&#39;get&#39;:&#39;list&#39;}）
的映射处理工作的同时，还提供了GenericAPIView提供的基础方法，可以直接搭配Mixin扩展类使用。





3）ModelViewSet
继承自GenericViewSet，同时包括了ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin。






4）ReadOnlyModelViewSet
继承自GenericViewSet，同时包括了ListModelMixin、RetrieveModelMixin。
</pre></div>
</div>
</section>
<section id="id42">
<h4>视图集演示<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<blockquote>
<div><p>模型层models.py 和序列化类层 serializer.py参照上面即可</p>
</div></blockquote>
<section id="id43">
<span id="id44"></span><h5>路由层<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">urls.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 路由层 urls.py</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">app01</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>

    <span class="c1"># 查询所有书籍，增加书籍</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;book/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookView</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span><span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="s1">&#39;post&#39;</span><span class="p">:</span> <span class="s1">&#39;create&#39;</span><span class="p">})),</span>

    <span class="c1"># 查询，修改，删除单本书籍</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;book/&lt;int:pk&gt;/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">BookView</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span><span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="s1">&#39;retrieve&#39;</span><span class="p">,</span> <span class="s1">&#39;put&#39;</span><span class="p">:</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="s1">&#39;delete&#39;</span><span class="p">:</span> <span class="s1">&#39;destroy&#39;</span><span class="p">})),</span>

    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;publish/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">PublishView</span><span class="o">.</span><span class="n">as_view</span><span class="p">({</span><span class="s1">&#39;get&#39;</span><span class="p">:</span> <span class="s1">&#39;lqz&#39;</span><span class="p">})),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id45">
<span id="id46"></span><h5>视图层<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">views.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 视图层 views.py</span>
<span class="c1">###目标：只写一个视图类，实现5个接口，最大的问题是，俩接口，都是get</span>

<span class="c1">####第五层：视图集</span>
<span class="c1"># ModelViewSet 5个接口都有</span>

<span class="c1"># ModelViewSet 继承了GenericViewSet和五个视图扩展类</span>
<span class="c1"># ReadOnlyModelViewSet：只有读的两个接口</span>

<span class="kn">from</span> <span class="nn">rest_framework.viewsets</span> <span class="kn">import</span> <span class="n">ModelViewSet</span><span class="p">,</span> <span class="n">ReadOnlyModelViewSet</span>
<span class="kn">from</span> <span class="nn">rest_framework.viewsets</span> <span class="kn">import</span> <span class="n">ViewSet</span><span class="p">,</span> <span class="n">GenericViewSet</span><span class="p">,</span> <span class="n">ViewSetMixin</span>
<span class="c1">#ViewSet是：ViewSetMixin, views.APIView</span>
<span class="c1">#GenericViewSet是：ViewSetMixin, GenericAPIView</span>
<span class="c1"># ViewSetMixin:魔法</span>

<span class="c1">### 如果视图类继承了ViewSetMixin这个类，路由写法就需要path(&#39;book/&#39;, views.BookView.as_view({&#39;get&#39;: &#39;list&#39;, &#39;post&#39;: &#39;create&#39;})</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">源码映射关系</span>
<span class="sd">{&#39;get&#39;: &#39;list&#39;, &#39;post&#39;: &#39;create&#39;}</span>
<span class="sd">      &#39;get&#39;    &#39;list&#39;</span>
<span class="sd">for method, action in actions.items():</span>
<span class="sd">    handler = getattr(self, action)</span>
<span class="sd">    setattr(self, method, handler)</span>
<span class="sd">&#39;&#39;&#39;</span>







<span class="c1">###如果视图类继承了ViewSetMixin这个类，路由的as_view执行的是ViewSetMixin的as_view</span>

<span class="c1"># 查询所有书籍，增加一本书籍,查询、修改、删除单本书籍</span>
<span class="k">class</span> <span class="nc">BookView</span><span class="p">(</span><span class="n">ModelViewSet</span><span class="p">):</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 要序列化的数据</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">BookModelSerializer</span>  <span class="c1"># 要序列化的类</span>


<span class="k">class</span> <span class="nc">PublishView</span><span class="p">(</span><span class="n">GenericViewSet</span><span class="p">):</span> <span class="c1"># 路由变了，其它都没变（注意继承的类，不要混淆了）</span>
    <span class="n">queryset</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Publish</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 要序列化的数据</span>
    <span class="n">serializer_class</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">PublishModelSerializer</span>  <span class="c1"># 要序列化的类</span>
    <span class="k">def</span> <span class="nf">lqz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">request</span><span class="p">):</span>   <span class="c1"># 自定义lqz就是获取所有</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_queryset</span><span class="p">()</span>
        <span class="n">ser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_serializer</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">many</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="id47">
<h3><a class="toc-backref" href="#id78">4.3 视图集和路由器</a><a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://q1mi.github.io/Django-REST-framework-documentation/tutorial/6-viewsets-and-routers_zh/#tutorial-6">https://q1mi.github.io/Django-REST-framework-documentation/tutorial/6-viewsets-and-routers_zh/#tutorial-6</a></p>
</section>
</section>
<section id="id48">
<span id="id49"></span><h2><a class="toc-backref" href="#id79">5.总结</a><a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h2>
<section id="id50">
<h3><a class="toc-backref" href="#id80">两个基类</a><a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>APIView
GenericAPIView：     有关数据库操作，queryset 和serializer_class
</pre></div>
</div>
</section>
<section id="rest-framework-mixins">
<h3><a class="toc-backref" href="#id81">5个视图扩展类(rest_framework.mixins)</a><a class="headerlink" href="#rest-framework-mixins" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CreateModelMixin：create方法创建一条
DestroyModelMixin：destory方法删除一条
ListModelMixin：list方法获取所有
RetrieveModelMixin：retrieve获取一条
UpdateModelMixin：update修改一条
</pre></div>
</div>
</section>
<section id="rest-framework-generics">
<h3><a class="toc-backref" href="#id82">9个子类视图(rest_framework.generics)</a><a class="headerlink" href="#rest-framework-generics" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>CreateAPIView:继承CreateModelMixin,GenericAPIView，有post方法，新增数据
DestroyAPIView：继承DestroyModelMixin,GenericAPIView，有delete方法，删除数据
ListAPIView：继承ListModelMixin,GenericAPIView,有get方法获取所有
UpdateAPIView：继承UpdateModelMixin,GenericAPIView，有put和patch方法，修改数据
RetrieveAPIView：继承RetrieveModelMixin,GenericAPIView，有get方法，获取一条



ListCreateAPIView：继承ListModelMixin,CreateModelMixin,GenericAPIView，有get获取所有，post方法新增
RetrieveDestroyAPIView：继承RetrieveModelMixin,DestroyModelMixin,GenericAPIView，有get方法获取一条，delete方法删除
RetrieveUpdateAPIView：继承RetrieveModelMixin,UpdateModelMixin,GenericAPIView，有get获取一条，put，patch修改
RetrieveUpdateDestroyAPIView：继承RetrieveModelMixin,UpdateModelMixin,DestroyModelMixin,GenericAPIView，有get获取一条，put，patch修改，delete删除
</pre></div>
</div>
</section>
<section id="id51">
<h3><a class="toc-backref" href="#id83">视图集</a><a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ViewSetMixin：           重写了as_view

ViewSet：                 继承ViewSetMixin和APIView

GenericViewSet：         继承ViewSetMixin, generics.GenericAPIView

ModelViewSet：继承mixins.CreateModelMixin,mixins.RetrieveModelMixin,mixins.UpdateModelMixin,mixins.DestroyModelMixin,mixins.ListModelMixin,GenericViewSet






源码：
class ModelViewSet(mixins.CreateModelMixin,
                   mixins.RetrieveModelMixin,
                   mixins.UpdateModelMixin,
                   mixins.DestroyModelMixin,
                   mixins.ListModelMixin,
                   GenericViewSet):
    &quot;&quot;&quot;
    A viewset that provides default `create()`, `retrieve()`, `update()`,
    `partial_update()`, `destroy()` and `list()` actions.
    &quot;&quot;&quot;
    pass



ReadOnlyModelViewSet：继承mixins.RetrieveModelMixin,mixins.ListModelMixin,GenericViewSet
</pre></div>
</div>
<p>APIView和viewsets应该怎样选择呢？</p>
<blockquote>
<div><p>当视图要实现的功能中，存在数据运算、拼接的业务逻辑时，可以一律选择APIView的方式来写视图类，除此以外，</p>
<p>优先使用viewsets的方式来写视图类，毕竟使用viewsets+Router在常规功能上效率极高。</p>
</div></blockquote>
</section>
</section>
<section id="id52">
<h2><a class="toc-backref" href="#id84">6. 视图继承关系图</a><a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h2>
<img alt="../../../_images/2240626-20210415233845133-1609734517.png" src="../../../_images/2240626-20210415233845133-1609734517.png" />
</section>
<section id="id53">
<h2><a class="toc-backref" href="#id85">7. 深度解析Django REST Framework 批量操作</a><a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h2>
<p>参考文献</p>
<p><a class="reference external" href="https://www.freeaihub.com/post/108964.html">https://www.freeaihub.com/post/108964.html</a></p>
</section>
<section id="django-drf-vue-element">
<h2><a class="toc-backref" href="#id86">8.Django（drf）配合 Vue Element 实现文件上传下载功能</a><a class="headerlink" href="#django-drf-vue-element" title="Permalink to this headline">¶</a></h2>
<p>参考文献</p>
<p><a class="reference external" href="https://www.freeaihub.com/post/103776.html">https://www.freeaihub.com/post/103776.html</a></p>
</section>
<section id="django">
<h2><a class="toc-backref" href="#id87">9. django知识查询</a><a class="headerlink" href="#django" title="Permalink to this headline">¶</a></h2>
<p>参考文献</p>
<p><a class="reference external" href="https://www.freeaihub.com/django/topic-3">https://www.freeaihub.com/django/topic-3</a>.html#</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="30.%E9%99%84%E5%BD%951.Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2.html" class="btn btn-neutral float-left" title="23.4.23. 附录1.Django项目的部署" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../05.Tornado/index.html" class="btn btn-neutral float-right" title="23.5. Tornado" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>