<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>23.4.22. 附录1.Django入门+实战教程+笔记 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="23.4.23. 附录1.Django项目的部署" href="30.%E9%99%84%E5%BD%951.Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2.html" />
    <link rel="prev" title="23.4.21. drf视图" href="21.drf-%E8%A7%86%E5%9B%BE.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> 小健_Python_go_Devops
            <img src="../../../_static/python_go.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../Go/index.html">Go语言学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Go_vs_Python/index.html">Go vs Python</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Python全栈系列</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../01.Python%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/index.html">1. Python数据类型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02.Python%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5/index.html">2. Python流程控制语句</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03.Python%E5%87%BD%E6%95%B0/index.html">3. Python函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../04.Python%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0/index.html">4. Python内建函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../05.Python%E6%8E%A8%E5%AF%BC%E5%BC%8F%E5%AD%A6%E4%B9%A0/index.html">5. Python推导式学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../06.Python%E8%BF%AD%E4%BB%A3%E5%99%A8_%E7%94%9F%E6%88%90%E5%99%A8_%E8%A3%85%E9%A5%B0%E5%99%A8/index.html">6. Python生成器、迭代器、装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../07.Python%E9%9D%A2%E5%AF%B9%E5%AF%B9%E8%B1%A1%E8%AE%BE%E8%AE%A1_OOP/index.html">7. Python面对对象设计_OOP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../08.Python%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/index.html">8. Python异常处理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../09.Python%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/index.html">9. Python文件操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../10.Python%E4%B8%AD%E7%9A%84%E5%8C%85%E5%92%8C%E6%A8%A1%E5%9D%97/index.html">10. Python中包和模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../11.Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/index.html">11. Python正则表达式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../12.Python%E6%A0%87%E5%87%86%E5%BA%93/index.html">12. Python 标准库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../13.Python%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93/index.html">13. Python对数据库的操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../14.Python%E4%B8%89%E6%96%B9%E5%BA%93/index.html">14. Python 三方库学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../15.Python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/index.html">15. Python 网络编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../16.Python%E7%BA%BF%E7%A8%8B%E5%92%8C%E8%BF%9B%E7%A8%8B/index.html">16. Python 进程和线程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../17.Python%E8%AF%AD%E8%A8%80%E7%9A%84%E6%89%A9%E5%B1%95%E4%B8%8E%E5%B5%8C%E5%85%A5/index.html">17. Python与C语言扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../18.%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E5%91%98%E7%9A%84Python%E8%84%9A%E6%9C%AC%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/index.html">18. 系统管理员的Python脚本编程指南-读书笔记</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../20.Python%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/index.html">19. Python自动化运维最佳实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../21.Python%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0/index.html">20. Python进阶学习</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../22.Python%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/index.html">21. Python网络爬虫</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../23.%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/index.html">22. 前端基础知识</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">23. Python框架</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../01.%E5%B8%B8%E7%94%A8%E7%9A%84GUI%E6%A1%86%E6%9E%B6/index.html">23.1. 常用的GUI框架</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02.Flask/index.html">23.2. Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../03.Scrapy/index.html">23.3. Scrapy</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">23.4. Django</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="01.%E5%AE%89%E8%A3%85DjangoWeb%E6%A1%86%E6%9E%B6.html">23.4.1. 安装DjangoWeb框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="02.Django%E6%A1%86%E6%9E%B6%E7%9A%84%E4%BD%BF%E7%94%A8.html">23.4.2. Django框架的使用</a></li>
<li class="toctree-l4"><a class="reference internal" href="03.Django%E6%B5%81%E7%A8%8B%E8%B7%91%E9%80%9A.html">23.4.3. Django流程跑通</a></li>
<li class="toctree-l4"><a class="reference internal" href="04.%E5%AE%9E%E6%88%98%E6%BC%94%E7%BB%83-%E5%BC%80%E5%8F%91Django%E7%AB%99%E7%82%B9.html">23.4.4. 实战演练-开发Django站点</a></li>
<li class="toctree-l4"><a class="reference internal" href="05.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A7%86%E5%9B%BE%E5%92%8C%E8%B7%AF%E7%94%B1.html">23.4.5. 玩转Django2.0-视图和路由</a></li>
<li class="toctree-l4"><a class="reference internal" href="06.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93.html">23.4.6. 玩转Django2.0-模型与数据库</a></li>
<li class="toctree-l4"><a class="reference internal" href="06.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E6%9D%BF.html">23.4.7. 玩转Django2.0-模板</a></li>
<li class="toctree-l4"><a class="reference internal" href="07.%E7%8E%A9%E8%BD%ACDjango2.0-%E8%A1%A8%E5%8D%95%E4%B8%8E%E6%A8%A1%E5%9E%8B.html">23.4.8. 玩转Django2.0-表单与模型</a></li>
<li class="toctree-l4"><a class="reference internal" href="08.%E7%8E%A9%E8%BD%ACDjango2.0-%E6%A8%A1%E5%9E%8B%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93.html">23.4.9. 玩转Django2.0-模型与数据库</a></li>
<li class="toctree-l4"><a class="reference internal" href="09.%E7%8E%A9%E8%BD%ACDjango2.0-admin%E5%90%8E%E5%8F%B0%E7%B3%BB%E7%BB%9F.html">23.4.10. 玩转Django2.0-admin后台系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="10.%E7%8E%A9%E8%BD%ACDjango2.0-Auth%E8%AE%A4%E8%AF%81%E7%B3%BB%E7%BB%9F.html">23.4.11. 玩转Django2.0-Auth认证系统</a></li>
<li class="toctree-l4"><a class="reference internal" href="11.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%B8%B8%E7%94%A8%E7%9A%84Web%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F.html">23.4.12. 玩转Django2.0-常用的Web应用程序</a></li>
<li class="toctree-l4"><a class="reference internal" href="12.%E7%8E%A9%E8%BD%ACDjango2.0-%E9%9F%B3%E4%B9%90%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91.html">23.4.13. 玩转Django2.0-音乐网站开发</a></li>
<li class="toctree-l4"><a class="reference internal" href="13.%E7%8E%A9%E8%BD%ACDjango2.0-%E7%AC%AC%E4%B8%89%E6%96%B9%E5%8A%9F%E8%83%BD%E5%BA%94%E7%94%A8.html">23.4.14. 玩转Django2.0-第三方功能应用</a></li>
<li class="toctree-l4"><a class="reference internal" href="14.%E7%8E%A9%E8%BD%ACDjango2.0-Django%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2.html">23.4.15. 玩转Django2.0-Django项目上线部署</a></li>
<li class="toctree-l4"><a class="reference internal" href="15.%E7%8E%A9%E8%BD%ACDjango2.0-Django-Rest-Framework%E6%A1%86%E6%9E%B6.html">23.4.16. 玩转Django2.0-Django-Rest-Framework框架</a></li>
<li class="toctree-l4"><a class="reference internal" href="16.%E7%8E%A9%E8%BD%ACDjango2.0-django%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E4%B8%80.html">23.4.17. 玩转Django2.0-django图书管理系统一</a></li>
<li class="toctree-l4"><a class="reference internal" href="17.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB-django%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91%E4%B8%80.html">23.4.18. 玩转Django2.0-前后端分离-django主机管理开发一</a></li>
<li class="toctree-l4"><a class="reference internal" href="18.%E7%8E%A9%E8%BD%ACDjango2.0-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB-django%E4%B8%BB%E6%9C%BA%E7%AE%A1%E7%90%86%E5%BC%80%E5%8F%91%E4%BA%8C.html">23.4.19. 前后端分离-django主机管理开发二</a></li>
<li class="toctree-l4"><a class="reference internal" href="20.drf-%E8%AE%A4%E8%AF%81.html">23.4.20. drf-认证</a></li>
<li class="toctree-l4"><a class="reference internal" href="21.drf-%E8%A7%86%E5%9B%BE.html">23.4.21. drf视图</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">23.4.22. 附录1.Django入门+实战教程+笔记</a></li>
<li class="toctree-l4"><a class="reference internal" href="30.%E9%99%84%E5%BD%951.Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2.html">23.4.23. 附录1.Django项目的部署</a></li>
<li class="toctree-l4"><a class="reference internal" href="30.%E9%99%84%E5%BD%952.Django-REST-framework%E5%AD%A6%E4%B9%A0.html">23.4.24. django-rest-framework学习</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../05.Tornado/index.html">23.5. Tornado</a></li>
<li class="toctree-l3"><a class="reference internal" href="../06.Python%E9%AB%98%E6%95%88%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-Django-Flask/index.html">23.6. Python高效开发实战-Django、Flask</a></li>
<li class="toctree-l3"><a class="reference internal" href="../07.Python-Django-Web%E5%85%B8%E5%9E%8B%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/index.html">23.7. Python-Django-Web典型模块开发实战</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../25.Python%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2/index.html">24. Python开发环境部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../26.%E6%88%91%E7%9A%84%E7%AC%AC%E4%B8%80%E6%9C%AC%E7%AE%97%E6%B3%95%E4%B9%A6/index.html">25. 我的第一本算法书</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../27.Python3%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98/index.html">26. Python3网络爬虫开发实战</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../28.Python%E8%AE%A9%E7%B9%81%E7%90%90%E7%9A%84%E5%B7%A5%E4%BD%9C%E8%87%AA%E5%8A%A8%E5%8C%96/index.html">27. Python让繁琐的工作自动化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../29.%E7%96%AF%E7%8B%82%E7%9A%84Python%E8%AE%B2%E4%B9%89/index.html">28. 疯狂的Python讲义</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../30.Django_Vue/index.html">29. Django_Vue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../31.%E7%BC%96%E5%86%99Python%E7%9A%8490%E4%B8%AA%E6%9C%89%E6%95%88%E6%96%B9%E6%B3%95/index.html">30. 编写Python的90个有效方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../32.Vue3.0%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F/index.html">31. Vue3.0管理系统</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5/index.html">Python测试开发入门与实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vue/index.html">Vue.js企业开发实战</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Vue_Node.js/index.html">Vue.js+Node.js开发实战</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">小健_Python_go_Devops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Python全栈系列</a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">23. </span>Python框架</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">23.4. </span>Django</a> &raquo;</li>
      <li><span class="section-number">23.4.22. </span>附录1.Django入门+实战教程+笔记</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/Python/24.Python框架/04.Django/29.附录1.Django入门-实战教程笔记.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#django" id="id32">附录1.Django入门+实战教程+笔记</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id33">1. 初识</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id34">2. 登录，登录首页实现步骤</a></p></li>
<li><p><a class="reference internal" href="#get" id="id35">3. GET方式_登录功能</a></p>
<ul>
<li><p><a class="reference internal" href="#post" id="id36">3.1 post请求的请求报文</a></p></li>
<li><p><a class="reference internal" href="#id3" id="id37">3.2 post响应报文</a></p></li>
<li><p><a class="reference internal" href="#getpost" id="id38">3.3 GET和POST请求区别</a></p></li>
<li><p><a class="reference internal" href="#id4" id="id39">3.4 GET请求方式</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id40">3.5 POST请求方式</a></p></li>
<li><p><a class="reference internal" href="#http" id="id41">3.6 HTTP特性</a></p></li>
<li><p><a class="reference internal" href="#post403" id="id42">3.7 解决POST请求错误403</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id43">4. 注册功能</a></p>
<ul>
<li><p><a class="reference internal" href="#stu" id="id44">4.1 创建Stu模型类</a></p></li>
<li><p><a class="reference internal" href="#id7" id="id45">4.2 创建数据库表</a></p></li>
<li><p><a class="reference internal" href="#url-stu-urls-py" id="id46">4.3 配置URL(stu/urls.py)</a></p></li>
<li><p><a class="reference internal" href="#mysql" id="id47">4.4 连接mysql数据库</a></p></li>
<li><p><a class="reference internal" href="#views" id="id48">4.5 views内容</a></p></li>
<li><p><a class="reference internal" href="#html" id="id49">4.6 注册页面HTML源码</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#admin" id="id50">5. admin后台管理类操作数据库</a></p></li>
<li><p><a class="reference internal" href="#id8" id="id51">6. 单表查询</a></p>
<ul>
<li><p><a class="reference internal" href="#id9" id="id52">6.1 查询单个对象</a></p></li>
<li><p><a class="reference internal" href="#id10" id="id53">6.2 查询多个对象</a></p></li>
<li><p><a class="reference internal" href="#id11" id="id54">6.3 日期查询</a></p></li>
<li><p><a class="reference internal" href="#id12" id="id55">6.4 范围查询</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id13" id="id56">7. 单表增_删 改</a></p>
<ul>
<li><p><a class="reference internal" href="#id14" id="id57">7.1 增加</a></p></li>
<li><p><a class="reference internal" href="#id15" id="id58">7.2 删除</a></p></li>
<li><p><a class="reference internal" href="#id16" id="id59">7.3 修改</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id17" id="id60">8. 创建单表</a></p>
<ul>
<li><p><a class="reference internal" href="#id18" id="id61">8.1 常用字段类型</a></p></li>
<li><p><a class="reference internal" href="#id19" id="id62">8.2 常用属性</a></p></li>
<li><p><a class="reference internal" href="#id20" id="id63">8.3 重点理解属性</a></p></li>
<li><p><a class="reference internal" href="#onetoonefield" id="id64">8.4 使用OneToOneField(一对一)</a></p></li>
<li><p><a class="reference internal" href="#foreignkey" id="id65">8.5 使用ForeignKey(一对多）</a></p></li>
<li><p><a class="reference internal" href="#manytomanyfield" id="id66">8.6 使用ManyToManyField(多对多)</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#url" id="id67">9. 配置URL</a></p>
<ul>
<li><p><a class="reference internal" href="#id22" id="id68">9.1 URL传参</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#httprequesthttpresponse" id="id69">10. HttpRequest和HttpResponse</a></p>
<ul>
<li><p><a class="reference internal" href="#httprequest" id="id70">10.1 HttpRequest请求对象（只读）</a></p></li>
<li><p><a class="reference internal" href="#id23" id="id71">10.2 常见的属性和方法</a></p></li>
<li><p><a class="reference internal" href="#httpresponse" id="id72">10.3 HttpResponse 响应对象</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id24" id="id73">11. 文件</a></p>
<ul>
<li><p><a class="reference internal" href="#id25" id="id74">11.1 文件上传</a></p></li>
<li><p><a class="reference internal" href="#id26" id="id75">11.2 图片读取</a></p></li>
<li><p><a class="reference internal" href="#id27" id="id76">11.3 文件下载</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id28" id="id77">12. 重定向</a></p>
<ul>
<li><p><a class="reference internal" href="#httpresponseredirect" id="id78">12.1 HttpResponseRedirect</a></p></li>
<li><p><a class="reference internal" href="#redirect" id="id79">12.2 redirect</a></p></li>
<li><p><a class="reference internal" href="#url-1" id="id80">12.3 配置URL</a></p></li>
<li><p><a class="reference internal" href="#id30" id="id81">12.4 配置视图</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#id31" id="id82">总结</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="django">
<h1><a class="toc-backref" href="#id32"><span class="section-number">23.4.22. </span>附录1.Django入门+实战教程+笔记</a><a class="headerlink" href="#django" title="Permalink to this headline">¶</a></h1>
<section id="id1">
<h2><a class="toc-backref" href="#id33">1. 初识</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">startapp</span> <span class="n">stu</span>   <span class="n">创建新应用</span>  <span class="n">名称</span>

<span class="o">&amp;</span><span class="n">emsp</span><span class="p">;</span> <span class="n">制表符</span>

<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">runserver</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8000</span>   <span class="n">启动服务器</span>

<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span>  <span class="n">查看功能</span>

<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span> <span class="n">名称</span>      <span class="n">创建迁移表</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2><a class="toc-backref" href="#id34">2. 登录，登录首页实现步骤</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>1.创建一个Djan项目</p>
<p>2.在终端中创建应用 python manage.py startapp 应用名</p>
<p>3.在项目包中的settings.py中添加应用</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;stu&#39;</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>4.确定访问路径http://127.0.0.1:8000/student/</p>
<p>5.配置项目根路由</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;student/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;stu.urls&#39;</span><span class="p">))</span>   <span class="c1"># ctrl+目标即可超链接，，include是添加子路由</span>
<span class="p">]</span>
</pre></div>
</div>
<p>6.在应用包下创建并配置url.py文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- codeing = utf-8 -*-</span>
<span class="c1"># @Software : PyCharm</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>  <span class="c1"># python3 必须加 from .</span>

<span class="n">urlpatterns</span><span class="o">=</span><span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login_view</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>7.在应用下view.py文件创建处理函数</p>
<p>8.在templates目录下创建login.html文件 action=’ ’, 就是账号密码提交地址</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;&quot;  method=&quot;get&quot;&gt;
        &lt;p&gt;
            &lt;label&gt;用户名：&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;unname&quot;/&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;label&gt;密&amp;emsp;码：&lt;/label&gt;&lt;input type=&quot;password&quot; name=&quot;pwd&quot;/&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&lt;input type=&quot;submit&quot; value=&quot;登录&quot;/&gt;
        &lt;/p&gt;

    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>效果图：</p>
<img alt="../../../_images/image-20220313120708193.png" src="../../../_images/image-20220313120708193.png" />
</section>
<section id="get">
<h2><a class="toc-backref" href="#id35">3. GET方式_登录功能</a><a class="headerlink" href="#get" title="Permalink to this headline">¶</a></h2>
<section id="post">
<h3><a class="toc-backref" href="#id36">3.1 post请求的请求报文</a><a class="headerlink" href="#post" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>POST /06_web_HTTP/success.html HTTP/1.1
        Host: localhost:8080
        Connection: keep-alive
        Content-Length: 30   请求体中数据的长度(请求参数)
        Cache-Control: max-age=0   不缓存
        Origin: http://localhost:8080
        Upgrade-Insecure-Requests: 1
        User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.81 Safari/537.36
        Content-Type: application/x-www-form-urlencoded
        Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
        Referer: http://localhost:8080/06_web_HTTP/login.html
        Accept-Encoding: gzip, deflate, br
        Accept-Language: zh-CN,zh;q=0.8
        3、空行
        4、请求体(请求参数  多个参数之间使用&amp;连接)
        username=admin&amp;password=123213
</pre></div>
</div>
</section>
<section id="id3">
<h3><a class="toc-backref" href="#id37">3.2 post响应报文</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>HTTP/1.1 200 OK
           Date:Sun,01 Apr 2020 13:14:07 GMT(成功响应的时间)
           Server: Apache-Coyote/1.1   (服务器内核版本)
           Accept-Ranges: bytes   (数据单位)
           ETag: W/&quot;157-1504593208325&quot;
           Content-Type: text/html;charset=utf-8  (响应文件的类型)
           Content-Length: 15    (响应体内容大小)
           3、空行

           4、响应体(服务器给浏览器的响应体中的内容才是浏览器解析显示在页面中的内容)
</pre></div>
</div>
</section>
<section id="getpost">
<h3><a class="toc-backref" href="#id38">3.3 GET和POST请求区别</a><a class="headerlink" href="#getpost" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1、POST请求的请求参数在请求实体内容中，GET请求的请求参数存放在URL中

2、GET请求相对不安全，post相对安全 （其实都不安全）

3、GET请求的URL参数长度有限（不超过2K），post参数大小没有限制

4、GET请求一般做查询（有缓存），POST请求一般做添加/删除/修改（无缓存）

5、Django服务器GET/POST请求为什么接受参数方式一样？
    因为他们都是QueryDict对象（django.http.request）
</pre></div>
</div>
</section>
<section id="id4">
<h3><a class="toc-backref" href="#id39">3.4 GET请求方式</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;get&quot;</span><span class="o">&gt;</span>
<span class="n">浏览器地址栏直接访问</span>
<span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/student/&quot;</span><span class="o">&gt;</span><span class="n">超链接</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">href</span><span class="o">=</span><span class="s2">&quot;/student/&quot;</span>
</pre></div>
</div>
</section>
<section id="id5">
<h3><a class="toc-backref" href="#id40">3.5 POST请求方式</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
<span class="n">浏览器地址栏直接访问</span>
<span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/student/&quot;</span><span class="o">&gt;</span><span class="n">超链接</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
<span class="n">window</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">href</span><span class="o">=</span><span class="s2">&quot;/student/&quot;</span>
</pre></div>
</div>
</section>
<section id="http">
<h3><a class="toc-backref" href="#id41">3.6 HTTP特性</a><a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>1. HTTP1.1版本后支持长连接
2. 单项性协议（必须先有请求后有响应）
3. 无状态的协议
    Cookie：客户端相关
    Session：服务器相关
</pre></div>
</div>
</section>
<section id="post403">
<h3><a class="toc-backref" href="#id42">3.7 解决POST请求错误403</a><a class="headerlink" href="#post403" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.middleware.security.SecurityMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="c1">#&#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>或者在html文件加入这个</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/register/&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;注册&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">body</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id43">4. 注册功能</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<section id="stu">
<h3><a class="toc-backref" href="#id44">4.1 创建Stu模型类</a><a class="headerlink" href="#stu" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="c1"># Create your models here.</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">sname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1">## 设置唯一用戶名</span>
    <span class="n">spwd</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;Student:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sname</span>  <span class="c1"># Student:list</span>

<span class="c1">#     def __unicode__(self):    # python2.0版本这样写</span>
<span class="c1">#         return u&#39;Student:%s&#39;%self.sname</span>
</pre></div>
</div>
</section>
<section id="id7">
<h3><a class="toc-backref" href="#id45">4.2 创建数据库表</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#创建当前应用的迁移文件</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">makemigrations</span> <span class="n">stu</span>

<span class="c1">#生成数据库表</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">migrate</span>  <span class="n">应用名</span>   <span class="c1"># 只执行当前应用名</span>
<span class="c1">#查看迁移文件生成的SQL语句</span>
<span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">sqlmigrate</span> <span class="n">student</span> <span class="mi">0001</span>
</pre></div>
</div>
</section>
<section id="url-stu-urls-py">
<h3><a class="toc-backref" href="#id46">4.3 配置URL(stu/urls.py)</a><a class="headerlink" href="#url-stu-urls-py" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^login/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">login_view</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^register/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index_view</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^show/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">show_view</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="mysql">
<h3><a class="toc-backref" href="#id47">4.4 连接mysql数据库</a><a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;stu&#39;</span><span class="p">,</span>  <span class="c1"># 数据库名称</span>
        <span class="s1">&#39;HOST&#39;</span><span class="p">:</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span>  <span class="c1"># 服务器</span>
        <span class="s1">&#39;PORT&#39;</span><span class="p">:</span> <span class="s1">&#39;3306&#39;</span><span class="p">,</span>
        <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span>
        <span class="s1">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s1">&#39;OSChina@2020&#39;</span><span class="p">,</span>  <span class="c1"># 密码</span>
        <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;init_command&quot;</span><span class="p">:</span> <span class="s2">&quot;SET default_storage_engine=INNODB;&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># 语言编码也可以改一下</span>
<span class="n">LANGUAGE_CODE</span> <span class="o">=</span> <span class="s1">&#39;zh-Hans&#39;</span>

<span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;Asia/Shanghai&#39;</span>

<span class="n">USE_I18N</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">USE_L10N</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">USE_TZ</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">djangoStu/__init__.py</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="n">pymysql</span><span class="o">.</span><span class="n">install_as_MySQLdb</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="views">
<h3><a class="toc-backref" href="#id48">4.5 views内容</a><a class="headerlink" href="#views" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="o">*</span>


<span class="c1"># Create your views here.</span>

<span class="k">def</span> <span class="nf">index_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;register.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">uname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;uname&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pwd&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">uname</span> <span class="ow">and</span> <span class="n">pwd</span><span class="p">:</span>
            <span class="n">stu</span> <span class="o">=</span> <span class="n">Student</span><span class="p">(</span><span class="n">sname</span><span class="o">=</span><span class="n">uname</span><span class="p">,</span> <span class="n">spwd</span><span class="o">=</span><span class="n">pwd</span><span class="p">)</span>
            <span class="n">stu</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;注册成功!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;注册失败!&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">show_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># 1.查询stu_student表中的所有数据</span>
    <span class="n">stus</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>  <span class="c1"># 查询所有</span>
    <span class="c1"># 2.</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;show.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;students&#39;</span><span class="p">:</span> <span class="n">stus</span><span class="p">})</span>  <span class="c1"># 字典传值</span>


<span class="k">def</span> <span class="nf">login_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;login.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># 1.获取请求参数</span>
        <span class="n">uname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;uname&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">pwd</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pwd&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1"># 2.查询数据库</span>
        <span class="k">if</span> <span class="n">uname</span> <span class="ow">and</span> <span class="n">pwd</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">sname</span><span class="o">=</span><span class="n">uname</span><span class="p">,</span> <span class="n">spwd</span><span class="o">=</span><span class="n">pwd</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c1"># 根据某个条件查询</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;登录成功！&#39;</span><span class="p">)</span>
        <span class="c1"># 3.判断是否登录成功</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;登录失败！&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="html">
<h3><a class="toc-backref" href="#id49">4.6 注册页面HTML源码</a><a class="headerlink" href="#html" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">register.html</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;注册界面&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

    &lt;form action=&quot;/register/&quot; method=&quot;post&quot;&gt;
        {% csrf_token %}
        &lt;p&gt;
            &lt;label for=&quot;ua&quot;&gt;用户名：&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;uname&quot; id=&quot;ua&quot;/&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;label for=&quot;pd&quot;&gt;密&amp;emsp;码：&lt;/label&gt;&lt;input type=&quot;password&quot; name=&quot;pwd&quot; id=&quot;pd&quot;/&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;input type=&quot;submit&quot; value=&quot;注册&quot;/&gt;
        &lt;/p&gt;
    &lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>如果你访问<code class="docutils literal notranslate"><span class="pre">127.0.0.1:8000/student/show/</span></code>，就可以利用模型，调用mysql库，在html网页查看数据库信息</p>
<p><code class="docutils literal notranslate"><span class="pre">show.html</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;table border=&quot;1&quot; cellspacing=&quot;0&quot; width=&quot;500px&quot;&gt;
        &lt;tr&gt;
            &lt;th&gt;编号&lt;/th&gt;
            &lt;th&gt;姓名&lt;/th&gt;
            &lt;th&gt;密码&lt;/th&gt;
        &lt;/tr&gt;
        {% for stu in students %}
            &lt;tr&gt;
                &lt;td&gt;{{ forloop.counter }}&lt;/td&gt;
                &lt;td&gt;{{ stu.sname }}&lt;/td&gt;
                &lt;td&gt;{{ stu.spwd }}&lt;/td&gt;
            &lt;/tr&gt;
        {% endfor %}
    &lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
</section>
</section>
<section id="admin">
<h2><a class="toc-backref" href="#id50">5. admin后台管理类操作数据库</a><a class="headerlink" href="#admin" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python manage.py createsuperuser   创建超级用户
设置你想要的账号和密码，注意密码不显示！记住一定要注释，很容易忘记。

添加  admin.site.register(Movie)  使得其与后台站点绑定
</pre></div>
</div>
</section>
<section id="id8">
<h2><a class="toc-backref" href="#id51">6. 单表查询</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>定义一个函数_显示ORM底层生成SQL</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">showsql</span><span class="p">():</span>
    <span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">connection</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">queries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;sql&#39;</span><span class="p">])</span>
</pre></div>
</div>
<section id="id9">
<h3><a class="toc-backref" href="#id52">6.1 查询单个对象</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p><strong>ASC升序 ——————— DESC降序</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>所有的继承自model.Model的类 都会有一个叫objects（管理者）

    ----查询一个 （有且只能有一个）（少于一个或者多于一个都报错 ）
                         返回值Movie对象
                        Movie.object.get(mid=147)   注意当不存在时会报错！！！
                        SELECT `movie`.`mid`, `movie`.`mname`, `movie`.`mdesc`, `movie`.`mimg`, `movie`.`mlink` FROM `movie` LIMIT 21

    ----获得第一个
                        Movie.objects.first()
                        Movie.objects.filter()

    ----获得最后一个
                        Movie.objects.last()


    ----获得记录的总数
                        Movie.objects.count()
</pre></div>
</div>
</section>
<section id="id10">
<h3><a class="toc-backref" href="#id53">6.2 查询多个对象</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>----获得所有的记录
                        Movie.objects.all()
                        #在django的1.11.6中默认中只是获得21个
                        #懒加载
                        Movie.objects.filter()

    ----切片 （不支持负数索引）
                        Movie.objects.all()[20:40]
                        # 底层直接使用了limit字句，可以自动的分页
                        # django的orm性能非常强大，能节省很多工作

    ----过滤
                        # 集合（游标，结果集，查询集）
                        Movie.objects.filter(mname=‘麻辣学院’)

                        # 底层直接使用了limit字句，可以自动的分页
                        # django的orm性能非常强大，能节省很多工作

    ----模糊查询
                        like
                        %（多个字符） _(一个字符)
                        SELECT * from movie WHERE mname LIKE &#39;%爱情&#39;

    ----查询爱情结尾的
                          SELECT * from movie WHERE mname LIKE &#39;%爱情&#39;
                          Movie.objects.filter(mname__endswith=&#39;爱情&#39;)


    ----忽略大小写
                          Movie.objects.filter(mname__istartswith=&#39;h&#39;)


    ----查询某个字段是否为null
                          Movie.objects.filter(mname__isnull=True)


    ----多条件查询
                          Movie.objects.filter(mname__contains=&#39;爱情&#39;,mid=147)
                            and
                          Movie.objects.filter(mname__contains=&#39;爱情&#39;).filter(mid=147)


    ----部分查询
                          Movie.objects.values(&#39;mname&#39;,&#39;mid&#39;).filter(mname__contains=&#39;爱情&#39;)


    ----排除一部分
                          Movie.objects.filter(mname__contains=&#39;爱情&#39;).exclude(mname__startswith=&#39;爱情&#39;)


    ----排序
                    Movie.objects.order_by(&#39;mid&#39;)        升序

                    Movie.object.order_by(&#39;-mid&#39;)          降序
</pre></div>
</div>
</section>
<section id="id11">
<h3><a class="toc-backref" href="#id54">6.3 日期查询</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>----查询大于某个时间的记录
                    Post.objects.filter(created__gt=&#39;2017-10-20&#39;)

    ----查询最近一个月的帖子（查询最近不活跃的用户）
                    def get_recent_month_post():
                        import datetime
                        current = date.date.today()-datetime.timedelta(days=30)
                        current = str(current)
                        return Post.objects.filter(created__gt=current)


    ----查询十月二十号--十一月二十号的所有的记录
        错误的
                        Post.objects.filter(created__in=(&#39;2017-10-20&#39;,&#39;2017-11-20&#39;))
                        指的是这两个时间中的一个
        正确的（SQL语句）
                        Post.objects.filter(created__range=(&#39;2017-10-20&#39;,&#39;2017-11-20&#39;))
                        Post.objects.filter(created__range=(147,149))    或者 BETWEEN 147 AND 149
</pre></div>
</div>
</section>
<section id="id12">
<h3><a class="toc-backref" href="#id55">6.4 范围查询</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="n">查询价格大于700的书籍</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__gt</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span> <span class="c1"># gt表示大于</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>

<span class="mf">2.</span><span class="n">查询价格小于700的书籍</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__lt</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span> <span class="c1"># lt表示小于</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
 <span class="n">价格大于等于700</span> <span class="n">小于等于700</span>
    <span class="n">res1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__gte</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
    <span class="n">res2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__lte</span><span class="o">=</span><span class="mi">700</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">query</span><span class="p">,</span><span class="n">res2</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>

<span class="mf">3.</span><span class="n">查询价格要么是666</span><span class="o">.</span><span class="mi">66</span> <span class="n">要么是999</span><span class="o">.</span><span class="mi">66</span> <span class="n">要么是10000</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__in</span><span class="o">=</span><span class="p">[</span><span class="mf">666.66</span><span class="p">,</span><span class="mf">999.66</span><span class="p">,</span><span class="mi">10000</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;python对数字不是很敏感 精确度不高  很多时候我们会采取字符串存储数字类型&quot;&quot;&quot;</span>

<span class="mf">4.</span><span class="n">查询价格在500到800之间的</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__range</span><span class="o">=</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="mi">800</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>

<span class="mf">5.</span><span class="n">查询书名中包含字母s的书</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__contains</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>  <span class="c1"># 区分大小写</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title__icontains</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>  <span class="c1"># 区分大小写</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

<span class="mf">6.</span><span class="n">查询出版日期是2021的书</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">publish_time__year</span><span class="o">=</span><span class="mi">2021</span><span class="p">)</span> <span class="c1"># year代表年</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>

<span class="mf">7.</span><span class="n">查询出版日期是3月的书</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">publish_time__month</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># month代表月</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id13">
<h2><a class="toc-backref" href="#id56">7. 单表增_删 改</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h2>
<section id="id14">
<h3><a class="toc-backref" href="#id57">7.1 增加</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#方法1</span>
                    <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;博客11&#39;</span><span class="p">,</span><span class="n">created</span><span class="o">=</span><span class="s1">&#39;2017-2-20&#39;</span><span class="p">)</span>
                    <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

<span class="c1">#方法2</span>
                    <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;博客12&#39;</span><span class="p">,</span><span class="n">created</span><span class="o">=</span><span class="s1">&#39;2018-11-11&#39;</span><span class="p">)</span>      <span class="c1">#返回值是添加的对象</span>
</pre></div>
</div>
</section>
<section id="id15">
<h3><a class="toc-backref" href="#id58">7.2 删除</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#方法1
                m = Movie.objects.filters(mname__startswith=&#39;h&#39;)
                m.delete()

                # BINARY不是函数，是类型转换运算符，比较时，区分大小写
                DELETE FROM &#39;movie&#39; WHERE &#39;movie&#39;, &#39;mname&#39; LIKE BINARY ‘h%’


#方法2（删除所有包含博客名字的帖子）
                Post.objects.filter(tiltle__contains=&#39;博客&#39;).delete()
</pre></div>
</div>
</section>
<section id="id16">
<h3><a class="toc-backref" href="#id59">7.3 修改</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#方法1 （更新的是所有的字段）</span>
            <span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
            <span class="n">post</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;更新了&#39;</span>
            <span class="n">post</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

       <span class="n">UPDATE</span> <span class="s1">&#39;post_post&#39;</span> <span class="n">SET</span> <span class="s1">&#39;title&#39;</span> <span class="o">=</span> <span class="s1">&#39;更新了&#39;</span><span class="p">,</span><span class="s1">&#39;created&#39;</span> <span class="o">=</span> <span class="s1">&#39;2017-11-27&#39;</span> <span class="n">WHERE</span> <span class="s1">&#39;post_post&#39;</span> <span class="p">,</span><span class="s1">&#39;id&#39;</span> <span class="o">=</span> <span class="mi">26</span>

<span class="c1">#方法2（只更新修改的字段），推荐使用</span>
            <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">26</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;又更新了&#39;</span><span class="p">)</span>
            <span class="n">UPDATE</span> <span class="s1">&#39;post_post&#39;</span> <span class="n">SET</span> <span class="s1">&#39;title&#39;</span> <span class="o">=</span> <span class="s1">&#39;又更新了&#39;</span> <span class="n">WHERE</span> <span class="s1">&#39;post_post&#39;</span><span class="o">.</span><span class="s1">&#39;id&#39;</span> <span class="o">=</span> <span class="mi">26</span>
</pre></div>
</div>
<p>总结</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 准备书籍表</span>
<span class="c1"># models.py</span>
<span class="k">class</span> <span class="nc">Books</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;书名&#39;</span><span class="p">,</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;价格&#39;</span><span class="p">,</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">publish_time</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">verbose_name</span><span class="o">=</span><span class="s1">&#39;日期&#39;</span><span class="p">,</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

     <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># 改变对象的字符串显示,打印对象自动触发</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>  <span class="c1"># 返回值</span>




 <span class="c1"># 增加</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;人性的弱点&#39;</span><span class="p">,</span><span class="n">price</span><span class="o">=</span><span class="mf">687.90</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>   <span class="c1"># 人性的弱点</span>
    <span class="sd">&#39;&#39;&#39;create返回值就是当前被创建的数据对象&#39;&#39;&#39;</span>
<span class="c1"># 查询</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">)</span> <span class="c1"># query查看当前orm内部对应的原生sql语句</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;jason&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;filter括号内可以放多个参数 默认是and关系  推荐使用  条件不符合不会报错&quot;&quot;&quot;</span>

    <span class="n">res1</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;jason&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res1</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;get括号内可以放多个参数 默认是and关系  不推荐使用  条件不符合直接报错&quot;&quot;&quot;</span>
<span class="c1"># 修改</span>
    <span class="c1"># 方式一：（推荐）</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="mf">666.66</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># 返回值是受影响的行数</span>
    <span class="c1"># 方式二：（少用）</span>
    <span class="n">book_obj</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">book_obj</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="mf">999.66</span>
    <span class="n">book_obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># 效率低(所有字段重新写一遍)</span>
    <span class="sd">&quot;&quot;&quot;pk能够自动查找到当前表的主键字段 我们不需要查看当前表主键字段名&quot;&quot;&quot;</span>
<span class="c1"># 删</span>
    <span class="n">models</span><span class="o">.</span><span class="n">Books</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>更多内容参考文献：</p>
<p><a class="reference external" href="https://www.cnblogs.com/gengfenglog/p/14568158.html">https://www.cnblogs.com/gengfenglog/p/14568158.html</a></p>
</section>
</section>
<section id="id17">
<h2><a class="toc-backref" href="#id60">8. 创建单表</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h2>
<section id="id18">
<h3><a class="toc-backref" href="#id61">8.1 常用字段类型</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>—&gt;  django所有的数据模型都继承自model.Model
—&gt;  CharField max_length (输入框)
—&gt;  TextField 没有长度限制的字符串（文本域）
—&gt;  DateField 日期
—&gt;  DateTimeField 日期+时间
—&gt;  BooleanField 真假
—&gt;  NullBooleanField ，Null 真假
—&gt;  Integer 整数
—&gt;  PositiveIntegerField 正整数
—&gt;  DecimalField max_digits(几位数) decimal_place (小数点后保留几位)
—&gt;  ImageField 图片 依赖于Pillow（处理图片）upload_to=&#39;upload&#39;指定文件上传到目录
—&gt;  FileField（ImageField继承FileField）
—&gt;  AutoField
—&gt;  OneToOneField 1:1  一对一 学生和学生证  CASCADE 级联删除
—&gt;  ForeignKey 1:n 一对多 班级和学生
—&gt;  ManyToManyField n:n 多对多 学生和课程
—&gt;  EmailField 邮箱     #字符串@域名.comn
—&gt;  UUIDField 重复的概率非常低基本可以忽略，全世界都不一样的标示，uuid的产生和服务器的环境有关（CPU，网关）唯一的标示，用户模块，订单号    #唯一标识符
—&gt;  不同的字段在后台对应不同的html的组件
—&gt;  ImageField 依赖于Pillow组件（python库）
</pre></div>
</div>
</section>
<section id="id19">
<h3><a class="toc-backref" href="#id62">8.2 常用属性</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>—&gt;  unique 标示这个字段唯一
—&gt;  default 默认的意思，（如果不写的话就使用默认的值）
—&gt;  null=True 允许字段为null，（允许数据库为null）数据库层面的
—&gt;  blank=True 表单阶段的，admin后台的 可以为空
—&gt;  auto_now 针对时间段，自动调整单签，（当修改目的时候，这个时间会更新），每次修改都会更新（修改，保存的时候才会生效）
—&gt;  auto_now_add 针对时间的，只添加一次，（创建的时间）
</pre></div>
</div>
</section>
<section id="id20">
<h3><a class="toc-backref" href="#id63">8.3 重点理解属性</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    —&gt; 表单层面的东西（js判断字段是否是“”），不需要重写迁移数据库
—&gt; unique = True 可以任何字段
—&gt; default 数据库+表单层面（同时生效）
—&gt; auto_now_add 创建的时候回自动的添加时间（数据库）（后台表单层面找不到这个字段）
</pre></div>
</div>
</section>
<section id="onetoonefield">
<h3><a class="toc-backref" href="#id64">8.4 使用OneToOneField(一对一)</a><a class="headerlink" href="#onetoonefield" title="Permalink to this headline">¶</a></h3>
<p>例：员工基本信息类-员工详细信息类 员工工号</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>models.OneToOneField(to=&#39;UserInfo&#39;,on_delete=models.CASCADE)： 将字段定义在任意一端。
</pre></div>
</div>
<p>字段参数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>to：设置要关联的表。

to_field：设置要关联的字段。

on_delete：当删除关联表中的数据时，当前表与其关联的行的行为。
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># -*- codeing = utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="c1"># 学生和学生证的关系</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># 学号</span>
    <span class="n">sno</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># 学生姓名</span>
    <span class="n">sname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;t_student&#39;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;Student:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">sname</span>

<span class="k">class</span> <span class="nc">Scard</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># 学号</span>
    <span class="n">student</span> <span class="o">=</span> <span class="n">mdoels</span><span class="o">.</span><span class="n">OneToOneField</span><span class="p">(</span><span class="n">Student</span><span class="p">,</span><span class="n">Primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>
    <span class="n">department</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">major</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">enterdate</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;t_scard&#39;</span>
</pre></div>
</div>
<p><strong>查询过程</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stu.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">student</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">sname</span><span class="o">=</span><span class="s1">&#39;hujianli&#39;</span><span class="p">)</span>
<span class="n">Scard</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">student</span><span class="o">=</span><span class="n">student</span><span class="p">,</span><span class="n">major</span><span class="o">=</span><span class="s1">&#39;计算机&#39;</span><span class="p">)</span>

<span class="c1"># &lt;Scard:[Bad Unicode data]&gt;</span>
<span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">scard</span>   <span class="c1"># 正向查询</span>
<span class="c1"># &lt;Scard: Scaed:计算机&gt;</span>

<span class="c1"># Scard.objects.first().student</span>
<span class="o">&lt;</span><span class="n">Student</span><span class="p">:</span> <span class="n">Student</span><span class="p">:</span><span class="n">hujianli1</span><span class="o">&gt;</span>
</pre></div>
</div>
</section>
<section id="foreignkey">
<h3><a class="toc-backref" href="#id65">8.5 使用ForeignKey(一对多）</a><a class="headerlink" href="#foreignkey" title="Permalink to this headline">¶</a></h3>
<p>例：图书类-英雄类</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>models.ForeignKey(to=UserProfile, on_delete=models.CASCADE) ：将字段定义在多的一端。
</pre></div>
</div>
<p>字段参数：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>to：设置要关联的表

to_field：设置要关联的表的字段
related_query_name:反向查询操作时，使用的连接前缀，用于替换表名。
on_delete：当删除关联表中的数据时，当前表与其关联的行的行为。

　　 models.CASCADE
　　　　　　　　删除关联数据，与之关联也删除
　   models.DO_NOTHING
　　　　　　　　删除关联数据，引发错误IntegrityError
　 　models.PROTECT
　　　　　　　　删除关联数据，引发错误ProtectedError
　　 models.SET_NULL
　　　　　　　　删除关联数据，与之关联的值设置为null（前提FK字段需要设置为可空）
　 　models.SET_DEFAULT
　　　　　　　　删除关联数据，与之关联的值设置为默认值（前提FK字段需要设置默认值）
　　 models.SET
　　　　　　　　删除关联数据，
                    a. 与之关联的值设置为指定值，设置：models.SET(值)
                    b. 与之关联的值设置为可执行对象的返回值，设置：models.SET(可执行对象)

db_constraint： 是否在数据库中创建外键约束，默认为True，可以设置为False。
　　　True：建立外键，默认是True
　　　False：不建立外键
　　　好处：不会出现脏数据
　　　坏处：插入的时候，效率低
　　　企业中：通常不建立，程序员控制
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Clazz</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">cno</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>


<span class="c1"># 学生表（从表 多）</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">sno</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">cno</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Clazz</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;Student:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sname</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stu.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="bp">cls</span> <span class="o">=</span> <span class="n">Clazz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;B201Python&#39;</span><span class="p">)</span>
<span class="n">cls1</span> <span class="o">=</span> <span class="n">Clazz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">cname</span><span class="o">=</span><span class="s1">&#39;B202Java&#39;</span><span class="p">)</span>

<span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">sname</span><span class="o">=</span><span class="s1">&#39;zhangsan&#39;</span><span class="p">,</span><span class="n">cno</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>
<span class="c1"># &lt;Student: Student:zhangsan&gt;</span>

<span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">sname</span><span class="o">=</span><span class="s1">&#39;lisi&#39;</span><span class="p">,</span><span class="n">cno</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>
<span class="c1"># &lt;Student: Student:lisi&gt;</span>

<span class="n">Clazz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">student_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>    <span class="c1"># 正向查询</span>
<span class="c1"># &lt;QuerySet [&lt;Student: Student:zhangsan&gt;, &lt;Student: Student:lisi&gt;]&gt;</span>

<span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">cno</span>                <span class="c1"># 反向查询</span>
<span class="c1"># &lt;Clazz: Clazz object (1)&gt;</span>

<span class="o">----------------------------------------------------------------------------</span>
<span class="kn">from</span> <span class="nn">stu.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">Clazz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">sts</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>   <span class="c1"># related_name=&#39;sts&#39;修改了 student_set.all()</span>
<span class="c1"># &lt;QuerySet [&lt;Student: Student:zhangsan&gt;, &lt;Student: Student:lisi&gt;]&gt;</span>
</pre></div>
</div>
<p><strong>函数封装，打包输入，-&gt;&gt;&gt;多表的插入</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding:utf8 -*-</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># 加载配置文件，跑django的项目，最开始就是把配置文件加载上</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;djangoStu.settings&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">django</span>  <span class="c1"># 安装了django模块，就可以import</span>

    <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>  <span class="c1"># 使用环境变量中的配置文件，跑django</span>

    <span class="kn">from</span> <span class="nn">stu1.models</span> <span class="kn">import</span> <span class="n">Clazz</span><span class="p">,</span> <span class="n">Student</span>  <span class="c1"># 单独测试django py文件</span>


    <span class="k">def</span> <span class="nf">insertData</span><span class="p">(</span><span class="n">clsname</span><span class="p">,</span> <span class="o">*</span><span class="n">snames</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">Clazz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cname</span><span class="o">=</span><span class="n">clsname</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Clazz</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="n">Clazz</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">cname</span><span class="o">=</span><span class="n">clsname</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sn</span> <span class="ow">in</span> <span class="n">snames</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">stu</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">sname</span><span class="o">=</span><span class="n">sn</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Student</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
                <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">sname</span><span class="o">=</span><span class="n">sn</span><span class="p">,</span> <span class="n">cno</span><span class="o">=</span><span class="bp">cls</span><span class="p">)</span>


    <span class="n">insertData</span><span class="p">(</span><span class="s1">&#39;B203HTML5班&#39;</span><span class="p">,</span> <span class="s1">&#39;zhangjie&#39;</span><span class="p">,</span> <span class="s1">&#39;xiena&#39;</span><span class="p">)</span>
</pre></div>
</div>
<section id="id21">
<h4>附录：调用Django环境<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<p>Python脚本中调用Django环境</p>
<p><strong>方式1</strong></p>
<p>任意创建一个py文件，eg:until.py 在该文件内书写固定的配置</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># 加载配置文件，跑django的项目，最开始就是把配置文件加载上</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="p">,</span> <span class="s2">&quot;djangoStu.settings&quot;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">django</span>  <span class="c1"># 安装了django模块，就可以import</span>

    <span class="n">django</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>  <span class="c1"># 使用环境变量中的配置文件，跑django</span>

    <span class="kn">from</span> <span class="nn">stu1.models</span> <span class="kn">import</span> <span class="n">Clazz</span><span class="p">,</span> <span class="n">Student</span>  <span class="c1"># 单独测试django py文件</span>
</pre></div>
</div>
<p><strong>方式2</strong></p>
<p>直接使用pycharm提供的python console</p>
</section>
</section>
<section id="manytomanyfield">
<h3><a class="toc-backref" href="#id66">8.6 使用ManyToManyField(多对多)</a><a class="headerlink" href="#manytomanyfield" title="Permalink to this headline">¶</a></h3>
<p>例：新闻类-新闻类型类 体育新闻 国际新闻</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>models.ManyToManyField(to=&#39;UserInfo&#39;,on_delete=models.CASCADE) ：将字段定义在任意一端。
</pre></div>
</div>
<p>用于表示多对多的关联关系。在数据库中通过第三张表来建立关联关系</p>
<p>字段参数</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>to：设置要关联的表

to_field：设置要关联的表的字段

related_query_name：反向查询操作时，使用的连接前缀，用于替换表名。同ForeignKey字段。

symmetrical：仅用于多对多自关联时，指定内部是否创建反向操作的字段。默认为True。

through:：设置关联的字段。手动创建第三张表，指定通过哪个表

through_fields：设置关联的字段。关联字段是什么

db_table：默认创建第三张表时，数据库中表的名
</pre></div>
</div>
<p><strong>多对多关系建立的三种方式</strong></p>
<p>第一种：自动创建（常用：第三张表没有其他字段）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;书名&quot;</span><span class="p">)</span>


<span class="c1"># 通过ORM自带的ManyToManyField自动创建第三张表</span>
<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;作者姓名&quot;</span><span class="p">)</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s2">&quot;Book&quot;</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s2">&quot;authors&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>第二种：手动创建第三张表（比较常用：第三张表有多余字段）</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Book1</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;书名&quot;</span><span class="p">)</span>


<span class="c1"># 自己创建第三张表，并通过ManyToManyField指定关联</span>
<span class="k">class</span> <span class="nc">Author1</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;作者姓名&quot;</span><span class="p">)</span>
    <span class="n">books</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s2">&quot;Book1&quot;</span><span class="p">,</span> <span class="n">through</span><span class="o">=</span><span class="s2">&quot;Author2Book&quot;</span><span class="p">,</span> <span class="n">through_fields</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="s2">&quot;book&quot;</span><span class="p">))</span>
    <span class="c1"># through_fields 元组的第一个值是ManyToManyField所在的表去中间表通过那个字段，就写在第一个位置</span>


<span class="k">class</span> <span class="nc">Author2Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s2">&quot;Author1&quot;</span><span class="p">)</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s2">&quot;Book1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>第三种：完全手动写第三张表</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Book1</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;书名&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Author1</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">verbose_name</span><span class="o">=</span><span class="s2">&quot;作者姓名&quot;</span><span class="p">)</span>


<span class="c1"># 自己创建第三张表，分别通过外键关联书和作者</span>
<span class="k">class</span> <span class="nc">Author2Book1</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s2">&quot;Author&quot;</span><span class="p">)</span>
    <span class="n">book</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">to</span><span class="o">=</span><span class="s2">&quot;Book&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Meta 元信息</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>db_table：ORM在数据库中的表名默认是 app_类名，可以通过db_table可以重写表名。
index_together：联合索引。
unique_together：联合唯一索引。
ordering：指定默认按什么字段排序。
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 在每一个模型类中都可以写</span>
<span class="k">class</span> <span class="nc">Publish</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span> <span class="c1">#元信息</span>
        <span class="n">db_table</span><span class="o">=</span><span class="s1">&#39;lqz_publish&#39;</span>  <span class="c1"># 表名</span>
        <span class="n">index_together</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;addr&#39;</span><span class="p">)</span>  <span class="c1"># 多个字段联合索引</span>
        <span class="n">unique_together</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;addr&#39;</span><span class="p">)</span> <span class="c1"># 联合唯一</span>
        <span class="n">ordering</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">)</span> <span class="c1"># 默认以哪个字段排序</span>
</pre></div>
</div>
<p>多对多关系示例</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>


<span class="c1"># Create your models here.</span>
<span class="c1"># 课程表 和 教师表 n:n</span>
<span class="k">class</span> <span class="nc">Course</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">course_id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">course_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;t_course&#39;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;course_id&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;Course:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">course_name</span>


<span class="k">class</span> <span class="nc">Teacher</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">tid</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">course</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Course</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;sts&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">db_table</span> <span class="o">=</span> <span class="s1">&#39;t_teacher&#39;</span>
        <span class="n">ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tid&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;Teacher:</span><span class="si">%s</span><span class="s1">--</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">course</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>向表中插入内容</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">stu.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">cour1</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">course_name</span><span class="o">=</span><span class="s1">&#39;Python&#39;</span><span class="p">)</span>
<span class="n">cour2</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">course_name</span><span class="o">=</span><span class="s1">&#39;Java&#39;</span><span class="p">)</span>
<span class="n">cour3</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">course_name</span><span class="o">=</span><span class="s1">&#39;HTML5&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tname</span><span class="o">=</span><span class="s1">&#39;zhangsan&#39;</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tname</span><span class="o">=</span><span class="s1">&#39;lisi&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">course</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cour1</span><span class="p">,</span><span class="n">cour2</span><span class="p">,</span><span class="n">cour3</span><span class="p">)</span>

<span class="n">Course</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">sts</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>        <span class="c1"># 正向查询# related_name=&#39;sts&#39;修改名字_set</span>
<span class="c1">#&lt;QuerySet [&lt;Teacher: Teacher:zhangsan--stu2.Course.None&gt;]&gt;</span>

<span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">course</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>        <span class="c1"># 逆向查询</span>
<span class="c1">#&lt;QuerySet [&lt;Course: Course:Python&gt;, &lt;Course: Course:Java&gt;, &lt;Course: Course:HTML5&gt;]&gt;</span>
</pre></div>
</div>
<p><strong>函数封装，打包输入，-&gt;&gt;&gt;多表的插入</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">insertData</span><span class="p">(</span><span class="n">tname</span><span class="p">,</span> <span class="o">*</span><span class="n">coursenames</span><span class="p">):</span>
     <span class="k">try</span><span class="p">:</span>
         <span class="n">t</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tname</span><span class="o">=</span><span class="n">tname</span><span class="p">)</span>
     <span class="k">except</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
         <span class="n">t</span> <span class="o">=</span> <span class="n">Teacher</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">tname</span><span class="o">=</span><span class="n">tname</span><span class="p">)</span>
     <span class="n">courseList</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="k">for</span> <span class="n">cn</span> <span class="ow">in</span> <span class="n">coursenames</span><span class="p">:</span>
         <span class="k">try</span><span class="p">:</span>
             <span class="n">cou</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">course_name</span><span class="o">=</span><span class="n">cn</span><span class="p">)</span>
         <span class="k">except</span> <span class="n">Course</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
             <span class="n">cou</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">course_name</span><span class="o">=</span><span class="n">cn</span><span class="p">)</span>
         <span class="n">courseList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cou</span><span class="p">)</span>
     <span class="n">t</span><span class="o">.</span><span class="n">course</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="n">courseList</span><span class="p">)</span>

    <span class="n">insertData</span><span class="p">(</span><span class="s2">&quot;hujianli&quot;</span><span class="p">,</span><span class="s2">&quot;Python&quot;</span><span class="p">,</span><span class="s2">&quot;Java&quot;</span><span class="p">,</span><span class="s2">&quot;HTML5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="url">
<h2><a class="toc-backref" href="#id67">9. 配置URL</a><a class="headerlink" href="#url" title="Permalink to this headline">¶</a></h2>
<section id="id22">
<h3><a class="toc-backref" href="#id68">9.1 URL传参</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p><strong>1. 位置传参 (:raw-latex:`d{占用位数}`)</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^query1/(\d</span><span class="si">{4}</span><span class="s1">)/(\d</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">query1_view</span><span class="p">),</span>  <span class="c1"># 2.位置传参 (\d{占用位数})</span>
<span class="p">]</span>


<span class="c1"># views.py</span>
<span class="k">def</span> <span class="nf">query1_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello1_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span>
</pre></div>
</div>
<p><strong>2.关键字传参</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^query2/(?P&lt;year&gt;[0-9]</span><span class="si">{4}</span><span class="s1">)/(?P&lt;month&gt;[0-9]</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">query2_view</span><span class="p">),</span>  <span class="c1"># 3.关键字传参</span>
<span class="p">]</span>


<span class="c1"># views.py</span>
<span class="k">def</span> <span class="nf">query2_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello2_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">))</span>  <span class="c1"># 关键字定位</span>
</pre></div>
</div>
<p><strong>3.加载其他映射</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^query3/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;aggregator.urls&#39;</span><span class="p">)),</span>
</pre></div>
</div>
<p><strong>4.传参（参数名必须保持一致）</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^query3/(?P&lt;year&gt;[0-9]</span><span class="si">{4}</span><span class="s1">)/(?P&lt;month&gt;[0-9]</span><span class="si">{2}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">query3_view</span><span class="p">,{</span><span class="s1">&#39;uname&#39;</span><span class="p">:</span><span class="s1">&#39;zhangsan&#39;</span><span class="p">}),</span> <span class="c1"># 传参（参数名必须保持一致）</span>
<span class="p">]</span>


<span class="c1"># views.py</span>
<span class="k">def</span> <span class="nf">query3_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">uname</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello3_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">uname</span><span class="p">))</span>
</pre></div>
</div>
</section>
</section>
<section id="httprequesthttpresponse">
<h2><a class="toc-backref" href="#id69">10. HttpRequest和HttpResponse</a><a class="headerlink" href="#httprequesthttpresponse" title="Permalink to this headline">¶</a></h2>
<section id="httprequest">
<h3><a class="toc-backref" href="#id70">10.1 HttpRequest请求对象（只读）</a><a class="headerlink" href="#httprequest" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>当用户访问一个试图函数时，Django会创建一个request对象（HttpRequest）</p></li>
<li><p>HttpRequest对象中封装了所有的Http协议中的请求信息</p></li>
</ul>
</section>
<section id="id23">
<h3><a class="toc-backref" href="#id71">10.2 常见的属性和方法</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>HttpRequest.scheme  :返回协议类型（http/https）
HttpRequest.body    :返回请求实体内容
HttpRequest.path    :返回请求地址
HttpRequest.method  :返回当前请求方式（GET/POST）
HttpRequest.GET     :返回当前请求参数的字典QueryDict
HttpRequest.POST    :返回当前请求参数的字典QueryDict
HttpRequest.COOKIES :返回客户端所有的cookie信息

HttpRequest.FILES   :获取上传文件
（1.要求POST请求2.enctype=&quot;multipart/form-data&quot;）

HttpRequest.META    :返回请求报文信息


HttpRequest.get_host()     :返回请求主机名和端口号
HttpRequest.get_full_path():返回请求地址（包括请求参数）
</pre></div>
</div>
</section>
<section id="httpresponse">
<h3><a class="toc-backref" href="#id72">10.3 HttpResponse 响应对象</a><a class="headerlink" href="#httpresponse" title="Permalink to this headline">¶</a></h3>
<p><strong>1.用法</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 响应内容</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Here&#39;s the text of the Web page.&quot;</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Text only, please.&quot;</span> <span class="n">content_type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
<span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;Here&#39;s the text of the Web page.&lt;/p&gt;&quot;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;Here&#39;s another paragraph.&lt;/p&gt;&quot;</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">my_data</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="s1">&#39;application/vnd.ms-excel&#39;</span><span class="p">)</span>
<span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=&quot;foo.xls&quot;&#39;</span>

<span class="c1"># 设置响应头信息</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">,</span><span class="s1">&#39;WBS&#39;</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
<span class="n">response</span><span class="p">[</span><span class="s1">&#39;uname&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;zhangsan&#39;</span>

<span class="n">response</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;Server&#39;</span><span class="p">,</span><span class="s1">&#39;WBS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id24">
<h2><a class="toc-backref" href="#id73">11. 文件</a><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h2>
<section id="id25">
<h3><a class="toc-backref" href="#id74">11.1 文件上传</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p><strong>模板</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;form action=&quot;/student/&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
        {% csrf_token %}
        &lt;p&gt;
            &lt;label for=&quot;ua&quot;&gt;姓名：&lt;/label&gt;&lt;input type=&quot;text&quot; name=&quot;uname&quot; id=&quot;ua&quot;/&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &lt;label for=&quot;ph&quot;&gt;头像：&lt;/label&gt;&lt;input type=&quot;file&quot; name=&quot;photo&quot; id=&quot;ph&quot;/&gt;
        &lt;/p&gt;
        &lt;p&gt;
            &amp;emsp;&amp;emsp;&amp;emsp;&amp;emsp;&lt;input type=&quot;submit&quot; value=&quot;注册&quot;/&gt;
        &lt;/p&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>views.py文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<span class="k">def</span> <span class="nf">index_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="c1"># 获取请求参数</span>
        <span class="n">uname</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;uname&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">photo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">FILES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">os</span>  <span class="c1"># 引入路径包</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;media&#39;</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;media&#39;</span><span class="p">)</span>

        <span class="c1"># mkdir()是创建子目录。mkdirs()是创建多级目录。</span>
        <span class="c1"># os.path.join拼接</span>
        <span class="c1"># os.getcwd()获取根路径</span>
        <span class="c1"># &#39;wb&#39;二进制写入</span>
        <span class="c1"># as fw 命名</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;media&#39;</span><span class="p">,</span> <span class="n">photo</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fw</span><span class="p">:</span>
            <span class="c1"># photo.read() 一次性读取文件</span>
            <span class="c1"># fw.write(photo.read()) 文件读进来写进去</span>
            <span class="c1"># fw.write(photo.read())</span>

            <span class="c1"># photo.chunks() 分块读取</span>
            <span class="k">for</span> <span class="n">ck</span> <span class="ow">in</span> <span class="n">photo</span><span class="o">.</span><span class="n">chunks</span><span class="p">():</span>
                <span class="n">fw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ck</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">photo</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;上传成功！&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;当前访问量过大，请稍后再试！&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id26">
<h3><a class="toc-backref" href="#id75">11.2 图片读取</a><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p><strong>1、settings.py 修改</strong></p>
<p><strong>写注释 注意加上 # coding=utf-8</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># global_settings</span>

<span class="c1"># 指定上传文件的存储相对路径（读取文件）</span>
<span class="n">MEDIA_URL</span> <span class="o">=</span> <span class="s1">&#39;/media/&#39;</span>

<span class="c1"># 指定传文件存储绝对路径（存储文件）</span>
<span class="n">MEDIA_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;media&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>2、model.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>

<span class="c1"># Create your models here.</span>

<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">sno</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sname</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ImageField</span><span class="p">(</span><span class="n">upload_to</span><span class="o">=</span><span class="s1">&#39;imgs&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;Student: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">sname</span>
</pre></div>
</div>
<p><strong>3、修改admin.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>

<span class="c1"># Register your models here.</span>

<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Student</span><span class="p">)</span>
</pre></div>
</div>
<p>如果要用 <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">src=&quot;{{MEDIA_URL}}{{</span> <span class="pre">stu.photo</span> <span class="pre">}}/&quot;}</span></code></p>
<p><strong>1、修改根路由</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">include</span>
<span class="kn">from</span> <span class="nn">.settings</span> <span class="kn">import</span> <span class="n">DEBUG</span><span class="p">,</span> <span class="n">MEDIA_ROOT</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;student/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;stu.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>
<span class="c1"># 加上这个 注意python3 用append python2 用+=</span>
<span class="kn">from</span> <span class="nn">django.views.static</span> <span class="kn">import</span> <span class="n">serve</span>
<span class="k">if</span> <span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">urlpatterns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^media/(?P&lt;path&gt;.*)/$&#39;</span><span class="p">,</span> <span class="n">serve</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;document_root&#39;</span><span class="p">:</span> <span class="n">MEDIA_ROOT</span><span class="p">}))</span>
</pre></div>
</div>
<p><strong>2、设置settings.py也要修改加上
‘django.template.context_processors.media’</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">TEMPLATES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s1">&#39;BACKEND&#39;</span><span class="p">:</span> <span class="s1">&#39;django.template.backends.django.DjangoTemplates&#39;</span><span class="p">,</span>
        <span class="s1">&#39;DIRS&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;templates&#39;</span><span class="p">)]</span>
        <span class="p">,</span>
        <span class="s1">&#39;APP_DIRS&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;context_processors&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;django.template.context_processors.debug&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.template.context_processors.request&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.auth.context_processors.auth&#39;</span><span class="p">,</span>
                <span class="s1">&#39;django.contrib.messages.context_processors.messages&#39;</span><span class="p">,</span>
                <span class="c1"># &#39;django.template.context_processors.media&#39;</span>
            <span class="p">],</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>3、模板修改</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;500px&quot;</span> <span class="na">border</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="na">cellspacing</span><span class="o">=</span><span class="s">&quot;0&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>编号<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>姓名<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>头像<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>操作<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% for stu in stus %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ forloop.counter }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ stu.sname }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 200px;&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/{{ stu.photo }}/&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
{# 注意这个需要修改上边的根路由 <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 200px;&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{MEDIA_URL}}{{ stu.photo }}/&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>#}
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>下载<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
</section>
<section id="id27">
<h3><a class="toc-backref" href="#id76">11.3 文件下载</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p><strong>1、urls.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;download/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">download_view</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>2、views.py</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">download_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># 获取请求参数（图片的存储位置）</span>
    <span class="n">photo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">GET</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;photo&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># 获取图片文件名</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">photo</span><span class="p">[</span><span class="n">photo</span><span class="o">.</span><span class="n">rindex</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># 开启一个流 rb 读</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;media&#39;</span><span class="p">,</span> <span class="n">photo</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fr</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">fr</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;image/jpg&#39;</span>
        <span class="c1"># 预览模式</span>
        <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;inline; filename=&#39;</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="c1"># 附件模式</span>
        <span class="c1"># response[&#39;Content-Disposition&#39;] = &#39;attachment; filename=&#39; + filename</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p><strong>3、html文件</strong></p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% for stu in stus %}
            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ forloop.counter }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ stu.sname }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
{#                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 200px;&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/media/{{ stu.photo }}/&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>#}
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">img</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;width: 200px;&quot;</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{MEDIA_URL}}{{ stu.photo }}/&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/student/download/?photo={{ stu.photo }}&quot;</span><span class="p">&gt;</span>下载<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        {% endfor %}
</pre></div>
</div>
</section>
</section>
<section id="id28">
<h2><a class="toc-backref" href="#id77">12. 重定向</a><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h2>
<section id="httpresponseredirect">
<h3><a class="toc-backref" href="#id78">12.1 HttpResponseRedirect</a><a class="headerlink" href="#httpresponseredirect" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>302重定向</p></li>
</ul>
</section>
<section id="redirect">
<h3><a class="toc-backref" href="#id79">12.2 redirect</a><a class="headerlink" href="#redirect" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>301重定向</p></li>
<li><p>默认302请求可以改为301</p></li>
<li><p>redirect(’ ’)</p></li>
</ul>
<p>301: 永久性重定向 302: 临时性重定向</p>
</section>
<section id="url-1">
<span id="id29"></span><h3><a class="toc-backref" href="#id80">12.3 配置URL</a><a class="headerlink" href="#url-1" title="Permalink to this headline">¶</a></h3>
</section>
<section id="id30">
<h3><a class="toc-backref" href="#id81">12.4 配置视图</a><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># coding=utf-8</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponseRedirect</span><span class="p">,</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>


<span class="k">def</span> <span class="nf">index_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>

    <span class="c1"># 方式1:302</span>
    <span class="c1"># return HttpResponseRedirect(&#39;/student/showall/&#39;)  # 状态码302</span>

    <span class="c1"># 方式2：默认302可以转换成301</span>
    <span class="c1"># return redirect(&#39;/student/showall/&#39;, permanent=True)  # 301: 永久性重定向</span>
    <span class="c1"># return redirect(&#39;/student/showall/&#39;)   # 302: 临时性重定向</span>

    <span class="c1"># 方式3：</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="mi">302</span>
        <span class="n">response</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;/student/showall/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

<span class="k">def</span> <span class="nf">showall_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="id31">
<h2><a class="toc-backref" href="#id82">总结</a><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h2>
<p>参考文献：</p>
<blockquote>
<div><p><a class="reference external" href="https://www.cnblogs.com/Slience-me/p/14456769.html#4-%E4%BD%BF%E7%94%A8onetoonefield">https://www.cnblogs.com/Slience-me/p/14456769.html#4-%E4%BD%BF%E7%94%A8onetoonefield</a></p>
<p><a class="reference external" href="https://www.liujiangblog.com/course/django/">https://www.liujiangblog.com/course/django/</a></p>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="21.drf-%E8%A7%86%E5%9B%BE.html" class="btn btn-neutral float-left" title="23.4.21. drf视图" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="30.%E9%99%84%E5%BD%951.Django%E9%A1%B9%E7%9B%AE%E7%9A%84%E9%83%A8%E7%BD%B2.html" class="btn btn-neutral float-right" title="23.4.23. 附录1.Django项目的部署" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>