<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>19. 前端页面开发 &mdash; 运维开发修炼之路</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="20. 主要页面的开发" href="20.%E4%B8%BB%E8%A6%81%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%BC%80%E5%8F%91.html" />
    <link rel="prev" title="18. 小结" href="18.%E5%B0%8F%E7%BB%93.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> 小健_Python_go_Devops
            <img src="../_static/python_go.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                2.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Go/index.html">Go语言学习</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Go_vs_Python/index.html">Go vs Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Python/index.html">Python全栈系列</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Python%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91%E5%85%A5%E9%97%A8%E4%B8%8E%E5%AE%9E%E8%B7%B5/index.html">Python测试开发入门与实践</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Vue/index.html">Vue.js企业开发实战</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Vue.js+Node.js开发实战</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01.%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E7%BD%91%E7%AB%99%E7%9A%84%E5%87%86%E5%A4%87.html">1. 开发一个网站的准备</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.Nodejs_vue%E5%9F%BA%E7%A1%80.html">2. Nodejs+vue基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="03.%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87.html">3. 项目开发准备</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.%E9%A1%B9%E7%9B%AE%E5%90%8E%E5%8F%B0%E6%8A%80%E6%9C%AFExpress.html">4. 项目后台技术Express</a></li>
<li class="toctree-l2"><a class="reference internal" href="05.Vue.js%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80.html">5. Vue.js开发基础</a></li>
<li class="toctree-l2"><a class="reference internal" href="06.Vue.js%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html">6. Vue的生命周期</a></li>
<li class="toctree-l2"><a class="reference internal" href="07.Vue.js%E7%9A%84%E6%A8%A1%E6%9D%BF%E8%AF%AD%E6%B3%95.html">7. Vue.js的模板语法</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.Vue.js%E7%9A%84%E7%BB%84%E4%BB%B6%E5%8C%96.html">8. Vue.js的组件化</a></li>
<li class="toctree-l2"><a class="reference internal" href="09.Vue.js%E7%9A%84vue-router%E5%BA%93.html">9. Vue.js的vue-router库</a></li>
<li class="toctree-l2"><a class="reference internal" href="10.Vue.js%E7%9A%84%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E5%BA%93Vuex%E5%92%8CPinia.html">10. Vue.js的状态管理库Vuex和Pinia</a></li>
<li class="toctree-l2"><a class="reference internal" href="11.Vue-UI%E5%BA%93.html">11. Vue-UI库</a></li>
<li class="toctree-l2"><a class="reference internal" href="12.%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E5%92%8C%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E.html">12. 项目需求分析和功能说明</a></li>
<li class="toctree-l2"><a class="reference internal" href="13.%E9%A1%B9%E7%9B%AE%E7%AD%96%E5%88%92%E5%92%8C%E5%8A%9F%E8%83%BD%E8%AE%BE%E8%AE%A1.html">13. 项目策划和功能设计</a></li>
<li class="toctree-l2"><a class="reference internal" href="14.%E9%A1%B9%E7%9B%AE%E5%90%8E%E7%AB%AFAPI%E5%BC%80%E5%8F%91.html">14. 项目后端API开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="15.%E9%80%9A%E7%94%A8API%E5%BC%80%E5%8F%91.html">15. 通用API开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="16.%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3API%E5%BC%80%E5%8F%91.html">16. 用户权限相关API开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="17.%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E7%9B%B8%E5%85%B3API%E5%BC%80%E5%8F%91.html">17. 后台管理相关API开发</a></li>
<li class="toctree-l2"><a class="reference internal" href="18.%E5%B0%8F%E7%BB%93.html">18. 小结</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">19. 前端页面开发</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">19.1. 1.项目前期准备</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id3">19.1.1. 1.1 创建新项目</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#ui">19.2. 2. 选择UI库</a></li>
<li class="toctree-l3"><a class="reference internal" href="#http">19.3. 3. 安装HTTP请求库</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id4">19.3.1. 3.1 跨域问题解决办法</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="20.%E4%B8%BB%E8%A6%81%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%BC%80%E5%8F%91.html">20. 主要页面的开发</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">小健_Python_go_Devops</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Vue.js+Node.js开发实战</a> &raquo;</li>
      <li><span class="section-number">19. </span>前端页面开发</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Vue_Node.js/19.前端页面开发.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id5">前端页面开发</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id6">1.项目前期准备</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id7">1.1 创建新项目</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#ui" id="id8">2. 选择UI库</a></p></li>
<li><p><a class="reference internal" href="#http" id="id9">3. 安装HTTP请求库</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id10">3.1 跨域问题解决办法</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="id1">
<h1><a class="toc-backref" href="#id5"><span class="section-number">19. </span>前端页面开发</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>本章涉及的知识点如下：</p>
<ul class="simple">
<li><p>使用Vue.js开发一个实际项目；</p></li>
<li><p>使用Vue.js与后端接口进行交互，并显示相关数据；</p></li>
<li><p>切分一个项目的页面，主要是组件的划分和复用；-</p></li>
<li><p>保证前后端数据的统一。</p></li>
</ul>
<section id="id2">
<h2><a class="toc-backref" href="#id6"><span class="section-number">19.1. </span>1.项目前期准备</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>本节将会创建一个新的Vue.js项目，完成项目所需全部依赖库的安装，并且为Vue.js项目开发安装一些必备的库和模块，例如，符合风格的UI库，以及项目与后端数据接口进行交互的请求库。</p>
<section id="id3">
<h3><a class="toc-backref" href="#id7"><span class="section-number">19.1.1. </span>1.1 创建新项目</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ vue create app
</pre></div>
</div>
<p>安装多个依赖包，包括Babel、router、Vuex和ESLint</p>
<p>使用如下命令进入项目，并且启动该项目的开发环境。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> app
$ npm run serve
</pre></div>
</div>
<p>编译完成后即可在本机查看，默认地址为http://localhost:8080/。</p>
</section>
</section>
<section id="ui">
<h2><a class="toc-backref" href="#id8"><span class="section-number">19.2. </span>2. 选择UI库</a><a class="headerlink" href="#ui" title="Permalink to this headline">¶</a></h2>
<p>本例选择iView作为UI库。在最新版本中iView已经更名为view-design，使用如下命令安装：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ npm install view-ui-plus --save
</pre></div>
</div>
<p>以上命令自动将iView的所有依赖包下载至本地，并且添加进package.json的依赖配置中。</p>
<p>依赖包除了手动安装外，还可以在vue-cli中安装。无论采用何种安装方式，对于UI库的使用来说没有任何区别。</p>
<p>安装完成的iView不能直接使用，需要在项目中引入，需要在Webpack中指定项目入口进行配置。如果使用vue-cli，则入口文件是main.js。在文件中修改代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="p">{</span> <span class="n">createApp</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;vue&#39;</span>
<span class="kn">import</span> <span class="nn">App</span> <span class="kn">from</span> <span class="s1">&#39;./App.vue&#39;</span>
<span class="kn">import</span> <span class="nn">router</span> <span class="kn">from</span> <span class="s1">&#39;./router&#39;</span>
<span class="kn">import</span> <span class="nn">store</span> <span class="kn">from</span> <span class="s1">&#39;./store&#39;</span>
<span class="kn">import</span> <span class="nn">ViewUIPlus</span> <span class="kn">from</span> <span class="s1">&#39;view-ui-plus&#39;</span>
<span class="kn">import</span> <span class="s1">&#39;view-ui-plus/dist/styles/viewuiplus.css&#39;</span>

<span class="n">const</span> <span class="n">app</span> <span class="o">=</span> <span class="n">createApp</span><span class="p">(</span><span class="n">App</span><span class="p">)</span>

<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
  <span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">router</span><span class="p">)</span>
  <span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">ViewUIPlus</span><span class="p">)</span>
  <span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;#app&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>如果要在项目中使用iView提供的UI组件，则需要修改项目自带的Home.vue文件。代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">template</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;home&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">img</span> <span class="n">alt</span><span class="o">=</span><span class="s2">&quot;Vue logo&quot;</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;../assets/logo.png&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">HelloWorld</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Welcome to Your Vue.js App&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">Space</span> <span class="n">wrap</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">Button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="o">&gt;</span><span class="n">Info</span><span class="o">&lt;/</span><span class="n">Button</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">Button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="o">&gt;</span><span class="n">Success</span><span class="o">&lt;/</span><span class="n">Button</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">Button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;warning&quot;</span><span class="o">&gt;</span><span class="ne">Warning</span><span class="o">&lt;/</span><span class="n">Button</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">Button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="o">&gt;</span><span class="n">Error</span><span class="o">&lt;/</span><span class="n">Button</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">Space</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">template</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>这样就可以在项目的所有页面中使用iView提供的UI组件库了。这种方式采用全局引用，意味着所有iView中的组件无论是否使用均被引入，造成了资源浪费。</p>
<p>为了解决这个问题，iView提供了按需载入功能，借助插件babel-plugin-import实现。首先安装Babel，然后配置.babelrc（或vue-cli自动生成的babel.config.js），代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">npm</span> <span class="n">install</span> <span class="n">babel</span><span class="o">-</span><span class="n">plugin</span><span class="o">-</span><span class="kn">import</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>

<span class="o">//</span> <span class="o">.</span><span class="n">babelrc</span> <span class="ow">or</span> <span class="n">babel</span><span class="o">-</span><span class="n">loader</span>
<span class="p">{</span>
  <span class="s2">&quot;plugins&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s2">&quot;import&quot;</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="s2">&quot;libraryName&quot;</span><span class="p">:</span> <span class="s2">&quot;view-ui-plus&quot;</span><span class="p">,</span>
        <span class="s2">&quot;libraryDirectory&quot;</span><span class="p">:</span> <span class="s2">&quot;src/components&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;view-ui-plus&quot;</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>然后这样按需引入组件，就可以减小体积了：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">按需导入</span>
<span class="kn">import</span> <span class="p">{</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Table</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;view-ui-plus&#39;</span><span class="p">;</span>
<span class="n">app</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s1">&#39;Button&#39;</span><span class="p">,</span> <span class="n">Button</span><span class="p">);</span>
<span class="n">app</span><span class="o">.</span><span class="n">component</span><span class="p">(</span><span class="s1">&#39;Table&#39;</span><span class="p">,</span> <span class="n">Table</span><span class="p">);</span>
</pre></div>
</div>
<p>目前版本的iView，无论是否采用按需引用方式，都需要导入iView.css样式文件。</p>
</section>
<section id="http">
<h2><a class="toc-backref" href="#id9"><span class="section-number">19.3. </span>3. 安装HTTP请求库</a><a class="headerlink" href="#http" title="Permalink to this headline">¶</a></h2>
<p>一个Vue.js项目，除了编辑页面的样式外，使用最多的一个功能就是对后端API的请求。本例使用Axios访问API。Axios是一个强大的HTTP库，用在浏览器或Node.js中。</p>
<p>使用Axios的好处是，开发者不必确定当前的应用环境。也就是说，在第8章中使用Express进行后端开发的场景中，使用Axios请求API也是可以的，并且两者的写法没有任何区别，由Axios自动判断。</p>
<p>不仅如此，Axios还支持Promise
API，并且提供了自动转换JSON数据和XSRF防御的功能。使用如下命令安装Axios：</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ npm install axios - save
</pre></div>
</div>
<p>在请求中有时需要更改请求的头部，如增加Token，或者需要对请求进行统一处理，这就需要封装Axios。</p>
<p>在项目中新建utils文件夹，用来存放一些应用类的JavaScript文件，这里新建api.js文件用来封装Axios。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">get请求</span>
<span class="n">api</span><span class="o">.</span><span class="n">get</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">await</span> <span class="n">apiAxios</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="p">}</span>
<span class="o">//</span> <span class="n">post请求</span>
<span class="n">api</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="k">async</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">await</span> <span class="n">apiAxios</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">module</span><span class="o">.</span><span class="n">exports</span> <span class="o">=</span> <span class="n">api</span>
</pre></div>
</div>
<p>在暴露给外部的两个方法对象中，调用apiAxios()方法制作统一的请求，该方法实例化了Axios进行请求，并且针对不同的请求方法添加参数，如果用户已经登录（会话存储为Token键值），其代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>const axios = require(&#39;axios&#39;)
const baseUrl = &#39;http://localhost:3000/&#39;
const api = {}

const apiAxios = async (method, url, params) =&gt; {
  // 项目既定fapp
  const headers = { fapp: &#39;book&#39;, &#39;Content-Type&#39;: &#39;application/json&#39; }
  // 读取存储在sessionStorage中的token
  if (sessionStorage.getItem(&#39;token&#39;)) {
    headers.token = sessionStorage.getItem(&#39;token&#39;)
  }
  return await new Promise(resolve =&gt; {
    axios({
      // 如果缓存里有token则所有请求都包含其
      headers: headers,
      method: method,
      url: baseUrl + url,
      // 数据内容
      data:
                method === &#39;POST&#39; ? params : null,
      params:
                method === &#39;GET&#39; ? params : null
    }).then((res) =&gt; {
      console.log(res.data)
      resolve(res.data)
    }).catch(e =&gt; {
      console.log(e)
    })
  })
}
</pre></div>
</div>
<p>接下来在main.js文件中引入封装的API请求，并且将其挂载在Vue.js的全局对象中，这样可以在所有的场景中使用。修改后的main.js文件代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>import { createApp } from &#39;vue&#39;
import App from &#39;./App.vue&#39;
import router from &#39;./router&#39;
import store from &#39;./store&#39;
import ViewUIPlus from &#39;view-ui-plus&#39;
import &#39;view-ui-plus/dist/styles/viewuiplus.css&#39;
import api from &#39;./utils/api&#39;

const app = createApp(App)
app.config.globalProperties.$api = api

app.use(store)
  .use(router)
  .use(ViewUIPlus)
  .mount(&#39;#app&#39;)
</pre></div>
</div>
<p>需要注意的是，Axios在Vue.js中运行时采用类似于AJAX的方式请求服务器，如果根域名或端口不同，就会产生跨域问题，浏览器默认会阻止发送此类请求。</p>
<section id="id4">
<h3><a class="toc-backref" href="#id10"><span class="section-number">19.3.1. </span>3.1 跨域问题解决办法</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>此类问题无法避免，一般采用以下3种解决办法：</p>
<ul class="simple">
<li><p>设计反向代理，解决跨域问题；</p></li>
<li><p>使用JSONP，允许用户传递一个callback参数给服务器端；</p></li>
<li><p>在服务器端设置res的头部信息，允许所有请求或部分指定来源（确定的IP或者IP段）的请求。</p></li>
</ul>
<p>本例选择第3种方案，修改server编写的服务器端代码，为其指定一个全局路由中间件，将所有的路由都设置为允许跨域。修改app.js文件代码如下：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">express</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
<span class="n">var</span> <span class="n">path</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="n">var</span> <span class="n">cookieParser</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;cookie-parser&#39;</span><span class="p">);</span>
<span class="n">var</span> <span class="n">logger</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;morgan&#39;</span><span class="p">);</span>
<span class="n">var</span> <span class="p">{</span><span class="n">checkAPP</span><span class="p">,</span> <span class="n">checkUser</span><span class="p">,</span> <span class="n">checkAdmin</span><span class="p">}</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;./util/middleware&#39;</span><span class="p">)</span>

<span class="n">var</span> <span class="n">indexRouter</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;./routes/index&#39;</span><span class="p">);</span>
<span class="n">var</span> <span class="n">usersRouter</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;./routes/users&#39;</span><span class="p">);</span>
<span class="o">//</span><span class="n">增加管理员路由</span>
<span class="n">var</span> <span class="n">adminRouter</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;./routes/admin&#39;</span><span class="p">);</span>

<span class="n">var</span> <span class="n">app</span> <span class="o">=</span> <span class="n">express</span><span class="p">();</span>

<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">logger</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">));</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">json</span><span class="p">());</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">urlencoded</span><span class="p">({</span><span class="n">extended</span><span class="p">:</span> <span class="n">false</span><span class="p">}));</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">cookieParser</span><span class="p">());</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="n">express</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">__dirname</span><span class="p">,</span> <span class="s1">&#39;public&#39;</span><span class="p">)));</span>

<span class="o">//</span><span class="n">设置允许跨域访问该服务</span><span class="o">.</span>
<span class="o">//</span><span class="n">设置跨域访问</span>
<span class="n">app</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">function</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="nb">next</span><span class="p">){</span>
    <span class="n">res</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
    <span class="n">res</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
    <span class="nb">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">checkAPP</span><span class="p">,</span> <span class="n">indexRouter</span><span class="p">);</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;/users&#39;</span><span class="p">,</span> <span class="n">checkAPP</span><span class="p">,</span> <span class="n">usersRouter</span><span class="p">);</span>
<span class="n">app</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">checkAPP</span><span class="p">,</span> <span class="n">checkUser</span><span class="p">,</span> <span class="n">checkAdmin</span><span class="p">],</span> <span class="n">adminRouter</span><span class="p">);</span>
<span class="n">module</span><span class="o">.</span><span class="n">exports</span> <span class="o">=</span> <span class="n">app</span><span class="p">;</span>
</pre></div>
</div>
<p>这样跨域请求就不会产生错误了，也可以成功获取需要的数据。</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="18.%E5%B0%8F%E7%BB%93.html" class="btn btn-neutral float-left" title="18. 小结" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="20.%E4%B8%BB%E8%A6%81%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%BC%80%E5%8F%91.html" class="btn btn-neutral float-right" title="20. 主要页面的开发" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, huxiaojian.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>